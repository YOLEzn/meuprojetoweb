(function(g){var window=this;'use strict';var eOs=function(a){var x=new g.kD("und",new g.kq("Default","und",!0));x.captionTracks=a.captionTracks;return x},aNJ=function(a){return new g.ms(function(x,y){var D=a.length,M=[];
if(D)for(var N=function(G,Q){D--;M[G]=Q;D==0&&x(M)},F=function(G){y(G)},c,J=0;J<a.length;J++)c=a[J],g.SSl(c,g.Yy(N,J),F);
else x(M)})},hr=function(a){this.T=a},$B=function(){hr.apply(this,arguments)},xes=function(){$B.apply(this,arguments)},yJp=function(){$B.apply(this,arguments)},jWp=function(){$B.apply(this,arguments)},DeL=function(){$B.apply(this,arguments)},McP=function(){$B.apply(this,arguments)},NL7=function(){$B.apply(this,arguments)},Frh=function(){$B.apply(this,arguments)},zQp=function(){hr.apply(this,arguments)},cJJ=function(){$B.apply(this,arguments)},ogy=function(){$B.apply(this,arguments)},JJD=function(){$B.apply(this,
arguments)},GAp=function(){$B.apply(this,arguments)},QWh=function(){$B.apply(this,arguments)},SFD=function(){$B.apply(this,arguments)},KrL=function(){$B.apply(this,arguments)},LrD=function(){$B.apply(this,arguments)},wap=function(){$B.apply(this,arguments)},CfD=function(){$B.apply(this,arguments)},qFY=function(){$B.apply(this,arguments)},deF=function(){$B.apply(this,arguments)},Zds=function(){hr.apply(this,arguments)},ngh=function(){$B.apply(this,arguments)},vgG=function(){$B.apply(this,arguments)},
Pfy=function(){$B.apply(this,arguments)},TLG=function(){$B.apply(this,arguments)},lNF=function(){$B.apply(this,arguments)},kAs=function(){$B.apply(this,arguments)},udJ=function(){$B.apply(this,arguments)},meV=function(){$B.apply(this,arguments)},Wrh=function(){$B.apply(this,arguments)},EgL=function(){hr.apply(this,arguments)},sWL=function(){hr.apply(this,arguments)},BLJ=function(){hr.apply(this,arguments)},hQF=function(){$B.apply(this,arguments)},$eV=function(){$B.apply(this,arguments)},fNy=function(){$B.apply(this,
arguments)},ggD=function(){$B.apply(this,arguments)},RQV=function(){$B.apply(this,arguments)},YFV=function(){$B.apply(this,arguments)},AJt=function(){$B.apply(this,arguments)},Uen=function(){$B.apply(this,arguments)},HdF=function(){$B.apply(this,arguments)},id7=function(){$B.apply(this,arguments)},OdD=function(){$B.apply(this,arguments)},VcD=function(){$B.apply(this,arguments)},rJL=function(){$B.apply(this,arguments)},tct=function(){$B.apply(this,arguments)},Xap=function(){$B.apply(this,arguments)},
bdn=function(){$B.apply(this,arguments)},pah=function(){$B.apply(this,arguments)},INp=function(){$B.apply(this,arguments)},eQn=function(){$B.apply(this,arguments)},aWs=function(){$B.apply(this,arguments)},x3L=function(){$B.apply(this,arguments)},y4y=function(){$B.apply(this,arguments)},jLn=function(){$B.apply(this,arguments)},D3D=function(){$B.apply(this,arguments)},MyF=function(){$B.apply(this,arguments)},NBh=function(){$B.apply(this,arguments)},FdJ=function(){$B.apply(this,arguments)},zrh=function(){$B.apply(this,
arguments)},c4V=function(){$B.apply(this,arguments)},ors=function(){hr.apply(this,arguments)},J4s=function(){$B.apply(this,arguments)},G_s=function(){$B.apply(this,arguments)},QLt=function(){$B.apply(this,arguments)},SSh=function(){$B.apply(this,arguments)},Kdy=function(){$B.apply(this,arguments)},LdF=function(){$B.apply(this,arguments)},wwp=function(){$B.apply(this,arguments)},C6V=function(){$B.apply(this,arguments)},qSG=function(){$B.apply(this,arguments)},d3n=function(){$B.apply(this,arguments)},
ZXh=function(){$B.apply(this,arguments)},nrP=function(){$B.apply(this,arguments)},vrp=function(){$B.apply(this,arguments)},P6p=function(){$B.apply(this,arguments)},TBF=function(){$B.apply(this,arguments)},lW7=function(){$B.apply(this,arguments)},k_t=function(){$B.apply(this,arguments)},uWs=function(){$B.apply(this,arguments)},m3G=function(){$B.apply(this,arguments)},Wdt=function(){$B.apply(this,arguments)},Ert=function(){$B.apply(this,arguments)},sLL=function(){$B.apply(this,arguments)},BB7=function(){$B.apply(this,
arguments)},hry=function(){$B.apply(this,arguments)},$3F=function(){$B.apply(this,arguments)},fWh=function(){$B.apply(this,arguments)},grP=function(){$B.apply(this,arguments)},Rrt=function(){$B.apply(this,arguments)},YSL=function(){$B.apply(this,arguments)},A4F=function(){$B.apply(this,arguments)},U37=function(){$B.apply(this,arguments)},HXy=function(){$B.apply(this,arguments)},iXp=function(){$B.apply(this,arguments)},OXy=function(){$B.apply(this,arguments)},VyV=function(a){a=a.key||a.id;
if(!a)throw Error("Entity key is missing");return a},r4y=function(){if(f8)return f8();
var a={};f8=g.jL("PersistentEntityStoreDb",{FY:(a.EntityStore={gp:1},a.EntityAssociationStore={gp:2},a),shared:!1,upgrade:function(x,y){y(1)&&g.f3(g.mZ(x,"EntityStore",{keyPath:"key"}),"entityType","entityType");y(2)&&(x=g.mZ(x,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.f3(x,"byParentEntityKey","parentEntityKey"),g.f3(x,"byChildEntityKey","childEntityKey"))},
version:3});return f8()},tyy=function(a){return g.Ov(r4y(),a)},XwV=function(a){return g.Ov((0,g.qGV)(),a)},gF=function(a){this.token=a},RY=function(a,x){x=x===void 0?{}:x;
g.$G.call(this,g.dYh[a],Object.assign({},{name:"PESEncoderError",type:a},x));this.type=a;this.level="WARNING";Object.setPrototypeOf(this,RY.prototype)},bX7=function(a){return new RY("WRONG_DATA_TYPE",{MA:a})},pwP=function(a){return a instanceof Error?new RY("UNKNOWN_ENCODE_ERROR",{originalMessage:a.message}):new RY("UNKNOWN_ENCODE_ERROR")},IWD=function(a){return a instanceof Error?new RY("UNKNOWN_DECODE_ERROR",{originalMessage:a.message}):new RY("UNKNOWN_DECODE_ERROR")},erD=function(a,x){a=a instanceof
RY?a:x(a);
g.mT(a);throw a;},aqy=function(){},x$J=function(a,x,y){try{return a.J(x,y)}catch(D){erD(D,pwP)}},yGP=function(a){a=(new TextEncoder).encode(a).subarray(0,16);
var x=new Uint8Array(16);x.set(a);return x},YB=function(a){this.T=a},D$s=function(a){var x=jHt[a];
if(x)return x;g.E0(new g.$G("Entity model not found.",{entityType:a}))},MpP=function(a,x){this.T=a;
this.B=x;this.J={}},F8V=function(a,x){a:{a=NgG(a.B,x.version);
try{var y=a.B(x.data,x.key);break a}catch(D){erD(D,IWD)}y=void 0}return y},Ar=function(a,x,y){return a.T.objectStore("EntityStore").get(x).then(function(D){if(D){if(y&&D.entityType!==y)throw Error("Incorrect entity type");
return F8V(a,D)}})},Uc=function(a,x,y){return y?(y=y.map(function(D){return Ar(a,D,x)}),g.n3.all(y)):a.T.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(x)).then(function(D){return D.map(function(M){return F8V(a,M)})})},ic=function(a,x,y){var D=VyV(x),M=NgG(a.B,1),N=Object.assign({},x);
return a.T.objectStore("EntityStore").get(D).then(function(F){if(F){if(F.entityType!==y)throw Error("Incorrect entity type");N.entityMetadata||(F=F8V(a,F),N.entityMetadata=F.entityMetadata)}}).then(function(){var F={key:D,
entityType:y,data:x$J(M,N,D),version:1};return g.n3.all([g.Bo(a.T.objectStore("EntityStore"),F),zvy(a,N,y)])}).then(function(){HT(a,D,y);
return D})},cGh=function(a,x,y){x=x.map(function(D){return ic(a,D,y)});
return g.n3.all(x)},Oc=function(a,x,y){if(y==null?0:y.qF){var D=new Set;
return oCy(a,x,D).then(function(){for(var N=[],F=g.W(D),c=F.next();!c.done;c=F.next())N.push(Oc(a,c.value));return g.n3.all(N).then(function(){})})}var M=g.UL(x).entityType;
return g.n3.all([a.T.objectStore("EntityStore").delete(x),JGF(a,x)]).then(function(){HT(a,x,M)})},GYD=function(a,x){return g.A5(a.T.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(x)},function(y){return g.n3.all([y.delete(),
JGF(a,y.cursor.primaryKey)]).then(function(){HT(a,y.cursor.primaryKey,x);return g.R$(y)})})},QHh=function(a,x,y,D){var M=NgG(a.B,1);
return Ar(a,x,D).then(function(N){if(N){N=g.No(N,y);var F={key:x,entityType:D,data:x$J(M,N,x),version:1};return g.n3.all([g.Bo(a.T.objectStore("EntityStore"),F),zvy(a,N,D)])}}).then(function(){HT(a,x,D);
return x})},HT=function(a,x,y){var D=a.J[y];
D||(D=new Set,a.J[y]=D);D.add(x)},Sds=function(a,x,y){var D=VyV(x);
y=D$s(y);if(!y)return g.n3.resolve([]);y=new y(x);a=a.T.objectStore("EntityAssociationStore");x=[];y=g.W(y.B());for(var M=y.next();!M.done;M=y.next())x.push(g.Bo(a,{parentEntityKey:D,childEntityKey:M.value}));return g.n3.all(x).then(function(N){return N.map(function(F){return F[1]})})},JGF=function(a,x){return a.T.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(x))},zvy=function(a,x,y){var D=VyV(x);
return JGF(a,D).then(function(){return Sds(a,x,y)})},oCy=function(a,x,y){if(y.has(x))return g.n3.resolve(void 0);
y.add(x);return K8G(a,x).then(function(D){return a.T.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(x)).then(function(){return D})}).then(function(D){var M=g.n3.resolve(void 0);
D=g.W(D);for(var N=D.next(),F={};!N.done;F={SI:void 0},N=D.next())F.SI=N.value,M=M.then(function(c){return function(){return oCy(a,c.SI,y)}}(F));
return M}).then(function(){})},K8G=function(a,x){var y=a.T.objectStore("EntityAssociationStore");
return y.index("byParentEntityKey").getAll(IDBKeyRange.only(x)).then(function(D){var M=[];D=g.W(D);for(var N=D.next();!N.done;N=D.next())N=N.value,M.push(y.index("byChildEntityKey").getAll(N.childEntityKey));return g.n3.all(M)}).then(function(D){var M=[];
D=g.W(D);for(var N=D.next();!N.done;N=D.next())N=N.value,N.length===1&&M.push(N[0].childEntityKey);return M})},VO=function(){},L8y=function(){this.T={};
this.T[0]=new VO;if(!g.Te("aes_pes_encoder_killswitch")){var a=this.T;try{var x=g.XQ();var y=yGP(x);var D=new YB(new g.j4(y),new g.Dl(y))}catch(M){throw a=M instanceof Error?new RY("KEY_CREATION_FAILED",{originalMessage:M.message}):new RY("KEY_CREATION_FAILED"),g.mT(a),a;}a[1]=D}},NgG=function(a,x){x=x===void 0?0:x;
a=a.T[x];if(!a)throw x=new RY("INVALID_ENCODER_VERSION",{MA:x}),g.mT(x),x;return a},rF=function(a,x){g.A.call(this);
this.token=a;this.T=x;this.observers=[];a=new g.lF.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.XQ());a.onmessage=this.B.bind(this);this.channel=a},tr=function(a,x,y){var D,M,N,F;
return g.R(function(c){if(c.T==1)return g.B(c,tyy(a.token),2);if(c.T!=3)return D=c.B,g.B(c,g.Ev(D,["EntityStore","EntityAssociationStore"],x,function(J){M=new MpP(J,a.T);return y(M)}),3);
N=c.B;M&&(F=M.J,Object.keys(F).length>0&&(a.channel.postMessage(F),w9n(a,F)));return c.return(N)})},XY=function(a,x,y){return tr(a,{mode:"readwrite",
yn:!0},function(D){return ic(D,x,y)})},CuG=function(a,x){return tr(a,{mode:"readwrite",
yn:!0},function(y){return cGh(y,x,"offlineOrchestrationActionWrapperEntity")})},qdP=function(a,x){return tr(a,{mode:"readwrite",
yn:!0},function(y){return Oc(y,x)})},d$p=function(a){return tr(a,{mode:"readwrite",
yn:!0},function(x){return GYD(x,"videoPlaybackPositionEntity")})},bc=function(a,x,y){return tr(a,{mode:"readonly",
yn:!0},function(D){return Ar(D,x,y)})},p8=function(a,x,y){return tr(a,{mode:"readonly",
yn:!0},function(D){return Uc(D,x,y)})},w9n=function(a,x){a=g.W(a.observers);
for(var y=a.next();!y.done;y=a.next())y=y.value,y(x)},ZDh=function(){var a,x,y;
return g.R(function(D){if(D.T==1)return g.cJ(D,2),g.B(D,g.x_(),4);if(D.T!=2){a=D.B;if(!a||!g.b8()||typeof g.lF.BroadcastChannel==="undefined")return D.return();x=new L8y;return D.return(new rF(a,x))}y=g.Qn(D);y instanceof Error&&g.mT(y);return D.return()})},IY=function(){nCG||(nCG=ZDh());
return nCG},vCp=function(a){var x;
a=(x=a.options)==null?void 0:x.persistenceOption;return a==="ENTITY_PERSISTENCE_OPTION_PERSIST"||a==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},PuP=function(a){var x;
return g.R(function(y){return y.T==1?g.B(y,IY(),2):(x=y.B)?g.B(y,tr(x,"readwrite",function(D){for(var M={},N=g.W(a),F=N.next(),c={};!F.done;c={R9:void 0,WA:void 0},F=N.next())c.R9=F.value,c.R9.entityKey&&vCp(c.R9)&&(c.WA=g.Tj(c.R9.payload),F=void 0,c.R9.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(F=function(J){return function(){return ic(D,J.R9.payload[J.WA],J.WA)}}(c)),c.R9.type==="ENTITY_MUTATION_TYPE_DELETE"&&(F=function(J){return function(){return Oc(D,J.R9.entityKey)}}(c)),c.R9.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(F=function(J){return function(){return QHh(D,J.R9.entityKey,J.R9.payload[J.WA],J.WA)}}(c)),F&&(M[c.R9.entityKey]=M[c.R9.entityKey]?M[c.R9.entityKey].then(F):F()));
return g.n3.all(Object.values(M))}),0):y.return()})},Tgt=function(a){var x;
return g.R(function(y){if(y.T==1){x=a.mutations;if(!x||x.length<=0)return y.return();if(g.cC){var D={type:"ENTITY_LOADED"};x!==void 0&&(D.payload=x);g.cC.dispatch(D)}return g.B(y,PuP(x),2)}x.length=0;g.Fh(y)})},lq7=function(a){return a!==void 0},kYn=function(a){var x=g.fO();
x=Object.assign({},x);a=Object.assign({},a);for(var y in x)a[y]?(x[y]!==4&&(x[y]=a[y]),delete a[y]):x[y]!==2&&(x[y]=4);Object.assign(x,a);g.F_6(x);JSON.stringify(x);return x},u3F=function(a){var x,y;
return g.R(function(D){if(D.T==1)return g.B(D,g.x_(),2);if(D.T!=3)return(x=D.B)?g.B(D,g.Ax(x),3):D.return();y=D.B;return D.return(g.Ev(y,["index","media","captions"],{mode:"readwrite",yn:!0},function(M){var N=IDBKeyRange.bound(a+"|",a+"~");M=[M.objectStore("index").delete(N),M.objectStore("media").delete(N),M.objectStore("captions").delete(N)];return g.n3.all(M).then(function(){})}))})},m$p=function(){var a,x;
return g.R(function(y){if(y.T==1)return g.B(y,g.x_(),2);if(y.T!=3){a=y.B;if(!a)throw g.q7("rvdfd");return g.B(y,g.Ax(a),3)}x=y.B;return y.return(g.Ev(x,["index","media"],{mode:"readwrite",yn:!0},function(D){var M={};return g.go(D.objectStore("index"),{},function(N){var F=N.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),c=g.n3.resolve(void 0);if(F){var J=F[1];F=F[2];M[J]=M[J]||{};var G;M[J][F]=g.GMz((G=N.getValue())==null?void 0:G.fmts)}else c=N.delete().then(function(){});
return g.n3.all([g.R$(N),c]).then(function(Q){return g.W(Q).next().value})}).then(function(){for(var N={},F=g.W(Object.keys(M)),c=F.next();!c.done;c=F.next()){c=c.value;
var J=M[c].v;N[c]=M[c].a&&J?1:2}var G=kYn(N);return g.Dl6(D.objectStore("media"),{},function(Q){var S=Q.cursor.key.match(g.L_C);S&&N[S[1]]||D.objectStore("media").delete(Q.cursor.key);return g.X5l(Q)}).then(function(){return G})})}))})},W8s=function(a,x){var y,D;
return g.R(function(M){if(M.T==1)return g.B(M,g.x_(),2);if(M.T!=3){y=M.B;if(!y)throw g.q7("wct");return g.B(M,g.Ax(y),3)}D=M.B;return g.B(M,g.Ev(D,["captions"],{mode:"readwrite",yn:!0},function(N){var F=[];N=N.objectStore("captions");for(var c=0;c<x.length;c++){var J=g.Bo(N,x[c],a+"|"+x[c].metadata.vss_id);F.push(J)}return g.n3.all(F)}),0)})},ECF=function(a){var x,y,D;
return g.R(function(M){if(M.T==1)return x=IDBKeyRange.bound(a+"|",a+"~"),g.B(M,g.x_(),2);if(M.T!=3){y=M.B;if(!y)throw g.q7("gactfv");return g.B(M,g.Ax(y),3)}D=M.B;return M.return(D.getAll("captions",x))})},sHh=function(a){return g.R(function(x){g.YY(a,0);
return x.return(u3F(a))})},Bgs=function(a){return{context:g.p9(),
videoIds:a}},hvs=function(a){return{context:g.p9(),
playlistIds:a}},$$y=function(a){return{context:g.p9(),
offlinePlaylistSyncChecks:a}},fqG=function(){this.T=new Map},RvJ=function(){gCt||(gCt=new fqG);
return gCt},YdG=function(a,x){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:a},metadata:x,statusCode:void 0,csn:void 0,can:void 0}},AGh=function(a,x,y){if(!y){var D=D===void 0?!1:D;
y=a.T.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!y||D)y=g.ww(16),a.T.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",y)}a={flowNonce:y,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:x.eventType};x.metadata&&(a.flowMetadata=x.metadata);x.statusCode!==void 0&&(a.flowEventStatus=x.statusCode);x.csn&&(a.csn=x.csn);x.can&&(a.can=x.can);g.Ky("flowEvent",a,void 0)},U$V=function(a){var x,y,D,M,N,F,c,J,G,Q,S,K,L,w,Z,v,m,u,E,h,V,H,j6,e,as,z7,Qq,DJ,nz,yn,oP,zL,Xl,fz,yg,ht,k,p7,tt,ch;
return g.R(function(WJ){if(WJ.T==1)return g.B(WJ,tr(a,{mode:"readonly",yn:!0},function(P){return Uc(P,"playbackData").then(function(xG){var nh=xG.map(function(b1){return b1.transfer}).filter(function(b1){return!!b1}),cX=xG.map(function(b1){return b1.offlineVideoPolicy}).filter(function(b1){return!!b1}),ph=xG.filter(function(b1){return!!b1.key}).map(function(b1){return g.HP(g.UL(b1.key).entityId,"downloadStatusEntity")});
nh=Uc(P,"transfer",nh);cX=Uc(P,"offlineVideoPolicy",cX);ph=Uc(P,"downloadStatusEntity",ph);var Jb=nh.then(function(b1){b1=b1.reduce(function(aP,k2){(k2==null?0:k2.offlineVideoStreams)&&aP.push.apply(aP,g.tS(k2.offlineVideoStreams));return aP},[]).filter(function(aP){return!!aP});
return Uc(P,"offlineVideoStreams",b1)});
return g.n3.all([nh,cX,Jb,ph]).then(function(b1){var aP=g.W(b1);b1=aP.next().value;var k2=aP.next().value;var l=aP.next().value;aP=aP.next().value;return[xG,b1,k2,l,aP]})})}),2);
if(WJ.T!=3)return x=WJ.B,g.B(WJ,tr(a,{mode:"readonly",yn:!0},function(P){return Uc(P,"mainDownloadsListEntity").then(function(xG){var nh,cX;return(cX=(nh=xG[0])==null?void 0:nh.downloads)!=null?cX:[]})}),3);
y=WJ.B;D=g.W(x);M=D.next().value;N=D.next().value;F=D.next().value;c=D.next().value;J=D.next().value;G=M;Q=N;S=F;K=c;L=J;w={};Z={};v={};m={};u={};E=[];h=g.W(Q);for(V=h.next();!V.done;V=h.next())(H=V.value)&&(w[H.key]=H);j6=g.W(S);for(e=j6.next();!e.done;e=j6.next())(as=e.value)&&(Z[as.key]=as);z7=g.W(L);for(Qq=z7.next();!Qq.done;Qq=z7.next())(DJ=Qq.value)&&(v[DJ.key]=DJ);nz=g.W(K);for(yn=nz.next();!yn.done;yn=nz.next())(oP=yn.value)&&(m[oP.key]=oP);zL=g.W(y);for(Xl=zL.next();!Xl.done;Xl=zL.next())fz=
Xl.value,yg=void 0,u[(yg=fz.videoItem)!=null?yg:""]=!0,fz.videoItem&&(k=ht=void 0,p7=(k=(ht=g.UL(fz.videoItem))==null?void 0:ht.entityId)!=null?k:"",E.push({externalVideoId:p7}));tt=G.filter(function(P){if(!P||!P.key||!P.offlineVideoPolicy)return!1;P=g.UL(P.key).entityId;P=g.HP(P,"downloadStatusEntity");var xG;return!(P&&((xG=v[P])==null?void 0:xG.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
ch=tt.map(function(P){var xG=w[P.transfer],nh=[];if(xG==null?0:xG.offlineVideoStreams)for(var cX=g.W(xG.offlineVideoStreams),ph=cX.next();!ph.done;ph=cX.next())(ph=m[ph.value])&&nh.push(ph);cX=Z[P.offlineVideoPolicy];ph=u;var Jb=P==null?void 0:P.playerResponseTimestamp,b1=g.UL(cX.key).entityId;P=g.HP(b1,"mainVideoEntity");if(cX.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var aP="OFFLINE_VIDEO_STATE_DISABLED";cX.expirationTimestamp&&Number(cX.expirationTimestamp)<Date.now()/1E3&&(aP="OFFLINE_VIDEO_STATE_EXPIRED")}else if(cX.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")aP="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(xG==null?void 0:xG.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":aP="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":aP="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":aP="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":aP="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":aP="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":aP="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:aP="OFFLINE_VIDEO_STATE_UNKNOWN"}if(aP==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(xG==null?void 0:xG.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":aP="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":aP="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":aP=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}b1={id:b1,videoState:aP};if(xG==null?0:xG.cotn)b1.cotn=xG.cotn;if(xG==null?0:xG.maximumDownloadQuality)b1.selectedVideoQuality=xG==null?void 0:xG.maximumDownloadQuality;if(xG==null?0:xG.lastProgressTimeMs)b1.lastProgressTimeMs=xG.lastProgressTimeMs;Jb&&(b1.playerResponseSavedTimeMs=String(Number(Jb)*1E3));xG=String;Jb=0;nh=g.W(nh);for(aP=nh.next();!aP.done;aP=nh.next())if(aP=aP.value,aP.streamsProgress){aP=g.W(aP.streamsProgress);for(var k2=aP.next();!k2.done;k2=
aP.next()){var l=void 0;Jb+=Number((l=k2.value.numBytesDownloaded)!=null?l:0)}}b1.downloadedBytes=xG(Jb);b1.selectedOfflineMode=ph[P]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";cX.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(b1.offlinePlaybackDisabledReason=cX.offlinePlaybackDisabledReason);return b1});
return WJ.return({offlineVideos:ch,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:E}}})})},HDh=function(){this.locks=navigator.locks},iDp=function(){try{var a=g.uF("ytglobal.locks_");
if(a)return a;var x;if(x=navigator){var y=navigator;x="locks"in y&&!!y.locks}if(x)return g.lF.localStorage&&g.lF.localStorage.getItem("noop"),a=new HDh,g.ky("ytglobal.locks_",a),a}catch(D){}},eG=function(){},ODF=function(){},VpP=function(a){if(a.includes(":"))throw Error("Invalid user cache name: "+a);
return a+":"+g.XQ("CacheStorage get")},rGy=function(){return g.R(function(a){if(aO!==void 0)return a.return(aO);
aO=new Promise(function(x){var y;return g.R(function(D){switch(D.T){case 1:return g.cJ(D,2),g.B(D,xN.open("test-only"),4);case 4:return g.B(D,xN.delete("test-only"),5);case 5:g.GL(D,3);break;case 2:if(y=g.Qn(D),y instanceof Error&&y.name==="SecurityError")return x(!1),D.return();case 3:x("caches"in window),g.Fh(D)}})});
return a.return(aO)})},X9V=function(){return g.R(function(a){if(a.T==1)return g.B(a,rGy(),2);
if(!a.B)return a.return(void 0);tpL||(tpL=new ODF);return a.return(tpL)})},yX=function(a,x,y){g.E0(new g.$G("Woffle: "+a,y?{cotn:y}:""));
x instanceof Error&&g.E0(x)},bDP=function(a){var x;
return g.R(function(y){if(y.T==1)return g.B(y,U$V(a),2);x=y.B;g.Ky("offlineStateSnapshot",x);g.Fh(y)})},jg=function(a){g.A.call(this);
var x=this;this.api=a;this.uO={PQS:function(){return x.T},
ySR:function(){return x.B}};
typeof g.lF.BroadcastChannel!=="undefined"&&(this.T=new g.lF.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.XQ()),this.T.onmessage=this.J.bind(this),this.B=new g.lF.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.XQ()),this.B.onmessage=this.U.bind(this))},D3=function(a,x){a.api.uY("onOfflineOperationFailure",x);
var y;(y=a.T)==null||y.postMessage(x)},p9F=function(a,x,y){var D=this;
this.V=a;this.BJ=x;this.visibility=y;this.N=this.Y=this.D=this.J=this.T=!1;this.U=new g.Id(function(){D.nX()});
this.uO={uj:function(){return D.B},
nX:function(){D.nX()},
DXG:function(){return D.U}};
this.visibility.subscribe("visibilitystatechange",function(){D.m4()})},Iqn=function(a){if(!a.J&&!a.T){var x=iDp();
if(x){a.J=!0;var y=g.XQ("OfflineLockManager");x.request("woffle_orchestration_leader:"+y,{},function(){var D,M;return g.R(function(N){switch(N.T){case 1:return g.cJ(N,2),a.B=new g.Gw,a.T=!0,a.J=!1,g.B(N,a.V(),4);case 4:return g.B(N,a.B.promise,5);case 5:g.GL(N,0);break;case 2:D=g.Qn(N),a.nX(),D instanceof Error&&(M=D,M.args=[{name:"WoLockManagerError",eN:D.name}],g.mT(M)),g.Fh(N)}})})}}},ev7=function(a){a.T&&(a.N=!0,MD(a))},aeh=function(a,x){a.T&&(a.D=x,MD(a))},xRp=function(a,x){a.T&&(a.Y=x,MD(a))},
MD=function(a){a.Y&&a.D&&a.N&&a.visibility.isBackground()?g.eN(a.U,6E4):a.U.stop()},ND=function(a){var x;
a.offlineDeleteReason=(x=a.offlineDeleteReason)!=null?x:"OFFLINE_DELETE_REASON_UNKNOWN";var y;a.offlineModeType=(y=a.offlineModeType)!=null?y:"OFFLINE_NOW";g.Ky("offlineDeleteEvent",a)},F$=function(a,x){var y=x.videoId;
var D=x.CZ;x=x.offlineModeType;a.encryptedVideoId=y;a.cotn=D==null?void 0:D.cotn;a.offlineabilityFormatType=D==null?void 0:D.maximumDownloadQuality;var M;a.isRefresh=(M=D==null?void 0:D.isRefresh)!=null?M:!1;var N;a.softErrorCount=(N=D==null?void 0:D.transferRetryCount)!=null?N:0;a.offlineModeType=x!=null?x:"OFFLINE_NOW";(a.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&a.statusType==="UNKNOWN_STATUS_TYPE"||!a.transferStatusType&&!a.statusType)&&g.E0(Error("Woffle unknown transfer status"));
g.Ky("offlineTransferStatusChanged",a)},yXh=function(a){F$({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},a)},jpt=function(a,x,y,D){D={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!D};x&&y&&(x=Math.floor(x/1024).toFixed(),y=Math.floor(y/1024).toFixed(),D.alreadyDownloadedKbytes=x,D.totalFetchedKbytes=x,D.totalContentKbytes=y);F$(D,a)},DRJ=function(a){F$({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},a)},MWG=function(a){F$({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},a)},NyD=function(a){switch(a){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
z0=function(a){var x,y,D;
return((D=(x=a.actionMetadata)==null?void 0:(y=x.retryScheduleIntervalsInSeconds)==null?void 0:y.length)!=null?D:0)>0},cp=function(a){return a.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!a.entityKey},oO=function(a){return a.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!a.entityKey},J2=function(a){return a.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!a.entityKey},F6h=function(a){return a.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!a.entityKey},
G0=function(a,x,y,D,M){M=M===void 0?!1:M;
var N,F,c,J,G,Q;return g.R(function(S){if(S.T==1)return N=g.HP(a,x),F=g.HP(a,"downloadStatusEntity"),g.B(S,tr(y,{mode:"readonly",yn:!0},function(K){return g.n3.all([Ar(K,N,x),Ar(K,F,"downloadStatusEntity")])}),2);
c=S.B;J=c.length?c[0]:void 0;if(!J)return S.WJ(0);G=zjD;if(Q=c.length>1?c[1]:void 0){if(Q.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!M)return S.return();Q.downloadState=D}else Q={key:F,downloadState:D};g.fy(J,G,Q);return g.B(S,tr(y,{mode:"readwrite",yn:!0},function(K){return g.n3.all([ic(K,J,x),ic(K,Q,"downloadStatusEntity")])}),0)})},QX=function(a,x){return a.actionType===x.actionType&&a.entityKey===x.entityKey},Sg=function(a,x){if(a&&a.transferState!=="TRANSFER_STATE_COMPLETE"&&a.transferState!==
"TRANSFER_STATE_FAILED"){var y=g.UL(a.key).entityId;
F$({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:y,CZ:a,offlineModeType:x})}},KK=function(a){if(!a||!a.thumbnails)return[];
var x=[];a=g.W(a.thumbnails);for(var y=a.next();!y.done;y=a.next())y=y.value,y.url&&x.push(y.url);return x},cXP=function(a,x,y){y=y===void 0?[]:y;
var D,M,N,F,c,J,G,Q,S,K,L,w,Z;return g.R(function(v){if(v.T==1)return y.length?g.B(v,p8(a,x),2):v.return([]);D=v.B;M=new Set;N=g.W(D);for(F=N.next();!F.done;F=N.next())if(c=F.value,J=c.id||c.key)G=g.UL(J).entityId,M.add(G);Q=[];S=g.W(y);for(K=S.next();!K.done;K=S.next())L=K.value,w=L.offlineVideoData,Z=void 0,((Z=w)==null?0:Z.videoId)&&!M.has(w.videoId)&&Q.push(L);return v.return(Q)})},ozh=function(a,x,y){return new g.ee(a,{cotn:x,
raw_player_response:y,download_media:!0,start:Infinity,disable_watch_next:!0})},JXp=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},LK=function(a,x,y,D,M,N,F,c,J,G,Q){this.entityType=a;
this.actionId=x;this.action=y;this.parentActionId=D;this.rootActionId=M===void 0?x:M;this.childActionIds=N;this.prereqActionId=F;this.postreqActionIds=c;this.hasChildActionFailed=G;this.retryScheduleIndex=0;this.T=Q||Date.now();this.retryScheduleIndex=J||0},w6=function(a){if(!a.key)throw Error("Entity key is required.");
if(!a.actionProto)throw Error("OfflineOrchestrationAction is required.");var x=g.UL(a.key),y=g.UL(a.actionProto.entityKey);return new LK(y.entityType,x.entityId,a.actionProto,a.parentActionId,a.rootActionId,a.childActionIds,a.prereqActionId,a.postreqActionIds,a.retryScheduleIndex,a.hasChildActionFailed,Number(a.enqueueTimeSec)*1E3)},CK=function(a){return{key:g.HP(a.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:a.action,parentActionId:a.parentActionId,rootActionId:a.rootActionId,childActionIds:a.childActionIds,prereqActionId:a.prereqActionId,postreqActionIds:a.postreqActionIds,retryScheduleIndex:a.retryScheduleIndex,hasChildActionFailed:a.hasChildActionFailed,enqueueTimeSec:(a.T/1E3).toFixed()}},Gy7=function(){var a;
return g.R(function(x){return x.T==1?g.B(x,X9V(),2):(a=x.B)?x.return(a.delete("yt-player-local-img")):x.return(!0)})},qD=function(a){var x,y;
return g.R(function(D){if(D.T==1)return g.B(D,X9V(),2);if(D.T!=3){x=D.B;if(!x)throw Error("Cache API not supported");return a.length?g.B(D,x.open("yt-player-local-img"),3):D.return()}y=D.B;return g.B(D,Promise.all(a.map(function(M){return y.delete(M)})),0)})},d6=function(a){var x,y;
return g.R(function(D){if(D.T==1)return g.B(D,X9V(),2);if(D.T!=3){x=D.B;if(!x)throw Error("Cache API not supported");return a.length?g.B(D,x.open("yt-player-local-img"),3):D.return()}y=D.B;return g.B(D,y.addAll(a),0)})},Z3=function(a,x,y,D,M){var N,F,c,J,G,Q,S,K,L,w,Z,v,m,u,E,h,V,H,j6,e,as,z7,Qq,DJ,nz,yn,oP,zL,Xl,fz,yg;
return g.R(function(ht){switch(ht.T){case 1:return N=g.HP(a,"mainVideoEntity"),F=g.HP(a,"ytMainChannelEntity"),c=g.HP(a,"transfer"),J=g.HP(a,"videoDownloadContextEntity"),g.B(ht,tr(x,{mode:"readonly",yn:!0},function(k){return g.n3.all([Ar(k,N,"mainVideoEntity"),Ar(k,F,"ytMainChannelEntity"),Ar(k,c,"transfer"),Ar(k,J,"videoDownloadContextEntity"),Uc(k,"ytMainChannelEntity"),Uc(k,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:G=ht.B;Q=g.W(G);S=Q.next().value;K=Q.next().value;L=Q.next().value;w=Q.next().value;Z=Q.next().value;v=Q.next().value;m=S;u=K;E=L;h=w;V=Z;H=v;if(!m&&!u){ht.WJ(3);break}j6=m?KK(m.thumbnail):[];if(!u){e=[];ht.WJ(4);break}return g.B(ht,QpV(u,V),5);case 5:e=ht.B;case 4:return as=e,g.B(ht,qD(j6.concat(as)),3);case 3:z7=[];Qq=g.HP(a,"downloadStatusEntity");DJ=g.W(H);for(nz=DJ.next();!nz.done;nz=DJ.next())yn=nz.value,oP=g.UL(yn.key).entityId,zL=w6(yn),Xl=g.UL(zL.action.entityKey).entityId,oP!==a&&
Xl!==a||QX(y,yn.actionProto)||z7.push(yn.key);return g.B(ht,tr(x,{mode:"readwrite",yn:!0},function(k){var p7=z7.map(function(tt){return Oc(k,tt)});
p7.push(Oc(k,N,{qF:!0}));p7.push(Oc(k,Qq,{qF:!0}));return g.n3.all(p7)}),7);
case 7:yg=(fz=h)==null?void 0:fz.offlineModeType,M&&(ND(M),M.offlineModeType&&(yg=M.offlineModeType)),Sg(E,yg),D3(D,{entityKey:N,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Fh(ht)}})},L6h=function(a,x,y,D){var M,N,F,c,J,G,Q,S,K,L,w,Z,v,m,u,E,h,V,H,j6,e,as,z7,Qq,DJ,nz,yn,oP,zL,Xl,fz,yg,ht,k,p7,tt,ch,WJ,P,xG,nh,cX,ph,Jb,b1,aP,k2,l,n,T;
return g.R(function(f){switch(f.T){case 1:return M=g.HP(a,"mainPlaylistEntity"),N=g.HP(a,"ytMainChannelEntity"),g.B(f,tr(x,{mode:"readonly",yn:!0},function(X){return g.n3.all([Ar(X,M,"mainPlaylistEntity"),Ar(X,N,"ytMainChannelEntity"),Uc(X,"mainPlaylistEntity"),Uc(X,"mainDownloadsListEntity"),Uc(X,"ytMainChannelEntity"),Uc(X,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:F=f.B;c=g.W(F);J=c.next().value;G=c.next().value;Q=c.next().value;S=c.next().value;K=c.next().value;L=c.next().value;w=J;Z=G;v=Q;m=S;u=K;E=L;if(!w&&!Z){f.WJ(3);break}h=w?SHY(w):[];if(!Z){V=[];f.WJ(4);break}return g.B(f,QpV(Z,u),5);case 5:V=f.B;case 4:return H=V,g.B(f,qD(h.concat(H)),3);case 3:j6=[];e=new Map;if(!w){f.WJ(7);break}return g.B(f,K6h(w,v,m),8);case 8:j6=f.B;as=g.W(j6);for(z7=as.next();!z7.done;z7=as.next())Qq=z7.value,e.set(Qq,{videoId:Qq,playlistId:a,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.B(f,tr(x,{mode:"readonly",yn:!0},function(X){return g.n3.all([Uc(X,"transfer"),Uc(X,"videoDownloadContextEntity")])}),9);
case 9:DJ=f.B;nz=g.W(DJ);yn=nz.next().value;oP=nz.next().value;zL=yn;Xl=oP;fz=g.W(zL);for(yg=fz.next();!yg.done;yg=fz.next())ht=yg.value,k=g.UL(ht.key).entityId,(p7=e.get(k))&&ht&&(p7.cotn=ht.cotn);tt=g.W(Xl);for(ch=tt.next();!ch.done;ch=tt.next())WJ=ch.value,P=g.UL(WJ.key).entityId,(xG=e.get(P))&&WJ&&(xG.offlineModeType=WJ.offlineModeType);case 7:nh=[];cX=g.W(E);for(ph=cX.next();!ph.done;ph=cX.next())Jb=ph.value,b1=g.UL(Jb.key).entityId,aP=w6(Jb),b1!==a&&aP.rootActionId!==a||QX(y,Jb.actionProto)||
nh.push(Jb.key);k2=g.HP(a,"mainPlaylistEntity");return g.B(f,tr(x,{mode:"readwrite",yn:!0},function(X){var Fl=nh.map(function(p){return Oc(X,p)});
Fl.push(Oc(X,k2,{qF:!0}));return g.n3.all(Fl)}),10);
case 10:if(!w){f.WJ(0);break}j6.reverse();if(!j6){f.WJ(0);break}l=g.W(j6);n=l.next();case 13:if(n.done){f.WJ(0);break}T=n.value;return g.B(f,Z3(T,x,y,D,e.get(T)),14);case 14:n=l.next(),f.WJ(13)}})},CzJ=function(a,x,y,D){var M,N,F,c,J,G,Q,S,K;
return g.R(function(L){if(L.T==1)return M=g.HP("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),N=new Map,g.B(L,tr(a,{mode:"readwrite",yn:!0},function(w){var Z=Uc(w,"transfer"),v=Uc(w,"offlineOrchestrationActionWrapperEntity"),m=Uc(w,"videoDownloadContextEntity"),u=Ar(w,M,"mainDownloadsListEntity");return g.n3.all([Z,v,m,u]).then(function(E){E=g.W(E);var h=E.next().value;var V=E.next().value;var H=E.next().value;var j6=E.next().value;E=wst.map(function(as){return GYD(w,as)});
V=g.W(V);for(var e=V.next();!e.done;e=V.next())e=e.value,QX(x,e.actionProto)||E.push(Oc(w,e.key,{qF:!0}));j6&&(j6.downloads=[],E.push(ic(w,j6,"mainDownloadsListEntity")));if(H)for(H=g.W(H),j6=H.next();!j6.done;j6=H.next())j6=j6.value,V=g.UL(j6.key).entityId,V=g.HP(V,"transfer"),N.set(V,j6.offlineModeType);return g.n3.all(E).then(function(){return h})})}),2);
F=L.B;c=g.W(F);for(J=c.next();!J.done;J=c.next())G=J.value,Sg(G,N.get(G.key)),Q=g.UL(G.key).entityId,S={videoId:Q,offlineDeleteReason:D,cotn:G.cotn,offlineModeType:N.get(G.key)},ND(S),K=g.HP(Q,"mainVideoEntity"),D3(y,{entityKey:K,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.B(L,Gy7(),0)})},SHY=function(a,x){var y=[];
if(a.thumbnailStyleData){a=g.W(a.thumbnailStyleData);for(var D=a.next();!D.done;D=a.next()){var M=void 0,N=void 0,F=void 0;y=y.concat(KK((M=D.value)==null?void 0:(N=M.value)==null?void 0:(F=N.collageThumbnail)==null?void 0:F.coverThumbnail))}}x=KK(x);return y.concat(x)},K6h=function(a,x,y){var D,M,N,F,c,J,G,Q,S,K,L,w,Z,v,m,u,E,h,V,H,j6,e,as;
return g.R(function(z7){D=[];M=new Set;if(y.length)for(N=g.W(y),F=N.next();!F.done;F=N.next())if(c=F.value,J=void 0,(J=c.downloads)==null?0:J.length)for(G=g.W(c.downloads),Q=G.next();!Q.done;Q=G.next())S=Q.value,S.videoItem&&(K=g.UL(S.videoItem).entityId,M.add(K));if(a.videos){L=g.W(a.videos);for(w=L.next();!w.done;w=L.next())Z=w.value,v=JSON.parse(g.UL(Z).entityId),v.videoId&&!M.has(v.videoId)&&D.push(v.videoId);m=g.W(x);for(u=m.next();!u.done;u=m.next())if(E=u.value,E.key!==a.key&&(h=E.videos))for(V=
g.W(h),H=V.next();!H.done;H=V.next())j6=H.value,e=JSON.parse(g.UL(j6).entityId),e.videoId&&(as=D.indexOf(e.videoId),as!==-1&&D.splice(as,1))}return z7.return(D)})},QpV=function(a,x){var y,D,M,N,F,c,J,G;
return g.R(function(Q){y=KK(a.avatar);D=g.W(x);for(M=D.next();!M.done;M=D.next())if(N=M.value,N.id!==a.id)for(F=g.W(KK(N.avatar)),c=F.next();!c.done;c=F.next())J=c.value,G=y.indexOf(J),G!==-1&&y.splice(G,1);return Q.return(y)})},qHD=function(a){var x;
return g.R(function(y){x=g.q(a.frameworkUpdates,nK);return a.frameworkUpdates&&x?g.B(y,Tgt(x),0):y.return()})},Zjh=function(a){var x;
if((x=a.onResponseReceivedActions)!=null&&x.length){var y;a=(y=g.q(g.q(a.onResponseReceivedActions[0],dRn),g.nGp))==null?void 0:y.actions;if(a!=null&&a.length)return a}},nzL=function(a){var x,y,D;
return g.R(function(M){if(M.T==1)return a?g.B(M,bc(a,g.hw,"mainDownloadsListEntity"),2):M.return([]);x=M.B;return((y=x)==null?0:(D=y.downloads)==null?0:D.length)?M.return(x.downloads.map(function(N){var F;return(F=N.videoItem)!=null?F:""})):M.return([])})},Pzp=function(a,x){var y;
return g.R(function(D){return D.T==1?g.B(D,vzF(a,x),2):(y=D.B)?g.B(D,tr(a,{mode:"readwrite",yn:!0},function(M){var N=[ic(M,y.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];y.mainDownloadsListEntity&&N.push(ic(M,y.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.n3.all(N)}),0):D.WJ(0)})},vzF=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K,L,w,Z,v,m,u,E;
return g.R(function(h){if(h.T==1)return y=g.HP("main_downloads_library_id","mainDownloadsLibraryEntity"),D=g.HP("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.B(h,tr(a,{mode:"readonly",yn:!0},function(V){return g.n3.all([Ar(V,y,"mainDownloadsLibraryEntity"),Ar(V,D,"mainDownloadsListEntity")])}),2);
M=h.B;N=g.W(M);F=N.next().value;c=N.next().value;J=F;G=c;J||(J={id:y});Q=g.W(x);for(S=Q.next();!S.done;S=Q.next())if(K=S.value,K===g.hw){if(J.smartDownloadsList)return h.return();J.smartDownloadsList=K}else if(L=g.UL(K).entityType,w={},L==="mainPlaylistEntity"?w.playlistItem=K:L==="mainVideoEntity"&&(w.videoItem=K),!g.sJ(w)){Z=void 0;if((Z=G)==null?0:Z.downloads){v=!1;m=g.W(G.downloads);for(u=m.next();!u.done;u=m.next())if(E=u.value,E.playlistItem===K||E.videoItem===K){v=!0;break}v||G.downloads.push(w)}else G=
{id:D,downloads:[w]};J.downloadsList=D}return h.return({mainDownloadsLibraryEntity:J,mainDownloadsListEntity:G})})},TyG=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K,L,w,Z,v;
return g.R(function(m){if(m.T==1)return y=g.HP("main_downloads_library_id","mainDownloadsLibraryEntity"),D=g.HP("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.B(m,tr(a,{mode:"readonly",yn:!0},function(u){return g.n3.all([Ar(u,y,"mainDownloadsLibraryEntity"),Ar(u,D,"mainDownloadsListEntity"),Ar(u,g.hw,"mainDownloadsListEntity")])}),2);
M=m.B;N=g.W(M);F=N.next().value;c=N.next().value;J=N.next().value;G=F;Q=c;S=J;if(!G)return m.WJ(0);if(x===g.hw&&((K=S)==null?0:K.downloads))S.downloads=[];else if((L=Q)==null?0:L.downloads)for(w=g.UL(x).entityType,Z=0;Z<Q.downloads.length;Z++)if(v=Q.downloads[Z],w==="mainVideoEntity"&&v.videoItem===x){Q.downloads.splice(Z,1);break}else if(w==="mainPlaylistEntity"&&v.playlistItem===x){Q.downloads.splice(Z,1);break}return g.B(m,tr(a,{mode:"readwrite",yn:!0},function(u){var E=[ic(u,G,"mainDownloadsLibraryEntity")];
Q&&E.push(ic(u,Q,"mainDownloadsListEntity"));S&&E.push(ic(u,S,"mainDownloadsListEntity"));return g.n3.all(E)}),0)})},vp=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K;
return g.R(function(L){if(L.T==1)return y=g.HP(x,"transfer"),D=g.HP(x,"videoDownloadContextEntity"),g.B(L,tr(a,{mode:"readonly",yn:!0},function(w){return g.n3.all([Ar(w,y,"transfer"),Ar(w,D,"videoDownloadContextEntity")])}),2);
M=L.B;N=g.W(M);F=N.next().value;c=N.next().value;J=F;G=c;K={videoId:x,cotn:(Q=J)==null?void 0:Q.cotn,offlineModeType:(S=G)==null?void 0:S.offlineModeType};return L.return(K)})},Pp=function(a,x,y,D,M){var N,F,c,J,G,Q,S,K,L,w,Z,v,m,u,E,h,V,H,j6,e;
return g.R(function(as){switch(as.T){case 1:return N=g.HP(a,"musicTrack"),F=g.HP(a,"transfer"),g.B(as,tr(x,{mode:"readonly",yn:!0},function(z7){return g.n3.all([Ar(z7,N,"musicTrack"),Ar(z7,F,"transfer"),Uc(z7,"musicTrack"),Uc(z7,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:c=as.B;J=g.W(c);G=J.next().value;Q=J.next().value;S=J.next().value;K=J.next().value;L=G;w=Q;Z=S;v=K;if(!L){as.WJ(3);break}return g.B(as,lep(L,Z),4);case 4:return m=as.B,g.B(as,qD(m),3);case 3:u=[];E=g.W(v);for(h=E.next();!h.done;h=E.next())V=h.value,H=g.UL(V.key).entityId,j6=w6(V),e=g.UL(j6.action.entityKey).entityId,H!==a&&e!==a||QX(y,V.actionProto)||u.push(V.key);return g.B(as,tr(x,{mode:"readwrite",yn:!0},function(z7){var Qq=u.map(function(DJ){return Oc(z7,DJ)});
Qq.push(Oc(z7,N,{qF:!0}));return g.n3.all(Qq)}),6);
case 6:Sg(w),M&&ND(M),D3(D,{entityKey:N,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Fh(as)}})},T0=function(a,x,y,D,M){var N,F,c,J,G,Q,S,K,L,w,Z,v,m,u,E,h,V,H,j6,e,as,z7,Qq,DJ,nz,yn,oP,zL,Xl,fz,yg,ht,k,p7,tt,ch;
return g.R(function(WJ){switch(WJ.T){case 1:return N=g.HP(a,x),F=g.HP("music_downloads_library_id","musicDownloadsLibraryEntity"),g.B(WJ,tr(y,{mode:"readonly",yn:!0},function(P){return g.n3.all([Ar(P,N,x),Ar(P,F,"musicDownloadsLibraryEntity"),Uc(P,x),Uc(P,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:c=WJ.B;J=g.W(c);G=J.next().value;Q=J.next().value;S=J.next().value;K=J.next().value;L=G;w=Q;Z=S;v=K;if(!L){WJ.WJ(3);break}return g.B(WJ,lep(L,Z),4);case 4:return m=WJ.B,g.B(WJ,qD(m),3);case 3:u=[];E=new Map;if(!L){WJ.WJ(6);break}return g.B(WJ,kyV(L,Z,w),7);case 7:u=WJ.B;h=g.W(u);for(V=h.next();!V.done;V=h.next())H=V.value,j6=g.UL(H).entityId,E.set(j6,{videoId:j6,playlistId:a,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.B(WJ,p8(y,"transfer"),8);case 8:for(e=WJ.B,
as=g.W(e),z7=as.next();!z7.done;z7=as.next())Qq=z7.value,DJ=g.UL(Qq.key).entityId,(nz=E.get(DJ))&&Qq&&(nz.cotn=Qq.cotn);case 6:yn=[];oP=g.W(v);for(zL=oP.next();!zL.done;zL=oP.next())Xl=zL.value,fz=g.UL(Xl.key).entityId,yg=w6(Xl),fz!==a&&yg.rootActionId!==a||QX(D,Xl.actionProto)||yn.push(Xl.key);ht=g.HP(a,x);return g.B(WJ,tr(y,{mode:"readwrite",yn:!0},function(P){var xG=yn.map(function(nh){return Oc(P,nh)});
xG.push(Oc(P,ht,{qF:!0}));return g.n3.all(xG)}),9);
case 9:if(!L){WJ.WJ(0);break}u.reverse();if(!u.length){WJ.WJ(0);break}k=g.W(u);p7=k.next();case 12:if(p7.done){WJ.WJ(0);break}tt=p7.value;ch=g.UL(tt).entityId;if(!ch){WJ.WJ(13);break}return g.B(WJ,Pp(ch,y,D,M,E.get(ch)),13);case 13:p7=k.next(),WJ.WJ(12)}})},lO=function(a,x,y){var D,M,N,F,c,J,G;
return g.R(function(Q){if(Q.T==1)return g.B(Q,tr(a,{mode:"readwrite",yn:!0},function(S){var K=Uc(S,"transfer"),L=Uc(S,"offlineOrchestrationActionWrapperEntity");return g.n3.all([K,L]).then(function(w){w=g.W(w);var Z=w.next().value;var v=w.next().value;w=uaV.map(function(h){return GYD(S,h)});
v=g.W(v);for(var m=v.next();!m.done;m=v.next()){m=m.value;var u=g.UL(m.actionProto.entityKey).entityType==="musicTrack",E=m.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";QX(x,m.actionProto)||u&&(!u||E)||w.push(Oc(S,m.key,{qF:!0}))}return g.n3.all(w).then(function(){return Z})})}),2);
D=Q.B;M=g.W(D);for(N=M.next();!N.done;N=M.next())F=N.value,Sg(F),c=g.UL(F.key).entityId,J={videoId:c,offlineDeleteReason:void 0,cotn:F.cotn},ND(J),G=g.HP(c,"musicTrack"),D3(y,{entityKey:G,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.B(Q,Gy7(),0)})},mRs=function(a){for(var x,y=g.W(a.additionalMetadatas),D=y.next();!D.done;D=y.next())D=D.value,D.offlineMusicVideoData&&(x=D.offlineMusicVideoData);
var M,N,F,c,J;return{id:g.HP(a.videoId,"musicTrack"),videoId:a.videoId,title:a.title,thumbnailDetails:a.thumbnail,lengthMs:String(Number(a.lengthSeconds)*1E3),albumTitle:(M=x)==null?void 0:M.releaseTitle,musicVideoType:(N=x)==null?void 0:N.musicVideoType,contentRating:{explicitType:(F=x)==null?void 0:F.explicitType},artistNames:((c=x)==null?void 0:c.byline)||((J=x)==null?void 0:J.channelName),downloadMetadata:g.HP(a.videoId,"musicTrackDownloadMetadataEntity")}},kyV=function(a,x,y){var D,M,N,F,c,J,
G,Q,S,K,L,w,Z,v,m,u,E,h;
return g.R(function(V){D=[];M=new Set;if((N=y)==null?0:(F=N.downloadedTracks)==null?0:F.length)for(c=g.W(y.downloadedTracks),J=c.next();!J.done;J=c.next())G=J.value,M.add(G);if(a.tracks){Q=g.W(a.tracks);for(S=Q.next();!S.done;S=Q.next())K=S.value,M.has(K)||D.push(K);L=g.W(x);for(w=L.next();!w.done;w=L.next())if(Z=w.value,Z.id!==a.id&&(v=Z.tracks))for(m=g.W(v),u=m.next();!u.done;u=m.next())E=u.value,h=D.indexOf(E),h!==-1&&D.splice(h,1)}return V.return(D)})},lep=function(a,x){var y,D,M,N,F,c,J,G;
return g.R(function(Q){y=KK(a.thumbnailDetails);D=g.W(x);for(M=D.next();!M.done;M=D.next())if(N=M.value,N.id!==a.id)for(F=g.W(KK(N.thumbnailDetails)),c=F.next();!c.done;c=F.next())J=c.value,G=y.indexOf(J),G!==-1&&y.splice(G,1);return Q.return(y)})},W67=function(a,x){var y,D,M,N,F,c,J,G,Q;
return g.R(function(S){if(S.T==1)return y=g.HP("music_downloads_library_id","musicDownloadsLibraryEntity"),g.B(S,bc(a,y,"musicDownloadsLibraryEntity"),2);(D=S.B)||(D={id:y});M=g.UL(x).entityType;M==="musicTrack"?(N=D.downloadedTracks)!=null&&N.includes(x)||(D.downloadedTracks=((F=D.downloadedTracks)!=null?F:[]).concat(x)):M==="musicPlaylist"?(c=D.downloadedPlaylists)!=null&&c.includes(x)||(D.downloadedPlaylists=((J=D.downloadedPlaylists)!=null?J:[]).concat(x)):M!=="musicAlbumRelease"||(G=D.downloadedAlbumReleases)!=
null&&G.includes(x)||(D.downloadedAlbumReleases=((Q=D.downloadedAlbumReleases)!=null?Q:[]).concat(x));return g.B(S,XY(a,D,"musicDownloadsLibraryEntity"),0)})},Ezt=function(a,x){var y,D,M,N,F,c,J;
return g.R(function(G){if(G.T==1)return y=g.HP("music_downloads_library_id","musicDownloadsLibraryEntity"),g.B(G,bc(a,y,"musicDownloadsLibraryEntity"),2);D=G.B;if(!D)return G.WJ(0);M=g.UL(x).entityType;M==="musicTrack"?N=D.downloadedTracks:M==="musicPlaylist"&&(N=D.downloadedPlaylists);if((F=N)==null?0:F.length)for(c=0;c<N.length;c++)if(J=N[c],J===x){N.splice(c,1);break}return g.B(G,XY(a,D,"musicDownloadsLibraryEntity"),0)})},spV=function(a){var x=a.videos;
a=[];var y=[];if(x){x=g.W(x);for(var D=x.next();!D.done;D=x.next()){var M=D.value.offlineVideoData.videoId;D=g.HP(M,"musicTrack");M=g.HP(M,"musicTrackDownloadMetadataEntity");a.push(D);y.push(M)}}return{g_:a,qj:y}},kN=function(a,x,y){x={track:mRs(x)};
y&&(x.playlistId=y);if(a=g.q(a.actionMetadata,Byt))x.maximumDownloadQuality=a.maximumDownloadQuality;return{musicTrackEntityActionMetadata:x}},$Rt=function(a){var x,y,D,M,N,F,c,J;
return g.R(function(G){switch(G.T){case 1:return x=g.to(),y=Bgs(a),D=g.aC(hj7),g.cJ(G,2),N={nH:!0},g.B(G,g.fM(x,y,D,void 0,N),4);case 4:M=G.B;g.GL(G,3);break;case 2:F=g.Qn(G);if(F instanceof g.O1)throw c="GetOffline network manager error: "+F.message,yX(c,F),Error(c);yX("GetOffline fetch request error",F);throw Error("GetOffline fetch request error");case 3:J=uO(M);if(!M)throw yX("Network request failed"),Error("Network request failed");if(J!==void 0)m2(J);else if(!M.videos||!M.videos.length)throw yX("No data"),
Error("No data");return G.return(M.videos.map(function(Q){return Q.offlineVideoData}))}})},feL=function(a){var x,y,D,M,N,F,c,J;
return g.R(function(G){switch(G.T){case 1:return x=g.to(),y=hvs(a),D=g.aC(hj7),g.cJ(G,2),N={nH:!0},g.B(G,g.fM(x,y,D,void 0,N),4);case 4:M=G.B;g.GL(G,3);break;case 2:F=g.Qn(G);if(F instanceof g.O1)throw c="GetOffline network manager error for playlist: "+F.message,yX(c,F),Error(c);yX("GetOffline fetch request error for playlist",F);throw Error("GetOffline fetch request error for playlist");case 3:J=uO(M);if(!M)throw yX("Network request failed for playlist"),Error("Network request failed for playlist");
if(J!==void 0)m2(J,"playlist");else if(!M.playlists||!M.playlists.length)throw yX("No data for playlist"),Error("No data for playlist");return G.return(M.playlists.map(function(Q){return Q.offlinePlaylistData}))}})},RjV=function(a,x,y,D){var M,N,F,c,J,G,Q,S,K,L,w,Z,v,m,u,E,h,V,H,j6,e,as,z7,Qq,DJ,nz,yn,oP,zL,Xl;
return g.R(function(fz){switch(fz.T){case 1:return g.B(fz,IY(),2);case 2:M=fz.B;if(!M)return fz.return([]);N=[];if((F=D)==null?0:F.length){N=D;fz.WJ(3);break}return g.B(fz,p8(M,"mainPlaylistEntity"),4);case 4:N=fz.B;case 3:if(!N.length)return fz.return([]);c=[];J=Date.now()/1E3;G=g.W(N);Q=G.next();case 5:if(Q.done)return c.length?g.B(fz,gzh(c),10):fz.return([]);S=Q.value;if(!S.downloadState){K=void 0;fz.WJ(8);break}return g.B(fz,bc(M,S.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:K=
fz.B;case 8:L=K;w=void 0;v=(Z=(w=S)==null?void 0:w.entityMetadata)&&Z.nextAutoRefreshIntervalSeconds?Number(Z.nextAutoRefreshIntervalSeconds):NaN;m=Number.isNaN(v)?a:v;E=u=void 0;h=((u=L)==null?0:u.lastSyncedTimestampMillis)?Number((E=L)==null?void 0:E.lastSyncedTimestampMillis)/1E3:0;H=V=void 0;j6=((V=L)==null?0:V.addedTimestampMillis)?Number((H=L)==null?void 0:H.addedTimestampMillis)/1E3:0;if(y||!Z||h+m<=J){e=[];as=void 0;if((as=S.videos)==null?0:as.length)for(z7=g.W(S.videos),Qq=z7.next();!Qq.done;Qq=
z7.next())DJ=Qq.value,nz=JSON.parse(g.UL(DJ).entityId),nz.videoId&&e.push(nz.videoId);yn="0";Z&&(oP=void 0,yn=String(Number((oP=Z.offlineLastModifiedTimestampSeconds)!=null?oP:0).toFixed()));zL={playlistId:S.playlistId,videoIds:e,offlineLastModifiedTimestamp:yn,autoSync:x,offlineDateAddedTimestamp:String(j6.toFixed())};c.push(zL)}Q=G.next();fz.WJ(5);break;case 10:return Xl=fz.B,fz.return(Xl)}})},YHY=function(){var a,x,y,D,M;
return g.R(function(N){if(N.T==1)return g.B(N,IY(),2);if(N.T!=3)return(a=N.B)?g.B(N,p8(a,"refresh"),3):N.return(!1);x=N.B;if((y=x[0])==null||!y.refreshTime)return N.return(!1);D=Number(x[0].refreshTime);M=Date.now()/1E3;return N.return(isFinite(D)&&M>=D)})},URJ=function(a,x){var y,D,M;
return g.R(function(N){switch(N.T){case 1:return g.cJ(N,2),g.B(N,AXF(a,x),4);case 4:return D=N.B,g.B(N,qHD(D),5);case 5:y=Zjh(D);g.GL(N,3);break;case 2:M=g.Qn(N),yX("getAndProcessSmartDownloadsResponse request or processing error",M);case 3:return N.return(y)}})},Hjt=function(a,x,y,D){var M,N,F,c,J,G,Q,S,K,L,w,Z,v,m,u,E,h,V,H,j6,e,as,z7,Qq,DJ,nz,yn,oP,zL,Xl;
return g.R(function(fz){switch(fz.T){case 1:return g.B(fz,IY(),2);case 2:M=fz.B;if(!M)return fz.return([]);N=[];if((F=D)==null?0:F.length){N=D;fz.WJ(3);break}return g.B(fz,p8(M,"musicPlaylist"),4);case 4:N=fz.B;case 3:if(!N.length)return fz.return([]);c=[];J=Date.now()/1E3;G=g.W(N);Q=G.next();case 5:if(Q.done)return c.length?g.B(fz,gzh(c),10):fz.return([]);S=Q.value;K=void 0;w=(L=(K=S)==null?void 0:K.entityMetadata)&&L.nextAutoRefreshIntervalSeconds?Number(L.nextAutoRefreshIntervalSeconds):NaN;Z=
Number.isNaN(w)?a:w;m=v=0;u="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!S.downloadMetadata){fz.WJ(8);break}return g.B(fz,bc(M,S.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:E=fz.B,V=h=void 0,v=Number((V=(h=E)==null?void 0:h.addedTimestampMillis)!=null?V:"0")/1E3,j6=H=void 0,m=Number((j6=(H=E)==null?void 0:H.lastModifiedTimestampMillis)!=null?j6:"0")/1E3,as=e=void 0,u=(as=(e=E)==null?void 0:e.syncState)!=null?as:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:z7=void 0;if(y||u!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!L||Number((z7=L.lastSyncedTimestampSeconds)!=null?z7:0)+Z<=J){Qq=[];DJ=void 0;if((DJ=S.tracks)==null?0:DJ.length)for(nz=g.W(S.tracks),yn=nz.next();!yn.done;yn=nz.next())oP=yn.value,Qq.push(g.UL(oP).entityId);zL={playlistId:S.playlistId,videoIds:Qq,offlineLastModifiedTimestamp:String(m.toFixed()),autoSync:x,offlineDateAddedTimestamp:String(v.toFixed())};c.push(zL)}Q=G.next();fz.WJ(5);break;case 10:return Xl=fz.B,fz.return(Xl)}})},AXF=function(a,x){var y,D,M,N,F,c,J,G,Q,S;
return g.R(function(K){switch(K.T){case 1:return y=g.to(),g.B(K,IY(),2);case 2:D=K.B;if(!D){K.WJ(3);break}return g.B(K,U$V(D),4);case 4:M=K.B;case 3:var L=M;N={context:g.p9(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:a},offlineClientState:L,clientStateRequestData:{preferredFormatType:x}}}};F=g.aC(ijP);g.cJ(K,5);J={nH:!0};return g.B(K,g.fM(y,N,F,void 0,J),7);case 7:c=K.B;g.GL(K,6);break;case 5:G=g.Qn(K);if(G instanceof g.O1)throw Q=
"DPS network manager error for smart downloads: "+G.message,yX(Q,G),Error(Q);yX("DPS fetch request error for smart downloads",G);throw Error("DPS fetch request error for smart downloads");case 6:S=uO(c);if(c)S!==void 0&&m2(S,"smart downloads");else throw yX("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return K.return(c)}})},VWF=function(a,x){var y,D,M,N,F,c,J,G;
return g.R(function(Q){switch(Q.T){case 1:return y=g.to(),D={context:g.p9(),videoPlaybackPositionEntities:a,lastSyncTimestampUsec:x},M=g.aC(Ojt),g.cJ(Q,2),F={nH:!0},g.B(Q,g.fM(y,D,M,void 0,F),4);case 4:N=Q.B;g.GL(Q,3);break;case 2:c=g.Qn(Q);if(c instanceof g.O1)throw J="VPPS network manager error: "+c.message,yX(J,c),Error(J);yX("VPPS fetch request error",c);throw Error("VPPS fetch request error");case 3:G=uO(N);if(N)G!==void 0&&m2(G,"position sync");else throw yX("Network request failed for position sync"),
Error("Network request failed for position sync");return Q.return(N)}})},tWG=function(a,x,y){var D,M,N,F,c,J,G,Q;
return g.R(function(S){switch(S.T){case 1:D=g.to();var K=y.refreshData,L=y.isEnqueuedForExpiredStreamUrlRefetch,w=y.e4,Z=y.offlineSourceData,v=y.mediaCapabilities,m={entityKey:a};K&&(m.refreshData=K);L&&(m.isExpiredStreamUrlRefetch=L);w&&(m.downloadParameters=w);Z&&(m.offlineSourceData=Z);K={context:g.N1(x),signatureTimestamp:20396,videos:[m]};v&&(K.mediaCapabilities=v);M=K;N=g.aC(rXP);g.cJ(S,2);c={nH:!0};return g.B(S,g.fM(D,M,N,void 0,c),4);case 4:F=S.B;g.GL(S,3);break;case 2:J=g.Qn(S);if(J instanceof
g.O1)throw G="GetPDE network manager error: "+J.message,yX(G,J),Error(G);yX("GetPDE fetch request error",J);throw Error("GetPDE fetch request error");case 3:Q=uO(F);if(F)Q!==void 0&&m2(Q,"PDE");else throw yX("Network request failed for PDE"),Error("Network request failed for PDE");return S.return(F)}})},uO=function(a){var x;
return(x=a.errorMetadata)==null?void 0:x.status},m2=function(a,x){x=x?" for "+x:"";
if(a===0)throw a="Empty response body"+x,yX(a),Error(a);a="Response with error"+x;yX(a);throw Error(a);},gzh=function(a){var x,y,D,M,N,F,c,J;
return g.R(function(G){switch(G.T){case 1:return x=g.to(),y=$$y(a),D=g.aC(XsY),g.cJ(G,2),N={nH:!0},g.B(G,g.fM(x,y,D,void 0,N),4);case 4:M=G.B;g.GL(G,3);break;case 2:F=g.Qn(G);if(F instanceof g.O1)throw c="offlinePlaylistSyncCheck network manager error: "+F.message,yX(c,F),Error(c);yX("offlinePlaylistSyncCheck fetch request error",F);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:J=uO(M);if(!M)throw yX("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(J!==void 0)m2(J,"playlist sync");else if(!M.offlinePlaylistSyncCheckDatas||!M.offlinePlaylistSyncCheckDatas.length)throw yX("No data for playlist sync"),Error("No data for playlist sync");return G.return(M.offlinePlaylistSyncCheckDatas.map(function(Q){return Q.offlinePlaylistSyncCheckData}))}})},Wp=function(a){this.T=a},bjs=function(a,x){var y,D,M,N,F,c;
return g.R(function(J){switch(J.T){case 1:y=new Map,D=g.W(x),M=D.next();case 2:if(M.done){J.WJ(4);break}N=M.value;F=y;c=F.set;return g.B(J,a.B(N),5);case 5:c.call(F,N,J.B);M=D.next();J.WJ(2);break;case 4:return J.return(y)}})},Eq=function(a,x,y,D,M,N){x=g.HP(x,y);
D=Object.assign({},N,{priority:D,retryScheduleIntervalsInSeconds:M});return{actionType:a,entityKey:x,actionMetadata:D}},sq=function(a,x,y,D,M,N){this.status=a;
this.T=x;this.U=y;this.B=D;this.J=M;this.downloadState=N},pss=function(a,x,y){this.T=a;
this.S=x;this.J=y},aAG=function(a,x){var y,D,M,N,F,c,J,G,Q;
return g.R(function(S){switch(S.T){case 1:return y=x.entityKey,M=(D=g.q(x.actionMetadata,Bp))==null?void 0:D.isEnqueuedForExpiredStreamUrlRefetch,g.cJ(S,2),N=void 0,g.B(S,IeG(a,x),4);case 4:N=S.B;g.cJ(S,5);var K=(K=g.q(x.actionMetadata,Bp))?{maximumDownloadQuality:K.maximumDownloadQuality}:void 0;return g.B(S,tWG(y,a.S,{isEnqueuedForExpiredStreamUrlRefetch:M,e4:K,offlineSourceData:N}),7);case 7:F=S.B;g.GL(S,6,2);break;case 5:return g.Qn(S,2),c=z0(x)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",yX("PDE handleAdd error"),S.return(h2(x,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",c,"DOWNLOAD_STATE_FAILED"));case 6:return g.B(S,ejG(a,F,x),8);case 8:return S.return(h2(x,!0,F.orchestrationActions));case 2:return J=g.Qn(S),G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",J instanceof g.SD&&J.type==="QUOTA_EXCEEDED"&&(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),yX("PDE handleAdd error"),S.return(h2(x,!1,void 0,G,Q,"DOWNLOAD_STATE_FAILED"))}})},jXP=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K,L,w,Z,v,m,u,E,h,V,H,j6,e,as;
return g.R(function(z7){switch(z7.T){case 1:return y=x.entityKey,D=g.UL(y).entityId,g.B(z7,tr(a.T,{mode:"readonly",yn:!0},function(Qq){var DJ=Ar(Qq,y,"playbackData"),nz=Ar(Qq,g.HP(D,"offlineVideoPolicy"),"offlineVideoPolicy");Qq=Ar(Qq,g.HP(D,"transfer"),"transfer");return g.n3.all([DJ,nz,Qq])}),2);
case 2:M=z7.B;N=g.W(M);F=N.next().value;c=N.next().value;J=N.next().value;G=F;Q=c;S=J;if(!G||!Q)return z7.return(h2(x,!0));K=[];Z=((w=G)==null?0:w.playerResponseJson)?JSON.parse(G.playerResponseJson):null;if(!(S&&Z&&a.S.C("html5_refresh_deprecated_downloads"))){z7.WJ(3);break}L=xr7(a,Z,S);return g.B(z7,yet(a,S),4);case 4:K=z7.B;case 3:v={lastPlayerResponseTimestampSeconds:G.playerResponseTimestamp,offlineToken:Q.offlineToken,formatIds:K};m={};if((u=S)==null?0:u.maximumDownloadQuality)m.maximumDownloadQuality=
S.maximumDownloadQuality;g.cJ(z7,5);E=void 0;return g.B(z7,IeG(a,x),7);case 7:return E=z7.B,g.cJ(z7,8),g.B(z7,tWG(y,a.S,{refreshData:v,e4:m,offlineSourceData:E,mediaCapabilities:L}),10);case 10:h=z7.B;g.GL(z7,9,5);break;case 8:return g.Qn(z7,5),V=z0(x)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",yX("PDE handleRefresh error"),z7.return(h2(x,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",V,"DOWNLOAD_STATE_FAILED"));
case 9:return g.B(z7,ejG(a,h,x),11);case 11:return z7.return(h2(x,!0,h.orchestrationActions));case 5:return H=g.Qn(z7),j6="PDE handleRefresh error",H instanceof Error&&(j6="PDE handleRefresh error: "+H.message),e="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",as="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",H instanceof g.SD&&H.type==="QUOTA_EXCEEDED"&&(e="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",as="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),yX(j6),z7.return(h2(x,
!1,void 0,e,as,"DOWNLOAD_STATE_FAILED"))}})},IeG=function(a,x){var y,D,M,N;
return g.R(function(F){if(F.T==1)return y=g.UL(x.entityKey).entityId,D=g.HP(y,"videoDownloadContextEntity"),g.B(F,bc(a.T,D,"videoDownloadContextEntity"),2);M=F.B;return(N=M)!=null&&N.offlineModeType?F.return({offlineModeType:M.offlineModeType}):F.return(void 0)})},ejG=function(a,x,y){var D,M,N,F,c;
return g.R(function(J){if(J.T==1){if(!x.frameworkUpdates||!g.q(x.frameworkUpdates,nK))return J.return();if(!(g.q(x.frameworkUpdates,nK).mutations&&g.q(x.frameworkUpdates,nK).mutations.length>0&&g.q(x.frameworkUpdates,nK).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return J.WJ(2);D=g.UL(g.q(x.frameworkUpdates,nK).mutations[0].entityKey).entityId;return g.B(J,vp(a.T,D),3)}if(J.T!=2){M=J.B;N=g.q(y.actionMetadata,Bp);if(c=(F=N)==null?void 0:F.playlistId)M.playlistId=c;M.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.xY(a.S)?g.B(J,Z3(D,a.T,y,a.J,M),2):g.f9(a.S)?g.B(J,Pp(D,a.T,y,a.J),2):J.WJ(2)}return g.B(J,Tgt(g.q(x.frameworkUpdates,nK)),0)})},h2=function(a,x,y,D,M,N){return new sq(x?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",z0(a),y,D,M,N)},xr7=function(a,x,y){x=ozh(a.S,y.cotn,x);
y=g.KL(x);return g.DOC(x,y,a.S)},yet=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K;
return g.R(function(L){if(L.T==1)return y=[],g.B(L,tr(a.T,{mode:"readonly",yn:!0},function(w){var Z=[],v=x.offlineVideoStreams;if(v){v=g.W(v);for(var m=v.next();!m.done;m=v.next())Z.push(Ar(w,m.value,"offlineVideoStreams"))}return g.n3.all(Z)}),2);
if(D=L.B)for(M=g.W(D),N=M.next();!N.done;N=M.next())if(F=N.value,c=void 0,(c=F)==null?0:c.streamsProgress)for(J=F.streamsProgress,G=0;G<J.length;G++)Q=J[G],S=JSON.parse(Q.formatStreamBytes),K={itag:S.itag,lmt:S.lastModified,xtags:S.xtags},y.push(K);return L.return(y)})},DrJ=function(a,x){this.T=a;
this.S=x},Mdn=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K,L;
return g.R(function(w){switch(w.T){case 1:return y=z0(x),g.B(w,p8(a.T,"videoPlaybackPositionEntity"),2);case 2:D=w.B;if(D.length===0)return w.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));g.cJ(w,3);return g.B(w,gF.getInstance(),5);case 5:M=w.B;if(!M)throw Error("prefStorage is undefined");return g.B(w,M.get("psi"),6);case 6:return N=w.B,J=(c=(F=N)==null?void 0:F.F1)!=null?c:"0",g.B(w,VWF(D,J),7);case 7:return G=w.B,Q={isPaused:G.watchHistoryPaused,F1:G.syncTimestampUsec},g.B(w,M.set("psi",
Q),8);case 8:if(Q.isPaused){w.WJ(9);break}S=g.q(G.frameworkUpdates,nK);if(!G.frameworkUpdates||!S){w.WJ(9);break}return g.B(w,Tgt(S),9);case 9:g.GL(w,4);break;case 3:return K=g.Qn(w),L="PPE handleRefresh error: "+(K instanceof Error?K.message:"unknown error"),yX(L),w.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return w.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},FoF=function(a,x){var y,D,M,N,F,c,J,G;
return g.R(function(Q){switch(Q.T){case 1:return y=z0(x),D=g.UL(x.entityKey).entityId,g.cJ(Q,2),g.B(Q,gF.getInstance(),4);case 4:M=Q.B;if(!M)throw Error("prefStorage is undefined");return g.B(Q,M.get("psi"),5);case 5:N=Q.B;F=g.q(x.actionMetadata,NIn);if(((c=N)==null?void 0:c.isPaused)!==!1||(J=F)==null||!J.lastPlaybackPositionSeconds){Q.WJ(6);break}G={key:g.HP(D,"videoPlaybackPositionEntity"),videoId:D,lastPlaybackPositionSeconds:F.lastPlaybackPositionSeconds};return g.B(Q,XY(a.T,G,"videoPlaybackPositionEntity"),
6);case 6:g.GL(Q,3);break;case 2:return g.Qn(Q),Q.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Q.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y))}})},zDJ=function(a,x){var y,D,M;
return g.R(function(N){switch(N.T){case 1:y=z0(x);g.cJ(N,2);D=g.UL(x.entityKey).entityId;if(D==="!*$_ALL_ENTITIES_!*$")return g.B(N,d$p(a.T),5);M=g.HP(D,"videoPlaybackPositionEntity");return g.B(N,qdP(a.T,M),5);case 5:g.GL(N,3);break;case 2:return g.Qn(N),N.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return N.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},ceL=function(a,x){this.api=a;
this.T=x;this.logger=new g.Kc("woffle");this.B=!1;this.uO={SX:this.SX}},ojG=function(a){return g.R(function(x){return x.return(sHh(a))})},JeD=function(a){var x;
return g.R(function(y){if(y.T==1)return g.B(y,g.Quq(a),2);x=y.B;return y.return(x.filter(function(D){return!!D.url}).map(function(D){return D.url}))})},$N=function(a,x){var y=g.Rk(x);
if(y===1||y===0)return Promise.resolve();(y=Gx7(a,x))&&y.stopVideo();a.J=0;return ojG(x)},fK=function(a,x,y,D){y=y===void 0?!1:y;
D=D===void 0?!0:D;x=typeof x==="string"?x:x.videoDetails.videoId;if(g.Rk(x)===2){var M=Gx7(a,x);M&&M.stopVideo();g.YY(x,2);a.J=2;y?QXp(a.T):D&&Szh(a.T)}},Gx7=function(a,x){var y;
return((y=a.player)==null?void 0:y.getVideoData().videoId)===x?a.player:null},KoV=function(a,x){this.T=a;
this.S=x},wOJ=function(a,x){var y,D;
return g.R(function(M){switch(M.T){case 1:return y=z0(x),g.B(M,bc(a.T,x.entityKey,"transfer"),2);case 2:if(D=M.B)return M.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));g.cJ(M,3);return g.B(M,Lop(a,x),5);case 5:g.GL(M,4);break;case 3:return g.Qn(M),M.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return M.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},CGL=function(a,x){var y,D;
return g.R(function(M){switch(M.T){case 1:return y=z0(x),g.B(M,bc(a.T,x.entityKey,"transfer"),2);case 2:D=M.B;if(!D||D.transferState!=="TRANSFER_STATE_COMPLETE")return M.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));g.cJ(M,3);return g.B(M,Lop(a,x,!0),5);case 5:g.GL(M,4);break;case 3:return g.Qn(M),M.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return M.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y))}})},qzh=function(a,x){var y,D,M,N,F,c,J,G,Q,S;
return g.R(function(K){switch(K.T){case 1:return y=z0(x),D=g.UL(x.entityKey).entityId,g.B(K,tr(a.T,{mode:"readonly",yn:!0},function(L){var w=Ar(L,x.entityKey,"transfer");L=Ar(L,g.HP(D,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.n3.all([w,L])}),2);
case 2:M=K.B;N=g.W(M);F=N.next().value;c=N.next().value;J=F;G=c;if(!J||J.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return K.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));g.cJ(K,3);J.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.B(K,XY(a.T,J,"transfer"),5);case 5:Q=g.UL(J.key).entityId;DRJ({videoId:Q,CZ:J,offlineModeType:(S=G)==null?void 0:S.offlineModeType});g.GL(K,4);break;case 3:return g.Qn(K),K.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return K.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y))}})},Lop=function(a,x,y){y=y===void 0?!1:y;
var D,M,N,F,c,J,G,Q,S,K,L,w,Z,v,m;return g.R(function(u){switch(u.T){case 1:return D=g.q(x.actionMetadata,drh),M=g.UL(x.entityKey).entityId,N=g.HP(M,"downloadStatusEntity"),g.B(u,tr(a.T,{mode:"readonly",yn:!0},function(E){var h=Ar(E,N,"downloadStatusEntity");E=Ar(E,g.HP(M,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.n3.all([h,E])}),2);
case 2:return F=u.B,c=g.W(F),J=c.next().value,G=c.next().value,Q=J,S=G,K="TRANSFER_STATE_TRANSFER_IN_QUEUE",((L=Q)==null?void 0:L.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(K="TRANSFER_STATE_PAUSED_BY_USER"),v={key:x.entityKey,transferState:K,cotn:g.ww(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(w=D)==null?void 0:w.maximumDownloadQuality,preferredAudioTrack:(Z=D)==null?void 0:Z.preferredAudioTrack,transferRetryCount:0,isRefresh:y,hasLoggedFirstStarted:!1},g.B(u,tr(a.T,
{mode:"readwrite",yn:!0},function(E){var h=[];y&&h.push(Oc(E,g.HP(M,"offlineVideoStreams")));h.push(ic(E,v,"transfer"));return g.n3.all(h)}),3);
case 3:if(!y){u.WJ(4);break}return g.B(u,ojG(M),4);case 4:yXh({videoId:M,CZ:v,offlineModeType:(m=S)==null?void 0:m.offlineModeType}),g.Fh(u)}})},njD=function(a,x,y,D){if(!a.action.entityKey)throw Error("entityKey is missing.");
var M=g.UL(a.action.entityKey);M={entityType:M.XK,entityId:M.entityId,offlineOrchestrationActionType:a.action.actionType,orchestrationAction:{orchestrationActionId:a.actionId}};x&&(M.offlineOrchestrationActionResult=x.status,M.isRetryable=y?!1:x.T,x.J&&(M.offlineOrchestrationFailureReason=ZtJ(x.J,M.isRetryable)));var N,F;if((N=a.action.actionMetadata)==null?0:(F=N.offlineLoggingData)==null?0:F.offlineModeType)M.offlineModeType=a.action.actionMetadata.offlineLoggingData.offlineModeType;D&&(M.additionalOrchestrationActions=
D.map(function(c){return{orchestrationActionId:c.actionId}}));
return M},ZtJ=function(a,x){return a!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||x?a==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&x?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":a:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},vjG=function(a,x){var y={offlineOrchestrationContext:njD(a)};
x=YdG(x,y);AGh(RvJ(),x,a.rootActionId)},PGF=function(a,x,y,D){D=D===void 0?[]:D;
x={offlineOrchestrationContext:njD(a,x,y,D)};x=YdG(3,x);AGh(RvJ(),x,a.rootActionId)},TIh=function(){this.actions=[]},lA7=function(a,x){x=g.W(x);
for(var y=x.next();!y.done;y=x.next())y=y.value,vjG(y,1),a.actions.push(y);a.actions.sort(a.T)},kxh=function(a,x){if(x)for(var y=0;y<a.actions.length;y++)if(x==="!*$_ALL_ENTITIES_!*$"&&a.actions[y].actionId!==x||x!=="!*$_ALL_ENTITIES_!*$"&&a.actions[y].rootActionId===x&&a.actions[y].actionId!==x)a.actions.splice(y,1),y--},uvh=function(a,x){a=g.W(a.actions);
for(var y=a.next();!y.done;y=a.next())if(y.value.actionId===x)return!0;return!1},g6=function(a,x,y,D,M){g.A.call(this);
var N=this;this.B=a;this.tP=x;this.cJ=y;this.Y=D;this.S=M;this.T=new TIh;this.D=new g.VR;this.J=new g.Id(function(){N.retry()});
this.V=NaN;this.N=!1;this.uO={kbc:function(){return N.T},
Vq:function(){return N.D},
lnc:function(){return N.J},
retry:function(){return N.retry()}};
g.U(this,this.J);this.BJ=this.B.observe(this.dS.bind(this))},EjJ=function(a,x,y,D,M){var N;
return g.R(function(F){if(F.T==1)return N=new g6(a,x,y,D,M),g.B(F,mrn(N),2);Woh(N);return F.return(N)})},Woh=function(a){var x=a.T.actions[0];
return a.U?((x==null?void 0:x.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&a.U[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(a.N=!0),Promise.resolve()):sXG(a)},sXG=function(a){var x,y,D,M,N,F,c,J,G,Q,S,K,L,w,Z,v,m;
return g.R(function(u){switch(u.T){case 1:if(a.U)throw Error("Already processing an action");if(a.hP())return u.return();x=a.T.actions.shift();aeh(a.cJ,!x);if(x===void 0)return u.return();x.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&x.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&kxh(a.T,x.actionId);y="";x.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&x.rootActionId===x.actionId&&(y=x.actionId);D=[x];a.U=D;if(M=a.tP[x.entityType]){u.WJ(2);break}a.U=
void 0;return g.B(u,sXG(a),3);case 3:return u.return();case 2:N=g.W(D);for(F=N.next();!F.done;F=N.next())c=F.value,vjG(c,2);g.cJ(u,4,5);return g.B(u,bjs(M,D.map(function(E){return E.action})),7);
case 7:J=u.B,G=g.W(D),Q=G.next();case 8:if(Q.done){u.WJ(10);break}S=Q.value;K=J.get(S.action);return g.B(u,BIn(a,S,K),9);case 9:Q=G.next();u.WJ(8);break;case 10:kxh(a.T,y);case 5:g.SV(u);a.U=void 0;g.K7(u,6);break;case 4:return L=g.Qn(u),yX("Orchestration error",L),g.cJ(u,12),g.B(u,hDD(a,D),14);case 14:g.GL(u,5);break;case 12:w=g.Qn(u);yX("Orchestration retry error",w);Z=g.W(D);for(v=Z.next();!v.done;v=Z.next())m=v.value,m.retryScheduleIndex<3&&lA7(a.T,[m]);u.WJ(5);break;case 6:return g.B(u,sXG(a),
0)}})},BIn=function(a,x,y){var D,M,N,F,c,J,G,Q,S,K,L,w;
return g.R(function(Z){switch(Z.T){case 1:D=x.retryScheduleIndex+2===3;if(y.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){Z.WJ(2);break}if(y.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){Z.WJ(0);break}PGF(x,y,D);if(y.T&&x.retryScheduleIndex+1<3)return g.B(Z,hDD(a,[x]),0);N=((M=y)==null?0:M.B)?y.B:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";F={entityKey:x.action.entityKey,failureReason:N};c=void 0;g.xY(a.S)?c="mainVideoDownloadStateEntity":g.f9(a.S)&&(c="musicTrackDownloadMetadataEntity");
if(!c||!y.downloadState){Z.WJ(7);break}J=g.UL(x.action.entityKey).entityId;return g.B(Z,G0(J,c,a.B,y.downloadState),7);case 7:D3(a.Y,F);if(y.downloadState==="DOWNLOAD_STATE_FAILED"&&a.S.C("html5_auto_retry_failed_pde_actions")){Z.WJ(0);break}yX("Orchestration result is not retryable, deleting action");return g.B(Z,qdP(a.B,CK(x).key),0);case 2:G=void 0;try{G=(Q=y.U)==null?void 0:Q.map(function(v){return a.createAction(v,x)})}catch(v){return PGF(x,y,D),S={entityKey:x.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},D3(a.Y,S),yX("Orchestration subactions creation error",v),Z.return()}PGF(x,y,D,G);if(!G){Z.WJ(12);break}K=G.map(function(v){return CK(v)});
L=0;case 13:if(!(L<G.length)||a.N){Z.WJ(15);break}return g.B(Z,tr(a.B,{mode:"readwrite",yn:!0},function(v){var m=[];m.push(cGh(v,K.slice(L,L+10),"offlineOrchestrationActionWrapperEntity"));return g.n3.all(m)}),16);
case 16:L+=10;Z.WJ(13);break;case 15:if(a.N)return a.N=!1,Z.return();case 12:return w=CK(x),g.B(Z,qdP(a.B,w.key),17);case 17:vjG(x,4),g.Fh(Z)}})},RDn=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K,L;
return g.R(function(w){y=[];D=Infinity;M=4E3;N=g.W(x);for(F=N.next();!F.done;F=N.next())c=F.value,J=Number(c.enqueueTimeSec),G=$rh(J),Q=c.retryScheduleIndex,S=Q!=null&&Q>0,G>0&&S?(D=Math.min(D,J),M=Math.min(G,M)):y.push(c);isFinite(D)&&(!a.J.isActive()||D<a.V)&&(a.V=D,a.J.start(M));a.D.nK()||(K=y.length,y=y.filter(function(Z){var v;Z=((v=Z.actionProto)==null?void 0:v.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!fA7.includes(Z)}),L=y.length<K,!a.J.isActive()&&L&&a.J.start(1));
y.length>0&&gjD(a,y);return g.B(w,Woh(a),0)})},Ae7=function(a){var x,y,D,M,N,F,c;
return g.R(function(J){if(J.T==1)return g.B(J,YzY(a),2);x=J.B;y=[];D=g.W(x);for(M=D.next();!M.done;M=D.next())N=M.value,F=g.UL(N.key),c=F.entityId,uvh(a.T,c)||y.push(N);return g.B(J,RDn(a,y),0)})},$rh=function(a){a=a*1E3-Date.now();
return a>4E3?4E3:a},hDD=function(a,x){var y,D,M;
return g.R(function(N){y=g.W(x);for(D=y.next();!D.done;D=y.next()){M=D.value;var F=void 0,c=void 0,J=((c=M.action)==null?void 0:(F=c.actionMetadata)==null?void 0:F.retryScheduleIntervalsInSeconds)||[1,2,4];F=1;M.retryScheduleIndex<J.length&&(F=J[M.retryScheduleIndex]);M.T=F*1E3+Date.now();M.retryScheduleIndex++}return g.B(N,UrG(a,x),0)})},mrn=function(a){var x;
return g.R(function(y){if(y.T==1)return g.B(y,p8(a.B,"offlineOrchestrationActionWrapperEntity"),2);x=y.B;return g.B(y,RDn(a,x),0)})},gjD=function(a,x){x.length!==0&&x.forEach(function(y){y=w6(y);
y.retryScheduleIndex<3&&lA7(a.T,[y])})},YzY=function(a,x){var y;
return g.R(function(D){if(D.T==1)return g.B(D,p8(a.B,"offlineOrchestrationActionWrapperEntity",x),2);y=D.B;return D.return(y.filter(lq7))})},UrG=function(a,x){if(x.length===0)return Promise.resolve([]);
x=x.map(function(y){return CK(y)});
return CuG(a.B,x)},HtV=function(a){this.R7=a;
this.T=void 0},itF=function(a,x){var y,D,M,N;
return g.R(function(F){y=x.videoId;D=!0;if(x.captionTracks.length)M=eOs(x),a.T=new g.qM(a.R7,x,M);else if(x.O6)N=g.k2T(x),a.T=new g.ZI(a.R7,x.O6,y,N,x.z$,x.eventId),D=x.z$;else return F.return();return F.return(new Promise(function(c){var J;(J=a.T)==null||J.DF({mu:function(){return g.R(function(G){if(G.T==1)return g.B(G,a.mu(y,D),2);c();g.Fh(G)})},
eh:function(){}})}))})},OtY=function(a){var x;
return g.R(function(y){if(y.T==1)return g.B(y,ECF(a),2);x=y.B;return y.return(!!x&&x.length>0)})},RO=function(a){g.A.call(this);
this.T=a;this.B=this.T.observe(this.J.bind(this))},Vd7=function(a,x){var y,D,M,N,F,c,J;
return g.R(function(G){switch(G.T){case 1:if(x.length===0)return G.return([]);y=x.map(function(Q){return g.HP(Q,"transfer")});
return g.B(G,p8(a.T,"transfer",y),2);case 2:D=G.B;M=D.filter(lq7).map(function(Q){return g.UL(Q.key).entityId});
N=x.filter(function(Q){return M.indexOf(Q)===-1});
if(N.length===0)return G.return([]);F=g.W(N);c=F.next();case 3:if(c.done){G.WJ(5);break}J=c.value;return g.B(G,ojG(J),4);case 4:c=F.next();G.WJ(3);break;case 5:return G.return(N)}})},XOL=function(a,x,y,D,M,N){var F,c,J;
return g.R(function(G){F="STREAM_TYPE_UNKNOWN";y.video&&y.audio?(F="STREAM_TYPE_AUDIO_AND_VIDEO",yX("unexpected stream type")):y.video&&!y.audio?F="STREAM_TYPE_VIDEO":!y.video&&y.audio&&(F="STREAM_TYPE_AUDIO");c=g.HP(x,"offlineVideoStreams");J={numBytesDownloaded:M.toFixed(),numTotalBytes:N.toFixed(),streamType:F,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(D),itag:F==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(y.itag):void 0};return g.B(G,tr(a,{mode:"readwrite",yn:!0},
function(Q){var S=Ar(Q,c,"offlineVideoStreams"),K=Ar(Q,g.HP(x,"transfer"),"transfer");return g.n3.all([S,K]).then(function(L){L=g.W(L);var w=L.next().value;L=L.next().value;if(!L)return Oc(Q,c).then(function(){});
var Z=rep(w);w=tdn(w,D,J,c);var v=ic(Q,w,"offlineVideoStreams");rep(w)>Z&&(L.lastProgressTimeMs=Date.now().toString());Z=[v];L.offlineVideoStreams||(L.offlineVideoStreams=[]);L.offlineVideoStreams.indexOf(c)===-1&&(L.offlineVideoStreams.push(c),Z.push(ic(Q,L,"transfer")));return g.n3.all(Z)})}),0)})},btp=function(a,x){var y,D,M,N,F;
return g.R(function(c){if(c.T==1)return y=g.HP(x,"offlineVideoStreams"),g.B(c,bc(a,y,"offlineVideoStreams"),2);D=c.B;if(!D||!D.streamsProgress)return c.return();M=g.W(D.streamsProgress);for(N=M.next();!N.done;N=M.next())F=N.value,F.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",F.numTotalBytes!==F.numBytesDownloaded&&(F.numBytesDownloaded=F.numTotalBytes);return g.B(c,XY(a,D,"offlineVideoStreams"),0)})},tdn=function(a,x,y,D){if(a&&a.streamsProgress){D=a;
a:{x=x.itag+";"+x.xtags;for(var M=a.streamsProgress,N=0;N<M.length;N++){var F=JSON.parse(M[N].formatStreamBytes);if(F.itag+";"+F.xtags===x){M[N]=y;y=M;break a}}M.push(y);y=M}D.streamsProgress=y}else a={key:D,streamsProgress:[y]};return a},rep=function(a){if(a==null?0:a.streamsProgress){var x=0;
a=a.streamsProgress;for(var y=0;y<a.length;y++){var D=a[y];isNaN(Number(D.numBytesDownloaded))?yX("stream progress bytes number invalid"):x+=Number(D.numBytesDownloaded)}return x}return 0},pOY=function(a,x,y,D){g.A.call(this);
var M=this;this.B=a;this.api=x;this.Cc=y;this.dS=D;this.D=new g.VR;this.U=new g.Id(function(){M.T&&M.T.transferState==="TRANSFER_STATE_TRANSFERRING"&&M.D.nK()&&((M.T.transferRetryCount||0)<3?fK(M.Y,M.N,!1,!1):$N(M.Y,M.N.videoDetails.videoId),M.s5("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.cJ=this.UJ=0;this.BJ=this.V=!1;this.Gt=g.ts(this.api.j().experiments,"html5_transfer_processing_logs_interval");this.e8=new g.zW(this);this.uO={qrJ:function(){return M.U},
NGJ:function(){return M.dS},
Vq:function(){return M.D}};
this.tP=this.B.observe(this.I2.bind(this));this.Y=new ceL(x,this);this.YG=new HtV(x);this.OJ=new RO(this.B);this.N1=this.D.listen("publicytnetworkstatus-online",this.k7.bind(this));this.yP=this.D.listen("publicytnetworkstatus-offline",this.UmY.bind(this));this.BJ=this.api.j().C("html5_less_transfer_processing_logs");g.U(this,this.e8);this.e8.Z(x,"offlinetransferpause",this.WI7);if(g.xY(this.api.j()))this.J="mainVideoDownloadStateEntity";else if(g.f9(this.api.j())||g.je(this.api.j()))this.J="musicTrackDownloadMetadataEntity"},
IAh=function(a){return g.R(function(x){if(x.T==1)x=g.B(x,m$p(),2);
else{var y=a.OJ;var D=g.fO();D=Object.keys(D);y=Vd7(y,D);x=g.B(x,y,0)}return x})},A2=function(a,x){x=x===void 0?!1:x;
var y;return g.R(function(D){if(D.T==1){if(a.T)throw Error("Already downloading a video");a.cJ=0;a.V=!1;return g.B(D,eDL(a),2)}return D.T!=4?(y=D.B,xRp(a.Cc,!y),y&&a.D.nK()?x?g.B(D,new Promise(function(M){g.dx(M,1E3)}),4):D.WJ(4):(!y&&a.T&&YN(a),D.WJ(0))):g.B(D,ayJ(a,y),0)})},xnn=function(a){return g.R(function(x){if(x.T==1)return a.N?g.B(x,$N(a.Y,a.N.videoDetails.videoId),3):x.WJ(0);
YN(a);g.Fh(x)})},yD7=function(a,x){var y,D,M;
return g.R(function(N){switch(N.T){case 1:return g.cJ(N,2),(y=!!x.captionTracks.length||!!x.O6)?g.B(N,OtY(x.videoId),4):N.return();case 4:return(D=N.B)?N.return():g.B(N,itF(a.YG,x),5);case 5:g.GL(N,0);break;case 2:M=g.Qn(N),yX("Caption downloading error",M,x.cotn),g.Fh(N)}})},ayJ=function(a,x){var y,D,M,N,F,c;
return g.R(function(J){switch(J.T){case 1:if(a.V)return J.return();a.V=!0;a.T=x;y=g.UL(a.T.key);D=y.entityId;M=void 0;if(a.T.transferState==="TRANSFER_STATE_TRANSFERRING")return g.B(J,Uq(a,D),7);if(a.T.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||a.T.transferRetryCount||a.T.hasLoggedFirstStarted){J.WJ(3);break}return g.B(J,Uq(a,D),5);case 5:return M=J.B,a.T.hasLoggedFirstStarted=!0,g.B(J,j7n(a),6);case 6:jpt({videoId:D,CZ:a.T,offlineModeType:M},void 0,void 0,!0);J.WJ(3);break;case 7:M=J.B,
F$({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:D,CZ:a.T,offlineModeType:M});case 3:return g.B(J,Dnh(a),8);case 8:return N=null,g.cJ(J,9),g.B(J,MUY(a,x),11);case 11:N=J.B;a.N=N;g.GL(J,10);break;case 9:return F=g.Qn(J),yX("error getting player response",F,x.cotn),g.B(J,a.s5("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return J.return();case 10:return c=ozh(a.api.j(),x.cotn,N),g.B(J,yD7(a,c),13);case 13:return g.B(J,JeD(c.videoId),
14);case 14:c.Yr=J.B;var G=a.Y,Q=c,S=x.maximumDownloadQuality;Q.getPlayerResponse();g.YY(Q.videoId,2);G.J=2;G.B=!1;var K;(K=G.player)==null||K.dispose();G.player=G.api.aE(Q);Q={};G.player.ev((Q.localmediachange=G.fL,Q.signatureexpired=G.Ml,Q.statechange=G.rKS,Q),G);G.C("html5_generate_content_po_token")&&G.player.Bh();S=G.SX(S);G.player.gC(g.mw(S,S,!0,"m"),!1);G.player.xQ(!1);a.U.start(108E5);g.Fh(J)}})},eDL=function(a){var x,y;
return g.R(function(D){if(D.T==1)return g.B(D,p8(a.B,"transfer"),2);x=D.B;y=x.filter(NT7).sort(Fsh);return y.length===0?D.return():D.return(y[0])})},Dnh=function(a){var x,y,D;
return g.R(function(M){if(M.T==1){if(!a.T)return Hp(a,"onTransferStart"),M.return();a.U.start(108E5);return g.B(M,iO(a,"TRANSFER_STATE_TRANSFERRING"),2)}x=a.T;return(D=((y=x)==null?0:y.key)?g.UL(x.key).entityId:"")&&a.J?g.B(M,G0(D,a.J,a.B,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):M.WJ(0)})},QXp=function(a){var x,y,D,M;
g.R(function(N){switch(N.T){case 1:if(!a.T){Hp(a,"onTransferPausedByUser");N.WJ(2);break}x=a.T;a.U.stop();return g.B(N,iO(a,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:D=((y=x)==null?0:y.key)?g.UL(x.key).entityId:"";if(!D||!a.J){N.WJ(4);break}return g.B(N,G0(D,a.J,a.B,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.B(N,Uq(a,D),6);case 6:M=N.B,MWG({videoId:D,CZ:x,offlineModeType:M});case 2:YN(a),A2(a),g.Fh(N)}})},Szh=function(a){var x,y,D;
g.R(function(M){if(M.T==1){if(!a.T)return Hp(a,"onTransferPausedByNetwork"),M.return();a.U.stop();return g.B(M,iO(a,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(M.T!=3)return x=a.T,(D=((y=x)==null?0:y.key)?g.UL(x.key).entityId:"")&&a.J?g.B(M,G0(D,a.J,a.B,"DOWNLOAD_STATE_PAUSED"),3):M.WJ(3);YN(a);g.Fh(M)})},zn7=function(a){var x,y,D,M,N;
g.R(function(F){switch(F.T){case 1:if(!a.T)return Hp(a,"onTransferComplete"),F.return();x=a.T;a.U.stop();if(!x||!a.N){F.WJ(2);break}y=ozh(a.api.j(),x.cotn,a.N);return g.B(F,yD7(a,y),2);case 2:return g.B(F,iO(a,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:M=((D=x)==null?0:D.key)?g.UL(x.key).entityId:"";if(!M||!a.J){F.WJ(5);break}return g.B(F,G0(M,a.J,a.B,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.B(F,btp(a.B,M),7);case 7:return g.B(F,Uq(a,M),8);case 8:N=F.B,F$({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:M,CZ:x,offlineModeType:N}),YN(a),A2(a),g.Fh(F)}})},cDG=function(a,x,y){var D,M;
g.R(function(N){switch(N.T){case 1:if(!a.T)return Hp(a,"onTransferProgress: "+x),N.return();if(a.T.transferState==="TRANSFER_STATE_TRANSFERRING"){N.WJ(2);break}return g.B(N,Dnh(a),2);case 2:D=Date.now();if(!(D-a.UJ>1E3)){N.WJ(4);break}a.UJ=D;return g.B(N,XOL(a.B,y.videoId,y.B,y.Yl,y.bytesDownloaded,y.T),5);case 5:if(a.BJ&&!(a.BJ&&D-a.cJ>a.Gt)){N.WJ(4);break}a.cJ=D;return g.B(N,Uq(a,x),7);case 7:M=N.B,jpt({videoId:x,CZ:a.T,offlineModeType:M},y.bytesDownloaded,y.T);case 4:a.U.start(108E5),g.Fh(N)}})},
oe7=function(a){var x=(a.T.transferRetryCount||0)<3;
x&&(a=a.T,a.transferRetryCount=(a.transferRetryCount||0)+1);return x},JDV=function(a,x){x=x===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":x;
var y,D,M,N;return g.R(function(F){if(F.T==1)return a.T||Hp(a,"setTransferToFailed: "+x),y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x==="TRANSFER_FAILURE_REASON_NETWORK"?y="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":x==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.B(F,iO(a,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",x),2);if(F.T!=3)return D3(a.dS,{entityKey:(D=a.T)==null?void 0:D.key,failureReason:y}),
M=a.T?g.UL(a.T.key).entityId:"",g.B(F,Uq(a,M),3);N=F.B;var c={videoId:M,CZ:a.T,offlineModeType:N},J=x,G={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};J&&(G.transferFailureReason=J,G.failureReason=NyD(J));F$(G,c);g.Fh(F)})},iO=function(a,x,y,D){var M;
return g.R(function(N){if(N.T==1){if(!a.T)return Hp(a,"saveTransferState: "+x),N.return();a.T.transferState=x;a.T.failureReason=D;g.cJ(N,2);return g.B(N,j7n(a,function(F){return y?Uc(F,"offlineVideoStreams",a.T.offlineVideoStreams).then(function(c){for(var J=g.W(c),G=J.next();!G.done;G=J.next())if((G=G.value)&&G.streamsProgress){G=g.W(G.streamsProgress);for(var Q=G.next();!Q.done;Q=G.next())Q.value.streamState=y}return cGh(F,c.filter(function(S){return!!S}),"offlineVideoStreams")}):g.n3.resolve(void 0)}),
4)}if(N.T!=2)return g.GL(N,0);
M=g.Qn(N);return M instanceof g.SD&&M.type==="QUOTA_EXCEEDED"?g.B(N,a.s5("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):N.WJ(0)})},j7n=function(a,x){var y;
return g.R(function(D){if(!a.T)return D.return();y=a.T;return g.B(D,tr(a.B,{mode:"readwrite",yn:!0},function(M){var N=[ic(M,y,"transfer")];x&&N.push(x(M));return g.n3.all(N)}),0)})},YN=function(a){a.T=void 0;
a.N=void 0;a.U.stop()},MUY=function(a,x){var y,D,M,N,F;
return g.R(function(c){if(c.T==1)return y=g.UL(x.key),D=y.entityId,M=g.HP(D,"playbackData"),g.B(c,bc(a.B,M,"playbackData"),2);N=c.B;if((F=N)==null?0:F.playerResponseJson)return c.return(JSON.parse(N.playerResponseJson));throw Error("No PlayerResponse found");})},Hp=function(a,x){a.api.AP("woffle",{mcte:x});
yX("missing current transfer entity.")},Uq=function(a,x){var y,D,M;
return g.R(function(N){if(N.T==1)return g.B(N,bc(a.B,g.HP(x,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);y=N.B;return N.return((M=(D=y)==null?void 0:D.offlineModeType)!=null?M:void 0)})},NT7=function(a){return GJY[a.transferState]!==void 0},Fsh=function(a,x){var y=GJY[a.transferState],D=GJY[x.transferState];
return y!==D?y-D:Number(a.enqueuedTimestampMs)-Number(x.enqueuedTimestampMs)},Oq=function(a,x){var y=this;
this.S=a;this.api=x;this.D=new g.VR;this.N=new g.Gw;this.uO={uj:function(){return y.J.uO.uj()},
Vq:function(){return y.D},
hWt:function(){return y.J},
s2:function(){return y.s2()},
Kb:function(){return y.Kb()},
Bd:function(){return y.Bd()},
JF:function(){return y.JF()},
m$:function(){return y.m$()},
c_:function(D){return y.c_(D)}};
this.J=new p9F(function(){return Q7y(y)},function(){y.Bd()},this.api.SZ(),this.api.C.bind(this.api));
this.T=new jg(this.api);Iqn(this.J)},Q7y=function(a){return g.R(function(x){a.api.uY("onOrchestrationBecameLeader");
return g.B(x,a.Kb(),0)})},KsL=function(a){var x,y;
return g.R(function(D){if(D.T==1)return g.B(D,IY(),2);if(D.T!=3){x=D.B;if(!x)return yX("PES is undefined"),D.return();a.B=new pOY(x,a.api,a.J,a.T);y=a.qf(x);return g.B(D,EjJ(x,y,a.J,a.T,a.S),3)}a.Y=D.B;return g.B(D,SIJ(a),0)})},SIJ=function(a){var x;
return g.R(function(y){switch(y.T){case 1:if(!a.B)return yX("transferManager is undefined"),y.return();if(a.B.T){y.WJ(2);break}return g.B(y,A2(a.B),2);case 2:if(!a.S.C("woffle_enable_main_downloads_library")){y.WJ(4);break}return g.B(y,a.jr(),4);case 4:if(!a.S.C("html5_offline_playback_position_sync")){y.WJ(6);break}return g.B(y,a.TK(),7);case 7:return g.B(y,a.c_(864E5),6);case 6:return g.B(y,a.refreshAllStaleEntities(43200,!0),9);case 9:return g.B(y,a.GX(),10);case 10:if(!a.S.C("html5_retry_downloads_for_expiration")){y.WJ(11);
break}return g.B(y,a.m$(),11);case 11:return a.V=g.Zf(function(){a.refreshAllStaleEntities(43200,!0);a.GX()},9E5),g.ew(g.xd(),function(){return a.JF()}),g.B(y,IY(),13);
case 13:return x=y.B,g.B(y,bDP(x),14);case 14:ev7(a.J),g.Fh(y)}})},Lsh=function(){var a,x,y,D,M,N;
return g.R(function(F){switch(F.T){case 1:return g.B(F,IY(),2);case 2:a=F.B;if(!a)return F.return([]);x=Date.now()/1E3;return g.B(F,p8(a,"offlineVideoPolicy"),3);case 3:y=F.B,D=g.W(y),M=D.next();case 4:if(M.done){F.WJ(6);break}N=M.value;if(!(N.expirationTimestamp&&Number(N.expirationTimestamp)<x)){F.WJ(5);break}N.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";N.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.B(F,XY(a,N,"offlineVideoPolicy"),5);
case 5:M=D.next();F.WJ(4);break;case 6:return F.return(y.map(function(c){return c.key}))}})},VX=function(a,x,y,D,M){var N,F,c;
return g.R(function(J){if(J.T==1)return g.B(J,IY(),2);N=J.B;if(!N)return J.return([]);F=x.map(function(G){var Q=g.HP(G,y);Q={actionType:D,entityKey:Q,actionMetadata:Object.assign({},JXp(),M)};D!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(Q.actionMetadata.priority=0);G=new LK(y,G,Q);return CK(G)});
c=CuG(N,F);Iqn(a.J);return J.return(c)})},w0L=function(a,x,y,D){var M,N,F,c,J,G,Q,S;
return g.R(function(K){switch(K.T){case 1:M=[],N=g.W(x),F=N.next();case 2:if(F.done){K.WJ(4);break}c=F.value;if(c.upToDate||y&&!c.shouldAutoSyncMetadata||!c.playlistId){K.WJ(3);break}J={};switch(D){case "mainPlaylistEntity":G={nextAutoRefreshIntervalSeconds:c.checkInSeconds,autoSync:y};J={mainPlaylistEntityActionMetadata:G};break;case "musicPlaylist":Q={autoSync:y},J={musicPlaylistEntityActionMetadata:Q}}return g.B(K,VX(a,[c.playlistId],D,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",J),6);case 6:(S=
K.B)&&M.push.apply(M,g.tS(S));case 3:F=N.next();K.WJ(2);break;case 4:return K.return(M)}})},CTG=function(a,x){var y;
return g.R(function(D){return x.length?(y=JXp(),g.fy(y,Bp,{isEnqueuedForExpiredStreamUrlRefetch:!0}),a.api.AP("qrd",{v:x.length}),D.return(VX(a,x,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",y))):D.return([])})},qIG=function(a,x,y){this.T=a;
this.S=x;this.J=y},nep=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K,L,w,Z,v,m,u;
return g.R(function(E){switch(E.T){case 1:return y=z0(x),D=g.UL(x.entityKey),M=D.entityId,N=[],g.cJ(E,2),g.B(E,dnp(a,M),4);case 4:N=E.B;if(!(a.S.C("woffle_enable_main_downloads_library")&&((F=N)==null?0:F.length))){E.WJ(5);break}return g.B(E,Pzp(a.T,[x.entityKey]),5);case 5:g.GL(E,3);break;case 2:return c=g.Qn(E),J="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.SD&&c.type==="QUOTA_EXCEEDED"?(J="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):yX("Playlist add error"),E.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,J,G));case 3:Q=[];if(!a.S.C("html5_offline_prevent_redownload_downloaded_video")){E.WJ(7);break}return g.B(E,cXP(a.T,"mainVideoEntity",N),8);case 8:N=E.B;case 7:if((S=N)==null?0:S.length)for(K=g.W(N),L=K.next();!L.done;L=K.next())if(w=L.value,Z=w.offlineVideoData,v=void 0,(v=Z)==null?0:v.videoId)m=void 0,u=Number(((m=x.actionMetadata)==null?void 0:m.priority)||
0)+1,Q.push(Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Z.videoId,"mainVideoEntity",u,r6,ZBn(x,Z,M)));return E.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,Q))}})},PTF=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K,L,w,Z,v,m,u,E,h,V,H,j6,e,as,z7,Qq,DJ,nz,yn,oP,zL,Xl,fz,yg,ht,k,p7,tt,ch,WJ,P,xG,nh,cX,ph,Jb,b1,aP,k2,l,n,T,f,X,Fl,p,r,Y,ET,sT,qC,m7,DD,kG,ie,$2,bF,Wh,U$,Bh,vJ,AS,vW,TL;
return g.R(function(IP){switch(IP.T){case 1:return y=z0(x),D=x.entityKey,M=g.UL(D).entityId,N=[],F=!1,M==="!*$_ALL_ENTITIES_!*$"?(F=!0,g.B(IP,p8(a.T,"mainPlaylistEntity"),5)):g.B(IP,bc(a.T,D,"mainPlaylistEntity"),4);case 4:(c=IP.B)&&N.push(c);IP.WJ(3);break;case 5:N=IP.B;case 3:if((J=N)==null||!J.length)return IP.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));G=g.q(x.actionMetadata,veY);S=(Q=G)==null?void 0:Q.nextAutoRefreshIntervalSeconds;L=(K=G)==null?void 0:K.autoSync;w=[];v=Z=
!0;m=!1;if(!F&&L===!1){IP.WJ(6);break}g.cJ(IP,7);return g.B(IP,RjV(0,!!L,!0,N),9);case 9:w=IP.B;g.GL(IP,8);break;case 7:u=g.Qn(IP);if(!(u instanceof Error&&u.message==="No data")){u instanceof Error&&u.message==="Empty response body"&&yX(u.message);IP.WJ(8);break}return M==="!*$_ALL_ENTITIES_!*$"?g.B(IP,CzJ(a.T,x,a.J,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.B(IP,L6h(M,a.T,x,a.J),8);case 8:if(!w.length||!F&&w[0].playlistId!==M)return IP.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y));case 6:if(F){E=[];h=g.W(w);for(V=h.next();!V.done;V=h.next())H=V.value,H.upToDate||L&&!H.shouldAutoSyncMetadata||!H.playlistId||(j6={nextAutoRefreshIntervalSeconds:H.checkInSeconds,autoSync:L},E.push(Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",H.playlistId,"mainPlaylistEntity",0,r6,{mainPlaylistEntityActionMetadata:j6})));return IP.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,E))}w.length&&(e=w[0],m=!!e.upToDate,L&&(Z=(as=e.shouldAutoSyncMetadata)!=null?as:!0,v=(z7=e.shouldAutoSyncVideos)!=
null?z7:!0,e.checkInSeconds&&(S=e.checkInSeconds)));if(m||!Z)return IP.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));Qq=[];DJ=N[0];if(!DJ.downloadState){nz=void 0;IP.WJ(15);break}return g.B(IP,bc(a.T,DJ.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:nz=IP.B;case 15:return yn=nz,zL=((oP=yn)==null?0:oP.addedTimestampMillis)?String(yn.addedTimestampMillis):void 0,g.cJ(IP,17),g.B(IP,dnp(a,M,zL,S),19);case 19:Qq=IP.B;g.GL(IP,18);break;case 17:Xl=g.Qn(IP);if(!(Xl instanceof
Error&&Xl.message==="No data for playlist")){if(Xl instanceof Error&&Xl.message==="Empty response body for playlist")yX(Xl.message);else return fz="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",yg="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Xl instanceof g.SD&&Xl.type==="QUOTA_EXCEEDED"&&(fz="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",yg="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),IP.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,fz,yg));
IP.WJ(18);break}return g.B(IP,L6h(M,a.T,x,a.J),18);case 18:if(!v)return IP.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));ht=[];k=new Map;if((p7=Qq)==null?0:p7.length)for(tt=g.W(Qq),ch=tt.next();!ch.done;ch=tt.next())WJ=ch.value,P=WJ.offlineVideoData,xG=void 0,((xG=P)==null?0:xG.videoId)&&k.set(P.videoId,P);nh=new Map;cX=[];if((ph=DJ)==null?0:(Jb=ph.videos)==null?0:Jb.length)for(b1=g.W(DJ.videos),aP=b1.next();!aP.done;aP=b1.next())if(k2=aP.value,l=JSON.parse(g.UL(k2).entityId),n=
l.videoId)k.has(n)?(nh.set(n,k.get(n)),k.delete(n)):cX.push(n);f=Number(((T=x.actionMetadata)==null?void 0:T.priority)||0)+1;X=g.W(k.entries());for(Fl=X.next();!Fl.done;Fl=X.next())p=Fl.value,r=g.W(p),Y=r.next().value,ET=r.next().value,sT=Y,qC=ET,ht.push(Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",sT,"mainVideoEntity",f,r6,ZBn(x,qC,M)));m7=g.W(nh.entries());for(DD=m7.next();!DD.done;DD=m7.next())kG=DD.value,ie=g.W(kG),$2=ie.next().value,bF=ie.next().value,Wh=$2,U$=bF,ht.push(Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Wh,"mainVideoEntity",f,r6,ZBn(x,U$,M)));Bh=g.W(cX);for(vJ=Bh.next();!vJ.done;vJ=Bh.next())AS=vJ.value,vW={playlistId:M},TL={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:vW},ht.push(Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",AS,"mainVideoEntity",0,r6,TL));return IP.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,ht))}})},TTs=function(a,x){var y,D,M,N;
return g.R(function(F){switch(F.T){case 1:return y=z0(x),g.cJ(F,2),D=g.UL(x.entityKey).entityId,D==="!*$_ALL_ENTITIES_!*$"?g.B(F,CzJ(a.T,x,a.J,(M=x.actionMetadata)==null?void 0:(N=M.offlineLoggingData)==null?void 0:N.offlineDeleteReason),5):g.B(F,L6h(D,a.T,x,a.J),6);case 6:if(!a.S.C("woffle_enable_main_downloads_library")){F.WJ(5);break}return g.B(F,TyG(a.T,x.entityKey),5);case 5:g.GL(F,3);break;case 2:return g.Qn(F),F.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return F.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y))}})},dnp=function(a,x,y,D){var M,N,F,c,J,G,Q;
return g.R(function(S){switch(S.T){case 1:return g.B(S,feL([x]),2);case 2:return M=S.B,g.B(S,lyy(a,M[0],y,D),3);case 3:return N=S.B,F=N.mainPlaylistEntity,c=N.bJP,G=SHY(F,(J=c)==null?void 0:J.avatar),g.cJ(S,4),g.B(S,d6(G),6);case 6:g.GL(S,5);break;case 4:Q=g.Qn(S),Q instanceof Error&&Q.message==="Failed to fetch"&&yX(Q.message);case 5:return S.return(M[0].videos)}})},lyy=function(a,x,y,D){var M,N,F,c,J,G,Q,S,K,L,w,Z,v,m,u,E,h;
return g.R(function(V){switch(V.T){case 1:M=Date.now().toString();y||(y=M);N=x.videos;F=x.playlistId;c=[];J=[];if(N)for(G=g.W(N),Q=G.next();!Q.done;Q=G.next()){S=Q.value;K=S.offlineVideoData;if(!K||!K.videoId)throw yX("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");L=K.videoId;w={videoId:L,playlistId:F};Z={id:g.HP(JSON.stringify(w),"mainPlaylistVideoEntity"),video:g.HP(L,"mainVideoEntity")};c.push(Z);J.push(Z.id)}m={key:g.HP(F,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:y,lastSyncedTimestampMillis:M};u={key:g.HP(F,"mainPlaylistEntity"),playlistId:F,videos:J,title:x.title,thumbnailStyleData:kJY(x),visibility:uxP(x),downloadState:m.key};x.channel&&(E=x.channel.offlineChannelData,v=mnh(g.HP(F,"ytMainChannelEntity"),E),u.channelOwner=v.id);((h=u)==null?0:h.entityMetadata)?(u.entityMetadata.offlineLastModifiedTimestampSeconds=x.lastModifiedTimestamp,D&&(u.entityMetadata.nextAutoRefreshIntervalSeconds=String(D))):u&&(u.entityMetadata={nextAutoRefreshIntervalSeconds:D?
String(D):void 0,offlineLastModifiedTimestampSeconds:x.lastModifiedTimestamp});g.cJ(V,2);return g.B(V,tr(a.T,{mode:"readwrite",yn:!0},function(H){var j6=ic(H,u,"mainPlaylistEntity"),e=ic(H,m,"mainPlaylistDownloadStateEntity");j6=[j6,e];e=g.W(c);for(var as=e.next();!as.done;as=e.next())j6.push(ic(H,as.value,"mainPlaylistVideoEntity"));v&&j6.push(ic(H,v,"ytMainChannelEntity"));return g.n3.all(j6)}),4);
case 4:g.GL(V,3);break;case 2:throw g.Qn(V),yX("PES failure for playlist"),Error("PES failure for playlist");case 3:return V.return({mainPlaylistEntity:u,bJP:v,vt7:c})}})},mnh=function(a,x){return{id:a,
channelId:x.channelId,title:x.title,avatar:x.thumbnail}},kJY=function(a){var x=[],y=a.videos;
y&&y.length>0&&x.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:y[0].offlineVideoData.thumbnail}}});if((a=a.additionalMetadadatas)&&a.length>0)for(a=g.W(a),y=a.next();!y.done;y=a.next()){var D=y.value.offlineBundleItemPlaylistData,M=void 0;y=(M=D)==null?void 0:M.style;M=void 0;D={collageThumbnail:{coverThumbnail:(M=D)==null?void 0:M.coverThumbnail}};switch(y){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":x.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:D});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":x.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:D});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":x.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:D});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":x.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:D})}}return x},uxP=function(a){switch(a.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},ZBn=function(a,x,y){x={offlineVideoData:x,
playlistId:y};if(a=g.q(a.actionMetadata,veY))x.maximumDownloadQuality=a.maximumDownloadQuality;return{mainVideoEntityActionMetadata:x}},Wsp=function(a,x,y){this.T=a;
this.S=x;this.J=y},BT7=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K,L,w;
return g.R(function(Z){switch(Z.T){case 1:return y=z0(x),D=g.UL(x.entityKey),M=D.entityId,N=g.q(x.actionMetadata,t2),c=!((F=N)==null?0:F.playlistId),g.cJ(Z,2),g.B(Z,Eet(a,M,void 0,(J=N)==null?void 0:J.offlineVideoData,c),4);case 4:g.GL(Z,3);break;case 2:return G=g.Qn(Z),Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.SD&&G.type==="QUOTA_EXCEEDED"&&(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Z.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,Q,S));case 3:K=1;K=Number(((L=x.actionMetadata)==null?void 0:L.priority)||0)+1;var v=(v=g.q(x.actionMetadata,t2))?{playbackDataActionMetadata:{maximumDownloadQuality:v.maximumDownloadQuality}}:void 0;w=Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M,"playbackData",K,s7s,v);return Z.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,[w]))}})},hnV=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K,L,w,Z,v,m,u;
return g.R(function(E){switch(E.T){case 1:return y=z0(x),D=g.UL(x.entityKey),M=D.entityId,g.B(E,bc(a.T,x.entityKey,"mainVideoEntity"),2);case 2:N=E.B;if(!N){F=void 0;E.WJ(3);break}return g.B(E,bc(a.T,N.downloadState,"mainVideoDownloadStateEntity"),4);case 4:F=E.B;case 3:c=F;if(!N||!c)return E.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));g.cJ(E,5);return g.B(E,Eet(a,M,c.addedTimestampMillis,(G=g.q(x.actionMetadata,t2))==null?void 0:G.offlineVideoData),7);case 7:Q=1;Q=Number(((S=
x.actionMetadata)==null?void 0:S.priority)||0)+1;J=Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",M,"playbackData",Q,s7s);g.GL(E,6);break;case 5:K=g.Qn(E);if(!(K instanceof Error&&K.message==="No data")){if(K instanceof Error&&K.message==="Empty response body")yX(K.message);else return L="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",K instanceof g.SD&&K.type==="QUOTA_EXCEEDED"&&(L="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
w="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),E.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,L,w));E.WJ(6);break}return g.B(E,vp(a.T,M),9);case 9:Z=E.B;v=g.q(x.actionMetadata,t2);if(u=(m=v)==null?void 0:m.playlistId)Z.playlistId=u;Z.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.B(E,Z3(M,a.T,x,a.J,Z),6);case 6:return E.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,J?[J]:void 0))}})},$nL=function(a,x){var y,D,M,N,F,c,J,G,Q,S;
return g.R(function(K){switch(K.T){case 1:return y=z0(x),g.cJ(K,2),D=g.UL(x.entityKey).entityId,D==="!*$_ALL_ENTITIES_!*$"?g.B(K,CzJ(a.T,x,a.J,(Q=x.actionMetadata)==null?void 0:(S=Q.offlineLoggingData)==null?void 0:S.offlineDeleteReason),5):g.B(K,vp(a.T,D),6);case 6:M=K.B;N=g.q(x.actionMetadata,t2);if(c=(F=N)==null?void 0:F.playlistId)M.playlistId=c;M.offlineDeleteReason=(J=x.actionMetadata)==null?void 0:(G=J.offlineLoggingData)==null?void 0:G.offlineDeleteReason;return g.B(K,Z3(D,a.T,x,a.J,M),7);
case 7:if(!a.S.C("woffle_enable_main_downloads_library")){K.WJ(5);break}return g.B(K,TyG(a.T,x.entityKey),5);case 5:g.GL(K,3);break;case 2:return g.Qn(K),K.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return K.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y))}})},Eet=function(a,x,y,D,M){var N,F,c,J,G,Q;
return g.R(function(S){switch(S.T){case 1:if(N=D){S.WJ(2);break}return g.B(S,$Rt([x]),3);case 3:F=S.B,N=F[0];case 2:return g.B(S,fyV(a,N,y,M),4);case 4:c=S.B;J=c.mainVideoEntity;G=c.channelEntity;g.cJ(S,5);var K=KK(J.thumbnail),L=KK(G.avatar);return g.B(S,d6(K.concat(L)),7);case 7:g.GL(S,0);break;case 5:Q=g.Qn(S),Q instanceof Error&&Q.message==="Failed to fetch"&&yX(Q.message),g.Fh(S)}})},fyV=function(a,x,y,D){var M,N,F,c,J,G,Q,S,K,L,w,Z,v;
return g.R(function(m){switch(m.T){case 1:y||(y=Date.now().toString());N=(M=x.channel)==null?void 0:M.offlineChannelData;F={id:g.HP(x.videoId,"ytMainChannelEntity"),channelId:N.channelId,title:N.title,avatar:N.thumbnail};c={key:g.HP(x.videoId,"mainVideoDownloadStateEntity"),playbackData:g.HP(x.videoId,"playbackData"),addedTimestampMillis:y,videoDownloadContextEntity:g.HP(x.videoId,"videoDownloadContextEntity")};J={key:g.HP(x.videoId,"videoPlaybackPositionEntity"),videoId:x.videoId,lastPlaybackPositionSeconds:"0"};
a.S.C("html5_offline_playback_position_sync")&&(G={playbackPosition:J.key});Q=g.HP(x.videoId,"mainVideoEntity");S={key:Q,videoId:x.videoId,title:x.title,thumbnail:x.thumbnail,localizedStrings:{viewCount:x.shortViewCountText},userState:G,lengthSeconds:x.lengthSeconds?Number(x.lengthSeconds):void 0,publishedTimestampMillis:x.publishedTimestamp?(Number(x.publishedTimestamp)*1E3).toString():void 0,formattedDescription:x.description,owner:F.id,downloadState:c.key};if(!a.S.C("woffle_enable_main_downloads_library")||
!D){m.WJ(2);break}return g.B(m,vzF(a.T,[Q]),3);case 3:if(w=m.B)K=w.mainDownloadsLibraryEntity,L=w.mainDownloadsListEntity;case 2:return v=zjD,Z={key:g.HP(x.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.fy(c,v,Z),g.B(m,tr(a.T,{mode:"readwrite",yn:!0},function(u){var E=ic(u,F,"ytMainChannelEntity"),h=ic(u,c,"mainVideoDownloadStateEntity"),V=ic(u,S,"mainVideoEntity");E=[E,h,V];a.S.C("html5_offline_playback_position_sync")&&(h=ic(u,J,"videoPlaybackPositionEntity"),
E.push(h));K&&(h=ic(u,K,"mainDownloadsLibraryEntity"),E.push(h));L&&(h=ic(u,L,"mainDownloadsListEntity"),E.push(h));Z&&(u=ic(u,Z,"downloadStatusEntity"),E.push(u));return g.n3.all(E)}),4);
case 4:return m.return({mainVideoEntity:S,channelEntity:F})}})},geh=function(a,x,y){this.T=a;
this.S=x;this.J=y},YID=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K,L,w,Z,v,m,u,E,h,V,H,j6,e,as,z7,Qq,DJ;
return g.R(function(nz){switch(nz.T){case 1:return y=z0(x),D=[],g.B(nz,gF.getInstance(),2);case 2:M=nz.B;if(!M){nz.WJ(3);break}return g.B(nz,M.get("sdois"),4);case 4:return N=nz.B,g.B(nz,(c=M)==null?void 0:c.get("lmqf"),5);case 5:F=nz.B;case 3:g.cJ(nz,6);if(N===void 0)throw Error("prefStorage or opt-in state is undefined");J=[];if(N){nz.WJ(8);break}return g.B(nz,nzL(a.T),9);case 9:J=nz.B,J.reverse();case 8:if(!J.length){nz.WJ(10);break}G=g.W(J);Q=G.next();case 11:if(Q.done){nz.WJ(10);break}S=Q.value;
if(!S){nz.WJ(12);break}K=g.UL(S).entityId;return g.B(nz,vp(a.T,K),14);case 14:return L=nz.B,L.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.B(nz,Z3(K,a.T,{entityKey:S,actionType:x.actionType},a.J,L),12);case 12:Q=G.next();nz.WJ(11);break;case 10:return g.B(nz,AXF(N,(w=F)!=null?w:"SD"),16);case 16:return Z=nz.B,g.B(nz,qHD(Z),17);case 17:v=Zjh(Z);if(!a.S.C("woffle_enable_main_downloads_library")){nz.WJ(18);break}if(N){nz.WJ(19);break}return g.B(nz,TyG(a.T,g.hw),19);case 19:return g.B(nz,
Pzp(a.T,[g.hw]),18);case 18:if((m=v)==null?0:m.length)for(u=g.W(v),E=u.next();!E.done;E=u.next())if(V=h=E.value,H=V.actionType,j6=V.entityKey,e=V.actionMetadata,H&&j6&&e&&!g.q(e,Rnt)){H==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(e.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(as=g.q(h.actionMetadata,t2))as.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",h.actionMetadata=Object.assign({},h.actionMetadata,{mainVideoEntityActionMetadata:as});D.push(h)}g.GL(nz,
7);break;case 6:return z7=g.Qn(nz),Qq="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",DJ="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",z7 instanceof g.SD&&z7.type==="QUOTA_EXCEEDED"&&(Qq="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",DJ="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),nz.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,Qq,DJ));case 7:return nz.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,D))}})},ADP=function(){Oq.apply(this,
arguments);
this.BJ="mainVideoEntity"},Unh=function(a,x,y){x=x===void 0?43200:x;
y=y===void 0?!0:y;var D=D===void 0?!1:D;var M,N,F;return g.R(function(c){switch(c.T){case 1:if(!a.D.nK())return c.return([]);M=[];g.cJ(c,2);return g.B(c,RjV(x,y,D),4);case 4:M=c.B;g.GL(c,3);break;case 2:N=g.Qn(c),N instanceof Error&&N.message==="No data"||N instanceof Error&&N.message==="Empty response body"&&yX(N.message);case 3:return F=w0L(a,M,y,"mainPlaylistEntity"),c.return(F)}})},HBG=function(a,x,y,D){D=D===void 0?!1:D;
var M,N,F,c,J,G,Q,S,K,L,w,Z,v,m,u;return g.R(function(E){switch(E.T){case 1:return M=[],g.B(E,YHY(),2);case 2:return(N=E.B)||D?g.B(E,URJ(x,y),3):E.return([]);case 3:F=E.B;if((c=F)==null||!c.length)return E.return([]);J={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};G=g.W(F);Q=G.next();case 4:if(Q.done){E.WJ(6);break}K=S=Q.value;L=K.actionType;w=K.entityKey;Z=K.actionMetadata;if(!(L&&w&&Z)||g.q(Z,Rnt)){E.WJ(5);break}L==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Z.offlineLoggingData=
J);v=g.UL(w);m=v.entityId;return g.B(E,VX(a,[m],"mainVideoEntity",L,Z),8);case 8:u=E.B,M=M.concat(u);case 5:Q=G.next();E.WJ(4);break;case 6:return E.return(M)}})},iBp=function(a,x){this.T=a;
this.J=x},VUp=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K,L,w,Z,v,m;
return g.R(function(u){switch(u.T){case 1:return y=z0(x),D=g.UL(x.entityKey),M=D.entityId,N=[],g.cJ(u,2),g.B(u,OBh(a,M),4);case 4:N=u.B;if((F=N)==null||!F.length){u.WJ(5);break}return g.B(u,W67(a.T,x.entityKey),5);case 5:g.GL(u,3);break;case 2:return c=g.Qn(u),J="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.SD&&c.type==="QUOTA_EXCEEDED"&&(J="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
u.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,J,G));case 3:return Q=[],g.B(u,cXP(a.T,"musicTrack",N),7);case 7:N=u.B;if(N.length)for(S=g.W(N),K=S.next();!K.done;K=S.next())if(L=K.value,w=L.offlineVideoData,Z=void 0,(Z=w)==null?0:Z.videoId)v=void 0,m=Number(((v=x.actionMetadata)==null?void 0:v.priority)||0)+1,Q.push(Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",w.videoId,"musicTrack",m,X$,kN(x,w,M)));return u.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,Q))}})},
rDJ=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K,L,w,Z,v,m,u,E,h,V,H,j6,e,as,z7,Qq,DJ,nz,yn,oP,zL,Xl,fz,yg,ht,k,p7,tt,ch,WJ,P,xG,nh,cX,ph,Jb,b1,aP,k2,l,n,T,f,X,Fl,p,r,Y,ET;
return g.R(function(sT){switch(sT.T){case 1:return y=z0(x),D=x.entityKey,M=g.UL(D).entityId,N=[],F=!1,M==="!*$_ALL_ENTITIES_!*$"?(F=!0,g.B(sT,p8(a.T,"musicAlbumRelease"),5)):g.B(sT,bc(a.T,D,"musicAlbumRelease"),4);case 4:(c=sT.B)&&N.push(c);sT.WJ(3);break;case 5:N=sT.B;case 3:if((J=N)==null||!J.length)return sT.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));if(F){G=[];Q=g.W(N);for(S=Q.next();!S.done;S=Q.next())K=S.value,L=g.UL(K.id).entityId,G.push(Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
L,"musicAlbumRelease",0,X$));return sT.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,G))}w=[];Z=N[0];v=void 0;if(!Z.downloadMetadata){sT.WJ(6);break}return g.B(sT,bc(a.T,Z.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:m=sT.B,v=Number((E=(u=m)==null?void 0:u.addedTimestampMillis)!=null?E:"0")/1E3;case 6:return g.cJ(sT,8),g.B(sT,OBh(a,M,(h=v)==null?void 0:h.toString()),10);case 10:w=sT.B;g.GL(sT,9);break;case 8:V=g.Qn(sT);if(!(V instanceof Error&&V.message===
"No data")){if(V instanceof Error&&V.message==="Empty response body")yX(V.message);else return H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",j6="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",V instanceof g.SD&&V.type==="QUOTA_EXCEEDED"&&(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",j6="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),sT.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,H,j6));sT.WJ(9);break}return g.B(sT,T0(M,"musicAlbumRelease",
a.T,x,a.J),9);case 9:e=[];as=new Map;if((z7=w)==null?0:z7.length)for(Qq=g.W(w),DJ=Qq.next();!DJ.done;DJ=Qq.next())nz=DJ.value,yn=nz.offlineVideoData,oP=void 0,((oP=yn)==null?0:oP.videoId)&&as.set(yn.videoId,yn);zL=new Map;Xl=[];if((fz=Z)==null?0:(yg=fz.tracks)==null?0:yg.length)for(ht=g.W(Z.tracks),k=ht.next();!k.done;k=ht.next())if(p7=k.value,tt=g.UL(p7).entityId)as.has(tt)?(zL.set(tt,as.get(tt)),as.delete(tt)):Xl.push(tt);WJ=Number(((ch=x.actionMetadata)==null?void 0:ch.priority)||0)+1;P=g.W(as.entries());
for(xG=P.next();!xG.done;xG=P.next())nh=xG.value,cX=g.W(nh),ph=cX.next().value,Jb=cX.next().value,b1=ph,aP=Jb,e.push(Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",b1,"musicTrack",WJ,X$,kN(x,aP)));k2=g.W(zL.entries());for(l=k2.next();!l.done;l=k2.next())n=l.value,T=g.W(n),f=T.next().value,X=T.next().value,Fl=f,p=X,e.push(Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Fl,"musicTrack",WJ,X$,kN(x,p)));r=g.W(Xl);for(Y=r.next();!Y.done;Y=r.next())ET=Y.value,e.push(Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
ET,"musicTrack",0,X$));return sT.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,e))}})},tUh=function(a,x){var y,D;
return g.R(function(M){switch(M.T){case 1:return y=z0(x),g.cJ(M,2),D=g.UL(x.entityKey).entityId,D==="!*$_ALL_ENTITIES_!*$"?g.B(M,lO(a.T,x,a.J),5):g.B(M,T0(D,"musicAlbumRelease",a.T,x,a.J),6);case 6:return g.B(M,Ezt(a.T,x.entityKey),5);case 5:g.GL(M,3);break;case 2:return g.Qn(M),M.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return M.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},OBh=function(a,x,y){var D,M,N;
return g.R(function(F){switch(F.T){case 1:return g.B(F,feL([x]),2);case 2:return D=F.B,g.B(F,X07(a,D[0],y),3);case 3:return M=F.B,N=KK(M.thumbnailDetails),g.B(F,d6(N),4);case 4:return F.return(D[0].videos)}})},X07=function(a,x,y){var D,M,N,F,c,J,G,Q,S,K,L,w,Z,v;
return g.R(function(m){if(m.T==1){D=x.additionalMetadadatas;M=void 0;if(D&&D.length>0)for(N=g.W(D),F=N.next();!F.done;F=N.next())if(c=F.value,c.offlineMusicPlaylistData){M=c.offlineMusicPlaylistData;break}J=x.playlistId;G=spV(x);Q=G.g_;S=G.qj;K=y?(Number(y)*1E3).toString():Date.now().toString();L=x.lastModifiedTimestamp?(Number(x.lastModifiedTimestamp)*1E3).toString():"0";w={id:g.HP(J,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:S,lastModifiedTimestampMillis:L,addedTimestampMillis:K,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};Z={id:g.HP(J,"musicAlbumRelease"),title:x.title,audioPlaylistId:J,trackCount:x.totalVideoCount,tracks:Q,downloadMetadata:w.id};M&&(Z.thumbnailDetails=(v=M.albumHqThumbnail)!=null?v:M.albumArtistThumbnail,Z.artistDisplayName=M.albumArtistDisplayName,Z.releaseDate=M.albumReleaseDate,Z.contentRating={explicitType:M.albumReleaseExplicitType},Z.releaseType=M.albumReleaseType);return g.B(m,tr(a.T,{mode:"readwrite",yn:!0},function(u){var E=ic(u,Z,"musicAlbumRelease");
u=ic(u,w,"musicAlbumReleaseDownloadMetadataEntity");return g.n3.all([E,u])}),2)}return m.return(Z)})},bBF=function(a,x){this.T=a;
this.J=x},IyG=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K,L,w,Z,v,m;
return g.R(function(u){switch(u.T){case 1:return y=z0(x),D=g.UL(x.entityKey),M=D.entityId,N=[],g.cJ(u,2),g.B(u,p0L(a,M),4);case 4:N=u.B;if((F=N)==null||!F.length){u.WJ(5);break}return g.B(u,W67(a.T,x.entityKey),5);case 5:g.GL(u,3);break;case 2:return c=g.Qn(u),J="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.SD&&c.type==="QUOTA_EXCEEDED"&&(J="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
u.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,J,G));case 3:return Q=[],g.B(u,cXP(a.T,"musicTrack",N),7);case 7:N=u.B;if(N.length)for(S=g.W(N),K=S.next();!K.done;K=S.next())if(L=K.value,w=L.offlineVideoData,Z=void 0,(Z=w)==null?0:Z.videoId)v=void 0,m=Number(((v=x.actionMetadata)==null?void 0:v.priority)||0)+1,Q.push(Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",w.videoId,"musicTrack",m,bO,kN(x,w,M)));return u.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,Q))}})},
ent=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K,L,w,Z,v,m,u,E,h,V,H,j6,e,as,z7,Qq,DJ,nz,yn,oP,zL,Xl,fz,yg,ht,k,p7,tt,ch,WJ,P,xG,nh,cX,ph,Jb,b1,aP,k2,l,n,T,f,X,Fl,p,r,Y,ET,sT,qC,m7,DD,kG,ie,$2,bF,Wh,U$,Bh,vJ;
return g.R(function(AS){switch(AS.T){case 1:return y=z0(x),D=x.entityKey,M=g.UL(D).entityId,N=[],F=!1,M==="!*$_ALL_ENTITIES_!*$"?(F=!0,g.B(AS,p8(a.T,"musicPlaylist"),5)):g.B(AS,bc(a.T,D,"musicPlaylist"),4);case 4:(c=AS.B)&&N.push(c);AS.WJ(3);break;case 5:N=AS.B;case 3:if((J=N)==null||!J.length)return AS.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));G=g.q(x.actionMetadata,Byt);S=(Q=G)==null?void 0:Q.autoSync;K=[];w=L=!0;Z=!1;v=void 0;if(!F&&S===!1){AS.WJ(6);break}g.cJ(AS,7);return g.B(AS,
Hjt(0,!!S,!0,N),9);case 9:K=AS.B;g.GL(AS,8);break;case 7:m=g.Qn(AS);if(!(m instanceof Error&&m.message==="No data")){m instanceof Error&&m.message==="Empty response body"&&yX(m.message);AS.WJ(8);break}return M==="!*$_ALL_ENTITIES_!*$"?g.B(AS,lO(a.T,x,a.J),8):g.B(AS,T0(M,"musicPlaylist",a.T,x,a.J),8);case 8:if(!K.length||!F&&K[0].playlistId!==M)return AS.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));case 6:if(F){u=[];E=g.W(K);for(h=E.next();!h.done;h=E.next())V=h.value,V.upToDate||
S&&!V.shouldAutoSyncMetadata||!V.playlistId||(H={autoSync:S},u.push(Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",V.playlistId,"musicPlaylist",0,bO,{musicPlaylistEntityActionMetadata:H})));return AS.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,u))}K.length&&(j6=K[0],Z=!!j6.upToDate,S&&(L=(e=j6.shouldAutoSyncMetadata)!=null?e:!0,w=(as=j6.shouldAutoSyncVideos)!=null?as:!0,j6.checkInSeconds&&(v=j6.checkInSeconds)));if(Z||!L)return AS.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y));z7=[];Qq=N[0];DJ=void 0;if(!Qq.downloadMetadata){AS.WJ(15);break}return g.B(AS,bc(a.T,Qq.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:nz=AS.B,DJ=Number((oP=(yn=nz)==null?void 0:yn.addedTimestampMillis)!=null?oP:"0")/1E3;case 15:return g.cJ(AS,17),g.B(AS,p0L(a,M,(zL=DJ)==null?void 0:zL.toString(),v),19);case 19:z7=AS.B;g.GL(AS,18);break;case 17:Xl=g.Qn(AS);if(!(Xl instanceof Error&&Xl.message==="No data")){if(Xl instanceof Error&&Xl.message==="Empty response body")yX(Xl.message);
else return fz="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",yg="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Xl instanceof g.SD&&Xl.type==="QUOTA_EXCEEDED"&&(fz="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",yg="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),AS.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,fz,yg));AS.WJ(18);break}return g.B(AS,T0(M,"musicPlaylist",a.T,x,a.J),18);case 18:if(!w)return AS.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y));ht=[];k=new Map;if((p7=z7)==null?0:p7.length)for(tt=g.W(z7),ch=tt.next();!ch.done;ch=tt.next())WJ=ch.value,P=WJ.offlineVideoData,xG=void 0,((xG=P)==null?0:xG.videoId)&&k.set(P.videoId,P);nh=new Map;cX=[];if((ph=Qq)==null?0:(Jb=ph.tracks)==null?0:Jb.length)for(b1=g.W(Qq.tracks),aP=b1.next();!aP.done;aP=b1.next())if(k2=aP.value,l=g.UL(k2).entityId)k.has(l)?(nh.set(l,k.get(l)),k.delete(l)):cX.push(l);T=Number(((n=x.actionMetadata)==null?void 0:n.priority)||0)+1;f=g.W(k.entries());for(X=f.next();!X.done;X=
f.next())Fl=X.value,p=g.W(Fl),r=p.next().value,Y=p.next().value,ET=r,sT=Y,ht.push(Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",ET,"musicTrack",T,bO,kN(x,sT)));qC=g.W(nh.entries());for(m7=qC.next();!m7.done;m7=qC.next())DD=m7.value,kG=g.W(DD),ie=kG.next().value,$2=kG.next().value,bF=ie,Wh=$2,ht.push(Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",bF,"musicTrack",T,bO,kN(x,Wh)));U$=g.W(cX);for(Bh=U$.next();!Bh.done;Bh=U$.next())vJ=Bh.value,ht.push(Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",vJ,"musicTrack",
0,bO));return AS.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,ht))}})},ams=function(a,x){var y,D;
return g.R(function(M){switch(M.T){case 1:return y=z0(x),g.cJ(M,2),D=g.UL(x.entityKey).entityId,D==="!*$_ALL_ENTITIES_!*$"?g.B(M,lO(a.T,x,a.J),5):g.B(M,T0(D,"musicPlaylist",a.T,x,a.J),6);case 6:return g.B(M,Ezt(a.T,x.entityKey),5);case 5:g.GL(M,3);break;case 2:return g.Qn(M),M.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return M.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},p0L=function(a,x,y,D){var M,N,F;
return g.R(function(c){switch(c.T){case 1:return g.B(c,feL([x]),2);case 2:return M=c.B,g.B(c,xN7(a,M[0],y,D),3);case 3:return N=c.B,F=KK(N.thumbnailDetails),g.B(c,d6(F),4);case 4:return c.return(M[0].videos)}})},xN7=function(a,x,y,D){var M,N,F,c,J,G,Q,S,K;
return g.R(function(L){return L.T==1?(M=x.playlistId,N=spV(x),F=N.g_,c=N.qj,J=y?(Number(y)*1E3).toString():Date.now().toString(),G=x.lastModifiedTimestamp?(Number(x.lastModifiedTimestamp)*1E3).toString():"0",Q={id:g.HP(M,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:c,lastModifiedTimestampMillis:G,addedTimestampMillis:J,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},S={id:g.HP(M,"musicPlaylist"),title:x.title,playlistId:M,thumbnailDetails:x.thumbnail,visibility:yCh(x),trackCount:x.totalVideoCount,
tracks:F,downloadMetadata:Q.id},D&&(((K=S)==null?0:K.entityMetadata)?S.entityMetadata.nextAutoRefreshIntervalSeconds=String(D):S&&(S.entityMetadata={nextAutoRefreshIntervalSeconds:String(D)})),g.B(L,tr(a.T,{mode:"readwrite",yn:!0},function(w){var Z=ic(w,S,"musicPlaylist");w=ic(w,Q,"musicPlaylistDownloadMetadataEntity");return g.n3.all([Z,w])}),2)):L.return(S)})},yCh=function(a){switch(a.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},jns=function(a,x){this.T=a;
this.J=x},FRY=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K,L,w;
return g.R(function(Z){switch(Z.T){case 1:return y=z0(x),D=g.UL(x.entityKey),M=D.entityId,N=g.q(x.actionMetadata,DND),g.cJ(Z,2),g.B(Z,MJY(a,M,void 0,(F=N)==null?void 0:F.track,(c=N)==null?void 0:c.albumRelease),4);case 4:if((J=N)==null?0:J.playlistId){Z.WJ(5);break}return g.B(Z,W67(a.T,x.entityKey),5);case 5:g.GL(Z,3);break;case 2:return G=g.Qn(Z),Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.SD&&G.type==="QUOTA_EXCEEDED"&&
(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Z.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,Q,S));case 3:L=Number(((K=x.actionMetadata)==null?void 0:K.priority)||0)+1;var v=(v=g.q(x.actionMetadata,DND))?{playbackDataActionMetadata:{maximumDownloadQuality:v.maximumDownloadQuality}}:void 0;w=Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M,"playbackData",L,NRD,v);return Z.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y,[w]))}})},zoV=function(a,x){var y,D,M,N,F,c,J,G,Q,S,K,L,w,Z,v;
return g.R(function(m){switch(m.T){case 1:return y=z0(x),D=g.UL(x.entityKey),M=D.entityId,g.B(m,bc(a.T,x.entityKey,"musicTrack"),2);case 2:N=m.B;if(!N){F=void 0;m.WJ(3);break}return g.B(m,bc(a.T,N.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:F=m.B;case 3:c=F;if(!N||!c)return m.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y));G=g.q(x.actionMetadata,DND);g.cJ(m,5);return g.B(m,MJY(a,M,c.addedTimestampMillis,(Q=G)==null?void 0:Q.track,(S=G)==null?void 0:S.albumRelease),
7);case 7:L=Number(((K=x.actionMetadata)==null?void 0:K.priority)||0)+1;J=Eq("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",M,"playbackData",L,NRD);g.GL(m,6);break;case 5:w=g.Qn(m);if(!(w instanceof Error&&w.message==="No data")){if(w instanceof Error&&w.message==="Empty response body")yX(w.message);else return Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.SD&&w.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
v="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),m.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,Z,v));m.WJ(6);break}return g.B(m,Pp(M,a.T,x,a.J),6);case 6:return m.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",y,J?[J]:void 0))}})},cCp=function(a,x){var y,D;
return g.R(function(M){switch(M.T){case 1:return y=z0(x),g.cJ(M,2),D=g.UL(x.entityKey).entityId,D==="!*$_ALL_ENTITIES_!*$"?g.B(M,lO(a.T,x,a.J),5):g.B(M,Pp(D,a.T,x,a.J),6);case 6:return g.B(M,Ezt(a.T,x.entityKey),5);case 5:g.GL(M,3);break;case 2:return g.Qn(M),M.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",y,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return M.return(new sq("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
y))}})},MJY=function(a,x,y,D,M){var N,F,c,J,G,Q;
return g.R(function(S){switch(S.T){case 1:if(N=D){S.WJ(2);break}return g.B(S,$Rt([x]),3);case 3:F=S.B,c=F[0],N=mRs(c);case 2:return g.B(S,oXh(a,N,x,M,y),4);case 4:J=S.B;G=J.musicTrackEntity;Q=J.RA;var K=KK(G.thumbnailDetails),L=[];Q&&(L=KK(Q.thumbnailDetails));return g.B(S,d6(K.concat(L)),0)}})},oXh=function(a,x,y,D,M){var N;
return g.R(function(F){return F.T==1?(M||(M=Date.now().toString()),N={id:g.HP(y,"musicTrackDownloadMetadataEntity"),playbackData:g.HP(y,"playbackData"),addedTimestampMillis:M,videoDownloadContextEntity:g.HP(y,"videoDownloadContextEntity")},D&&(x.albumRelease=D.id),g.B(F,tr(a.T,{mode:"readwrite",yn:!0},function(c){var J=[],G=ic(c,N,"musicTrackDownloadMetadataEntity");J.push(G);G=ic(c,x,"musicTrack");J.push(G);D&&(c=ic(c,D,"musicAlbumRelease"),J.push(c));return g.n3.all(J)}),2)):F.T!=3?g.B(F,G0(y,"musicTrackDownloadMetadataEntity",
a.T,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):F.return({musicTrackEntity:x,
RA:D})})},pK=function(){Oq.apply(this,arguments);
this.BJ="musicTrack"},JCh=function(a,x,y){x=x===void 0?43200:x;
y=y===void 0?!0:y;var D=D===void 0?!1:D;var M,N;return g.R(function(F){switch(F.T){case 1:if(!a.D.nK())return F.return([]);M=[];g.cJ(F,2);return g.B(F,Hjt(x,y,D),4);case 4:M=F.B;g.GL(F,3);break;case 2:g.Qn(F);case 3:return N=w0L(a,M,y,"musicPlaylist"),F.return(N)}})},GwV=function(){g.Lf.apply(this,arguments);
var a=this;this.events=new g.zW(this);this.S=this.player.j();this.uO={LES:function(){return a.T},
Dn:function(){return a.Dn()},
Mu:function(x){return a.Mu(x)}}},Qnh=function(a){var x;
a=g.q((x=a.getWatchNextResponse())==null?void 0:x.currentVideoEndpoint,g.Ny);if(a==null?0:a.playlistId)var y=a.playlistId;return y},S_J=function(a,x){var y,D,M,N;
return g.R(function(F){if(F.T==1){y=x.clientPlaybackNonce;D={cpn:y,offlineSourceVisualElement:g.wz(x.cJ||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};x.B&&(D.videoFmt=Number(x.B.itag));x.U&&(D.audioFmt=Number(x.U.itag));if((M=Qnh(x))&&x.videoId){var c=x.videoId;c=M!=="PPSV"?Promise.resolve(!1):a.T.WQ(c);F=g.B(F,c,3)}else F=F.WJ(2);return F}F.T!=2&&(N=F.B)&&(D.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");a.B=y;g.Ky("offlinePlaybackStarted",D);g.Fh(F)})};
g.uS.prototype.aE=g.YG(45,function(a){return this.app.aE(a)});
g.KF.prototype.aE=g.YG(44,function(a){return g.SZT(this,9,a)});
g.d($B,hr);g.OT.Object.defineProperties($B.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.T.entityMetadata},
set:function(a){this.T.entityMetadata=a}}});
g.d(xes,$B);xes.prototype.B=function(){return[]};
g.d(yJp,$B);yJp.prototype.B=function(){return[]};
g.d(jWp,$B);jWp.prototype.B=function(){return[]};
g.d(DeL,$B);DeL.prototype.B=function(){return[]};
g.d(McP,$B);McP.prototype.B=function(){return[]};
g.d(NL7,$B);NL7.prototype.B=function(){var a=[];this.T.alternateChannel&&a.push(this.T.alternateChannel);this.T.alternateChannelList&&a.push.apply(a,g.tS(this.T.alternateChannelList));this.T.oneofChannelEntity&&a.push(this.T.oneofChannelEntity);return[].concat(g.tS(new Set(a)))};
g.d(Frh,$B);Frh.prototype.B=function(){var a=[];this.T.entryCollection&&a.push(this.T.entryCollection);return[].concat(g.tS(new Set(a)))};
g.d(zQp,hr);zQp.prototype.B=function(){var a=[];this.T.video&&a.push(this.T.video);return[].concat(g.tS(new Set(a)))};
g.d(cJJ,$B);cJJ.prototype.B=function(){var a=[];this.T.parentPlaylist&&a.push(this.T.parentPlaylist);if(this.T.entries)for(var x=g.W(this.T.entries),y=x.next();!y.done;y=x.next())a.push.apply(a,g.tS((new zQp(y.value)).B()));return[].concat(g.tS(new Set(a)))};
g.d(ogy,$B);ogy.prototype.B=function(){var a=[];this.T.descriptionEntity&&a.push(this.T.descriptionEntity);this.T.creators&&a.push.apply(a,g.tS(this.T.creators));this.T.theBiggestFan&&a.push(this.T.theBiggestFan);return[].concat(g.tS(new Set(a)))};
g.d(JJD,$B);JJD.prototype.B=function(){return[]};
g.d(GAp,$B);GAp.prototype.B=function(){return[]};
g.d(QWh,$B);QWh.prototype.B=function(){return[]};
g.d(SFD,$B);SFD.prototype.B=function(){return[]};
g.d(KrL,$B);KrL.prototype.B=function(){return[]};
g.d(LrD,$B);LrD.prototype.B=function(){return[]};
g.d(wap,$B);wap.prototype.B=function(){return[]};
g.d(CfD,$B);CfD.prototype.B=function(){return[]};
g.d(qFY,$B);qFY.prototype.B=function(){return[]};
g.d(deF,$B);deF.prototype.B=function(){var a=[];this.T.downloadsList&&a.push(this.T.downloadsList);this.T.smartDownloadsList&&a.push(this.T.smartDownloadsList);this.T.recommendedDownloadsList&&a.push(this.T.recommendedDownloadsList);this.T.refresh&&a.push(this.T.refresh);return[].concat(g.tS(new Set(a)))};
g.d(Zds,hr);Zds.prototype.B=function(){var a=[];this.T.video&&a.push(this.T.video);this.T.playlist&&a.push(this.T.playlist);this.T.videoItem&&a.push(this.T.videoItem);this.T.playlistItem&&a.push(this.T.playlistItem);return[].concat(g.tS(new Set(a)))};
g.d(ngh,$B);ngh.prototype.B=function(){var a=[];this.T.refresh&&a.push(this.T.refresh);if(this.T.downloads)for(var x=g.W(this.T.downloads),y=x.next();!y.done;y=x.next())a.push.apply(a,g.tS((new Zds(y.value)).B()));return[].concat(g.tS(new Set(a)))};
g.d(vgG,$B);vgG.prototype.B=function(){var a=[];this.T.localImageEntities&&a.push.apply(a,g.tS(this.T.localImageEntities));return[].concat(g.tS(new Set(a)))};
g.d(Pfy,$B);Pfy.prototype.B=function(){var a=[];this.T.playbackData&&a.push(this.T.playbackData);this.T.localImageEntities&&a.push.apply(a,g.tS(this.T.localImageEntities));this.T.videoDownloadContextEntity&&a.push(this.T.videoDownloadContextEntity);return[].concat(g.tS(new Set(a)))};
g.d(TLG,$B);TLG.prototype.B=function(){return[]};
g.d(lNF,$B);lNF.prototype.B=function(){var a=[];this.T.fakeChildren&&a.push.apply(a,g.tS(this.T.fakeChildren));return[].concat(g.tS(new Set(a)))};
g.d(kAs,$B);kAs.prototype.B=function(){var a=[];this.T.video&&a.push(this.T.video);this.T.playbackData&&a.push(this.T.playbackData);this.T.offlineVideoPolicy&&a.push(this.T.offlineVideoPolicy);return[].concat(g.tS(new Set(a)))};
g.d(udJ,$B);udJ.prototype.B=function(){return[]};
g.d(meV,$B);meV.prototype.B=function(){var a=[];this.T.channelOwner&&a.push(this.T.channelOwner);this.T.videos&&a.push.apply(a,g.tS(this.T.videos));this.T.collaboratorChannels&&a.push.apply(a,g.tS(this.T.collaboratorChannels));this.T.downloadState&&a.push(this.T.downloadState);this.T.refresh&&a.push(this.T.refresh);return[].concat(g.tS(new Set(a)))};
g.d(Wrh,$B);Wrh.prototype.B=function(){var a=[];this.T.video&&a.push(this.T.video);this.T.channelContributor&&a.push(this.T.channelContributor);return[].concat(g.tS(new Set(a)))};
g.d(EgL,hr);EgL.prototype.B=function(){var a=[];this.T.localImageEntities&&a.push.apply(a,g.tS(this.T.localImageEntities));this.T.videoDownloadContextEntity&&a.push(this.T.videoDownloadContextEntity);return[].concat(g.tS(new Set(a)))};
g.d(sWL,hr);sWL.prototype.B=function(){var a=[];this.T.recommendedVideoMetadata&&a.push.apply(a,g.tS((new EgL(this.T.recommendedVideoMetadata)).B()));return[].concat(g.tS(new Set(a)))};
g.d(BLJ,hr);BLJ.prototype.B=function(){var a=[];this.T.playbackPosition&&a.push(this.T.playbackPosition);return[].concat(g.tS(new Set(a)))};
g.d(hQF,$B);hQF.prototype.B=function(){var a=[];this.T.owner&&a.push(this.T.owner);this.T.downloadState&&a.push(this.T.downloadState);this.T.userState&&a.push.apply(a,g.tS((new BLJ(this.T.userState)).B()));this.T.additionalMetadata&&a.push.apply(a,g.tS((new sWL(this.T.additionalMetadata)).B()));return[].concat(g.tS(new Set(a)))};
g.d($eV,$B);$eV.prototype.B=function(){var a=[];this.T.userChannelDetails&&a.push(this.T.userChannelDetails);return[].concat(g.tS(new Set(a)))};
g.d(fNy,$B);fNy.prototype.B=function(){var a=[];this.T.channelOwner&&a.push(this.T.channelOwner);this.T.playbackPosition&&a.push(this.T.playbackPosition);this.T.localImageEntities&&a.push.apply(a,g.tS(this.T.localImageEntities));this.T.downloadStatus&&a.push(this.T.downloadStatus);return[].concat(g.tS(new Set(a)))};
g.d(ggD,$B);ggD.prototype.B=function(){return[]};
g.d(RQV,$B);RQV.prototype.B=function(){return[]};
g.d(YFV,$B);YFV.prototype.B=function(){return[]};
g.d(AJt,$B);AJt.prototype.B=function(){return[]};
g.d(Uen,$B);Uen.prototype.B=function(){return[]};
g.d(HdF,$B);HdF.prototype.B=function(){return[]};
g.d(id7,$B);id7.prototype.B=function(){return[]};
g.d(OdD,$B);OdD.prototype.B=function(){return[]};
g.d(VcD,$B);VcD.prototype.B=function(){return[]};
g.d(rJL,$B);rJL.prototype.B=function(){return[]};
g.d(tct,$B);tct.prototype.B=function(){return[]};
g.d(Xap,$B);Xap.prototype.B=function(){return[]};
g.d(bdn,$B);bdn.prototype.B=function(){return[]};
g.d(pah,$B);pah.prototype.B=function(){var a=[];this.T.compositeSourceKeys&&a.push.apply(a,g.tS(this.T.compositeSourceKeys));return[].concat(g.tS(new Set(a)))};
g.d(INp,$B);INp.prototype.B=function(){var a=[];this.T.trackDownloadMetadatas&&a.push.apply(a,g.tS(this.T.trackDownloadMetadatas));return[].concat(g.tS(new Set(a)))};
g.d(eQn,$B);
eQn.prototype.B=function(){var a=[];this.T.downloadedTracks&&a.push.apply(a,g.tS(this.T.downloadedTracks));this.T.smartDownloadedTracks&&a.push.apply(a,g.tS(this.T.smartDownloadedTracks));this.T.downloadedEpisodes&&a.push.apply(a,g.tS(this.T.downloadedEpisodes));this.T.downloadedAlbumReleases&&a.push.apply(a,g.tS(this.T.downloadedAlbumReleases));this.T.smartDownloadedAlbumReleases&&a.push.apply(a,g.tS(this.T.smartDownloadedAlbumReleases));this.T.downloadedPlaylists&&a.push.apply(a,g.tS(this.T.downloadedPlaylists));this.T.smartDownloadedPlaylists&&
a.push.apply(a,g.tS(this.T.smartDownloadedPlaylists));this.T.metadataOnlyTracks&&a.push.apply(a,g.tS(this.T.metadataOnlyTracks));return[].concat(g.tS(new Set(a)))};
g.d(aWs,$B);aWs.prototype.B=function(){var a=[];this.T.trackDownloadMetadatas&&a.push.apply(a,g.tS(this.T.trackDownloadMetadatas));return[].concat(g.tS(new Set(a)))};
g.d(x3L,$B);x3L.prototype.B=function(){var a=[];this.T.playbackData&&a.push(this.T.playbackData);this.T.localImageEntities&&a.push.apply(a,g.tS(this.T.localImageEntities));this.T.videoDownloadContextEntity&&a.push(this.T.videoDownloadContextEntity);return[].concat(g.tS(new Set(a)))};
g.d(y4y,$B);y4y.prototype.B=function(){var a=[];this.T.musicLibraryStatusEntity&&a.push(this.T.musicLibraryStatusEntity);this.T.primaryArtists&&a.push.apply(a,g.tS(this.T.primaryArtists));this.T.details&&a.push(this.T.details);this.T.userDetails&&a.push(this.T.userDetails);this.T.tracks&&a.push.apply(a,g.tS(this.T.tracks));this.T.share&&a.push(this.T.share);this.T.downloadMetadata&&a.push(this.T.downloadMetadata);this.T.refresh&&a.push(this.T.refresh);return[].concat(g.tS(new Set(a)))};
g.d(jLn,$B);jLn.prototype.B=function(){var a=[];this.T.albumRelease&&a.push(this.T.albumRelease);this.T.tracks&&a.push.apply(a,g.tS(this.T.tracks));return[].concat(g.tS(new Set(a)))};
g.d(D3D,$B);D3D.prototype.B=function(){var a=[];this.T.albumRelease&&a.push(this.T.albumRelease);return[].concat(g.tS(new Set(a)))};
g.d(MyF,$B);MyF.prototype.B=function(){var a=[];this.T.details&&a.push(this.T.details);this.T.userDetails&&a.push(this.T.userDetails);return[].concat(g.tS(new Set(a)))};
g.d(NBh,$B);NBh.prototype.B=function(){var a=[];this.T.parentArtist&&a.push(this.T.parentArtist);return[].concat(g.tS(new Set(a)))};
g.d(FdJ,$B);FdJ.prototype.B=function(){var a=[];this.T.parentArtist&&a.push(this.T.parentArtist);return[].concat(g.tS(new Set(a)))};
g.d(zrh,$B);zrh.prototype.B=function(){return[]};
g.d(c4V,$B);c4V.prototype.B=function(){return[]};
g.d(ors,hr);ors.prototype.B=function(){var a=[];this.T.creatorEntity&&a.push(this.T.creatorEntity);return[].concat(g.tS(new Set(a)))};
g.d(J4s,$B);
J4s.prototype.B=function(){var a=[];this.T.tracks&&a.push.apply(a,g.tS(this.T.tracks));this.T.refresh&&a.push(this.T.refresh);this.T.musicLibraryStatusEntity&&a.push(this.T.musicLibraryStatusEntity);this.T.details&&a.push(this.T.details);this.T.downloadMetadata&&a.push(this.T.downloadMetadata);this.T.sideloadMetadata&&a.push(this.T.sideloadMetadata);this.T.userDetails&&a.push(this.T.userDetails);this.T.entryCollection&&a.push(this.T.entryCollection);this.T.share&&a.push(this.T.share);this.T.podcastShowAdditionalMetadata&&
a.push.apply(a,g.tS((new ors(this.T.podcastShowAdditionalMetadata)).B()));return[].concat(g.tS(new Set(a)))};
g.d(G_s,$B);G_s.prototype.B=function(){return[]};
g.d(QLt,$B);
QLt.prototype.B=function(){var a=[];this.T.musicLibraryStatusEntity&&a.push(this.T.musicLibraryStatusEntity);this.T.artists&&a.push.apply(a,g.tS(this.T.artists));this.T.audioModeVersion&&a.push(this.T.audioModeVersion);this.T.videoModeVersion&&a.push(this.T.videoModeVersion);this.T.userDetails&&a.push(this.T.userDetails);this.T.details&&a.push(this.T.details);this.T.albumRelease&&a.push(this.T.albumRelease);this.T.share&&a.push(this.T.share);this.T.libraryEdit&&a.push(this.T.libraryEdit);this.T.downloadMetadata&&
a.push(this.T.downloadMetadata);this.T.playbackPosition&&a.push(this.T.playbackPosition);this.T.lyrics&&a.push(this.T.lyrics);return[].concat(g.tS(new Set(a)))};
g.d(SSh,$B);SSh.prototype.B=function(){var a=[];this.T.parentTrack&&a.push(this.T.parentTrack);return[].concat(g.tS(new Set(a)))};
g.d(Kdy,$B);Kdy.prototype.B=function(){var a=[];this.T.parentTrack&&a.push(this.T.parentTrack);return[].concat(g.tS(new Set(a)))};
g.d(LdF,$B);LdF.prototype.B=function(){return[]};
g.d(wwp,$B);wwp.prototype.B=function(){return[]};
g.d(C6V,$B);C6V.prototype.B=function(){return[]};
g.d(qSG,$B);qSG.prototype.B=function(){return[]};
g.d(d3n,$B);d3n.prototype.B=function(){var a=[];this.T.transfer&&a.push(this.T.transfer);this.T.adsPlaybackData&&a.push.apply(a,g.tS(this.T.adsPlaybackData));this.T.drmLicense&&a.push(this.T.drmLicense);this.T.offlineVideoPolicy&&a.push(this.T.offlineVideoPolicy);this.T.videoDownloadContextEntity&&a.push(this.T.videoDownloadContextEntity);return[].concat(g.tS(new Set(a)))};
g.d(ZXh,$B);ZXh.prototype.B=function(){return[]};
g.d(nrP,$B);nrP.prototype.B=function(){var a=[];this.T.offlineVideoStreams&&a.push.apply(a,g.tS(this.T.offlineVideoStreams));this.T.captionTrack&&a.push.apply(a,g.tS(this.T.captionTrack));return[].concat(g.tS(new Set(a)))};
g.d(vrp,$B);vrp.prototype.B=function(){return[]};
g.d(P6p,$B);P6p.prototype.B=function(){return[]};
g.d(TBF,$B);TBF.prototype.B=function(){return[]};
g.d(lW7,$B);lW7.prototype.B=function(){return[]};
g.d(k_t,$B);k_t.prototype.B=function(){return[]};
g.d(uWs,$B);uWs.prototype.B=function(){return[]};
g.d(m3G,$B);m3G.prototype.B=function(){return[]};
g.d(Wdt,$B);Wdt.prototype.B=function(){return[]};
g.d(Ert,$B);Ert.prototype.B=function(){return[]};
g.d(sLL,$B);sLL.prototype.B=function(){return[]};
g.d(BB7,$B);BB7.prototype.B=function(){return[]};
g.d(hry,$B);hry.prototype.B=function(){return[]};
g.d($3F,$B);$3F.prototype.B=function(){return[]};
g.d(fWh,$B);fWh.prototype.B=function(){return[]};
g.d(grP,$B);grP.prototype.B=function(){return[]};
g.d(Rrt,$B);Rrt.prototype.B=function(){return[]};
g.d(YSL,$B);YSL.prototype.B=function(){return[]};
g.d(A4F,$B);A4F.prototype.B=function(){return[]};
g.d(U37,$B);U37.prototype.B=function(){return[]};
g.d(HXy,$B);HXy.prototype.B=function(){return[]};
g.d(iXp,$B);iXp.prototype.B=function(){return[]};
g.d(OXy,$B);OXy.prototype.B=function(){return[]};
var ijP=["browse","music/browse","streaming_browse","unplugged/browse"],XsY=["offline/playlist_sync_check"],hj7=["offline"],Ojt=["offline/offline_video_playback_position_sync"],rXP=["offline/get_playback_data_entity"],f8;gF.getInstance=function(){return g.R(function(a){return a.return(new Promise(function(x){g.x_().then(function(y){y?(gF.instance||(gF.instance=new gF(y)),x(gF.instance)):x(void 0)})}))})};
gF.prototype.get=function(a){var x=this,y,D,M;return g.R(function(N){if(N.T==1)return g.B(N,XwV(x.token),2);if(N.T!=3)return y=N.B,g.B(N,y.get("prefs",a),3);D=N.B;if(!D)return N.return();M=(0,g.lY)();return D.expirationTimestampMs<=M?N.return():N.return(D.value)})};
gF.prototype.set=function(a,x,y){y=y===void 0?31536E3:y;var D=this,M,N,F;return g.R(function(c){if(c.T==1)return M=(0,g.lY)(),N={key:a,value:x,expirationTimestampMs:M+y*1E3},g.B(c,XwV(D.token),2);F=c.B;return g.B(c,g.h5(F,"prefs",N),0)})};
gF.prototype.remove=function(a){var x=this,y;return g.R(function(D){if(D.T==1)return g.B(D,XwV(x.token),2);y=D.B;return g.B(D,y.delete("prefs",a),0)})};
g.d(RY,g.$G);g.d(YB,aqy);YB.prototype.J=function(a,x){x=yGP(x);a=(new TextEncoder).encode(JSON.stringify(a));return this.T.encrypt(a,x)};
YB.prototype.B=function(a,x){if(!(a instanceof Uint8Array))throw bX7(1);var y=new TextDecoder;x=yGP(x);a=this.T.decrypt(a,x);return JSON.parse(y.decode(a))};
var jHt={accountLinkStatusEntity:QWh,booleanEntity:DeL,buttonEntity:grP,captionTrack:LdF,channelHandle:xes,chipEntity:m3G,commerceAcquisitionClientPayloadEntity:YSL,commerceCartListEntity:A4F,compositeSourceEntity:bdn,multiviewStagingEntity:pah,contextNoteFeedEntityPayload:yJp,contextNoteUserRatingEntityPayload:jWp,continuationTokenEntity:udJ,downloadQualityPickerEntity:wap,downloadsPageRefreshTokenEntity:qFY,downloadsPageViewConfigurationEntity:ggD,downloadStatusEntity:CfD,dismissState:Wdt,sfvAudioItemCurrentlyPlayingEntity:lW7,
emojiFountainDataEntity:$3F,emojiCustomizationSetEntity:hry,fakeChannel:NL7,fakePlaylist:Frh,fakePlaylistEntryCollection:cJJ,fakeVideo:ogy,fakeVideoDescription:JJD,featuredProductsEntity:rJL,flowStateEntity:GAp,iconBadgeEntity:U37,interstitialInteractionStateEntity:KrL,likeButtonAnimationEntity:RQV,liveChatPollStateEntity:LrD,dataFreshnessEntity:BB7,liveViewerLeaderboardChatEntryPointStateEntity:P6p,liveViewerLeaderboardPointsEntity:TBF,liveReactionsDataEntity:fWh,logoEntity:SFD,macroMarkerEntity:YFV,
mainDownloadsLibraryEntity:deF,mainDownloadsListEntity:ngh,mainPlaylistDownloadStateEntity:vgG,mainPlaylistEntity:meV,mainPlaylistVideoEntity:Wrh,mainVideoDownloadStateEntity:Pfy,mainVideoEntity:hQF,markersEngagementPanelSyncEntity:AJt,markersVisibilityOverrideEntity:Uen,musicAlbumReleaseDetail:jLn,musicAlbumReleaseDownloadMetadataEntity:INp,musicAlbumRelease:y4y,musicAlbumReleaseUserDetail:D3D,musicArtistDetail:NBh,musicArtist:MyF,musicArtistUserDetail:FdJ,musicDownloadsLibraryEntity:eQn,musicLibraryEdit:zrh,
musicLibraryStatusEntity:c4V,musicPlaylist:J4s,musicPlaylistDownloadMetadataEntity:aWs,musicShare:G_s,musicTrackDetail:SSh,musicTrackDownloadMetadataEntity:x3L,musicTrack:QLt,musicTrackUserDetail:Kdy,offlineOrchestrationActionWrapperEntity:wwp,offlineVideoPolicy:C6V,offlineVideoStreams:qSG,offlineabilityEntity:TLG,orchestrationWebSamplingEntity:lNF,pageHeaderEntity:Ert,pdpStateEntity:HXy,pinnedProductEntity:tct,playbackData:d3n,playerStateEntity:HdF,quantityIncrementerEntity:iXp,refresh:ZXh,saveToPlaylistListEntity:k_t,
selectedChipIndexEntityPayload:id7,settingEntity:uWs,stringEntity:McP,suggestedFeedbackChipStateEntity:OdD,transfer:nrP,trendingOfferEntity:Xap,videoDownloadContextEntity:vrp,videoOverviewAsyncDataEntity:OXy,videoPlaybackPositionEntity:Rrt,votingEntity:sLL,ytMainChannelEntity:$eV,youchatPendingResponseEntity:VcD,ytMainDownloadedVideoEntity:kAs,ytMainVideoEntity:fNy};g.d(VO,aqy);VO.prototype.J=function(a){return a};
VO.prototype.B=function(a){if(a instanceof Uint8Array)throw bX7(0);return a};
g.d(rF,g.A);rF.prototype.observe=function(a){var x=this;this.observers.push(a);return function(){var y=x.observers.indexOf(a);y>=0&&x.observers.splice(y,1)}};
rF.prototype.B=function(a){w9n(this,a.data)};
rF.prototype.m6=function(){this.channel.close()};
var nCG,dRn=new g.hk("elementsCommand");var nK=new g.hk("entityBatchUpdate");var zjD=new g.hk("downloadStatusEntity");var veY=new g.hk("mainPlaylistEntityActionMetadata");var t2=new g.hk("mainVideoEntityActionMetadata");var Byt=new g.hk("musicPlaylistEntityActionMetadata");var DND=new g.hk("musicTrackEntityActionMetadata");var Rnt=new g.hk("localImageEntityActionMetadata");var Bp=new g.hk("playbackDataActionMetadata");var drh=new g.hk("transferEntityActionMetadata");var NIn=new g.hk("videoPlaybackPositionEntityActionMetadata");var gCt;new g.Gw;new g.Gw;HDh.prototype.request=function(a,x,y){x=x===void 0?{}:x;return this.locks.request(a,x,function(D){return y(D)})};var xN=g.lF.caches,aO,tpL;eG.prototype.open=function(a){return xN.open(VpP(a))};
eG.prototype.has=function(a){return xN.has(VpP(a))};
eG.prototype.delete=function(a){return xN.delete(VpP(a))};
eG.prototype.match=function(a,x){var y=this,D,M,N,F,c,J;return g.R(function(G){switch(G.T){case 1:return g.B(G,y.keys(),2);case 2:D=G.B,M=g.W(D),N=M.next();case 3:if(N.done){G.WJ(5);break}F=N.value;return g.B(G,y.open(F),6);case 6:return c=G.B,g.B(G,c.match(a,x),7);case 7:if(J=G.B)return G.return(J);N=M.next();G.WJ(3);break;case 5:return G.return()}})};
g.d(ODF,eG);ODF.prototype.keys=function(){var a,x,y,D,M,N,F,c,J;return g.R(function(G){if(G.T==1)return a=[],x=g.XQ("CacheStorage keys"),g.B(G,xN.keys(),2);y=G.B;D=g.W(y);for(M=D.next();!M.done;M=D.next()){N=M.value;var Q=N.indexOf(":");F=Q===-1?{eN:N}:{eN:N.substring(0,Q),datasyncId:N.substring(Q+1)};c=F.eN;J=F.datasyncId;J===x&&a.push(c)}return G.return(a)})};g.d(jg,g.A);jg.prototype.J=function(a){this.api.uY("onOfflineOperationFailure",a.data)};
jg.prototype.U=function(a){this.api.publish("offlinetransferpause",a.data)};
jg.prototype.m6=function(){var a;(a=this.T)==null||a.close();var x;(x=this.B)==null||x.close()};p9F.prototype.m4=function(){this.T&&MD(this)};
p9F.prototype.nX=function(){this.B&&this.B.resolve();this.J=this.T=!1;this.BJ()};var fA7=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var wst="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var uaV="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.d(pss,Wp);pss.prototype.B=function(a){return cp(a)?aAG(this,a):oO(a)?jXP(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};g.d(DrJ,Wp);DrJ.prototype.B=function(a){return oO(a)?Mdn(this,a):F6h(a)?FoF(this,a):J2(a)?zDJ(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};g.C=ceL.prototype;g.C.rKS=function(a){var x=this,y,D,M,N;return g.R(function(F){if(!g.t(a.state,128))return F.WJ(0);y=a.state.LK;var c=(D=y)==null?void 0:D.errorCode,J=(M=y)==null?void 0:M.PC;N=c==="net.connect"&&J===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(c==null?0:c.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.B(F,x.s5(x.player.getVideoData().videoId,N),0)})};
g.C.s5=function(a,x){var y=this;return g.R(function(D){if(D.T==1){if(y.B)return D.return();y.B=!0;return x==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(fK(y,a,!1,!0),D.WJ(0)):g.B(D,$N(y,a),3)}g.YY(a,4);return g.B(D,y.T.s5(x),0)})};
g.C.fL=function(a){a.status===2?(a.status!==this.J&&(Dnh(this.T),g.YY(a.videoId,2)),a.Sx&&cDG(this.T,a.videoId,a.Sx)):a.status===4?($N(this,a.videoId),this.s5(a.videoId,a.nC?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):a.status===1&&zn7(this.T);this.J=a.status;this.api.uY("localmediachange",{videoId:a.videoId,status:a.status})};
g.C.Ml=function(){var a=this,x;return g.R(function(y){if(y.T==1){if(a.B)return y.return();a.B=!0;x=a.player.getVideoData().videoId;return g.B(y,$N(a,x),2)}return g.B(y,a.T.Ml(),0)})};
g.C.SX=function(a){switch(a){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.C.C=function(a){return this.api.j().C(a)};g.d(KoV,Wp);KoV.prototype.B=function(a){return cp(a)?wOJ(this,a):oO(a)?CGL(this,a):F6h(a)?qzh(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};TIh.prototype.T=function(a,x){var y=a.action.actionMetadata.priority-x.action.actionMetadata.priority;y===0&&(a.T<x.T?y=-1:a.T>x.T&&(y=1));return y};g.d(g6,g.A);g6.prototype.m6=function(){this.BJ&&this.BJ();g.A.prototype.m6.call(this)};
g6.prototype.createAction=function(a,x){var y=g.UL(a.entityKey).entityType,D=g.ww(16);return new LK(y,D,a,x.actionId,x.rootActionId)};
g6.prototype.dS=function(a){var x=this,y,D,M,N,F,c,J,G,Q;return g.R(function(S){if(S.T==1){if(x.hP())return S.return();D=(y=a.offlineOrchestrationActionWrapperEntity)!=null?y:new Set;M=[];N=g.W(D);for(F=N.next();!F.done;F=N.next())c=F.value,J=g.UL(c),G=J.entityId,uvh(x.T,G)||M.push(c);return g.B(S,YzY(x,M),2)}Q=S.B;return g.B(S,RDn(x,Q),0)})};
g6.prototype.retry=function(){var a=this;return g.R(function(x){return g.B(x,Ae7(a),0)})};HtV.prototype.mu=function(a,x){x=x===void 0?!0:x;var y=this,D,M,N,F,c,J,G,Q;return g.R(function(S){switch(S.T){case 1:if(!y.T)return S.return();D=[];M=g.bn(y.T.T,x);N=[];for(F={X5:0};F.X5<M.length;F={X5:F.X5},F.X5++)c=M[F.X5],J=y.T.Rl(c,"json3"),G=g.hY(J,{withCredentials:!0,format:"RAW"},3,500).then(function(K){return function(L){L={metadata:g.ZV(M[K.X5]),trackData:L.xhr.responseText};N.push(L)}}(F)).KB(function(K){yX("Caption fetch error",K)}),D.push(G);
return g.B(S,aNJ(D),2);case 2:return g.cJ(S,3),g.B(S,W8s(a,N),5);case 5:g.GL(S,0);break;case 3:Q=g.Qn(S),yX("Caption DB transaction error",Q),g.Fh(S)}})};g.d(RO,g.A);RO.prototype.m6=function(){this.B&&this.B();g.A.prototype.m6.call(this)};
RO.prototype.J=function(a){var x=this,y,D,M,N,F,c,J,G;return g.R(function(Q){D=(y=a.transfer)!=null?y:new Set;M=[];N=g.W(D);for(F=N.next();!F.done;F=N.next())c=F.value,J=g.UL(c),G=J.entityId,M.push(G);return M.length===0?Q.return():g.B(Q,Vd7(x,M),0)})};g.d(pOY,g.A);g.C=pOY.prototype;g.C.m6=function(){this.tP&&this.tP();this.OJ.dispose();this.U.dispose();this.N1&&g.Fx(this.D.g6,this.N1);this.yP&&g.Fx(this.D.g6,this.yP);g.A.prototype.m6.call(this)};
g.C.WI7=function(a){var x=this,y,D,M;return g.R(function(N){switch(N.T){case 1:y=g.HP(a,"transfer");if(x.T&&y===x.T.key){fK(x.Y,x.N,!0);x.U.stop();N.WJ(0);break}return g.B(N,tr(x.B,{mode:"readwrite",yn:!0},function(F){return Ar(F,y,"transfer").then(function(c){if(c&&c.transferState!=="TRANSFER_STATE_COMPLETE"&&c.transferState!=="TRANSFER_STATE_FAILED")return c.transferState="TRANSFER_STATE_PAUSED_BY_USER",ic(F,c,"transfer").then(function(){return c})})}),3);
case 3:D=N.B;if(!D){N.WJ(0);break}if(!a||!x.J){N.WJ(5);break}return g.B(N,G0(a,x.J,x.B,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.B(N,Uq(x,a),7);case 7:M=N.B,MWG({videoId:a,CZ:D,offlineModeType:M}),g.Fh(N)}})};
g.C.UmY=function(){var a=this;if(this.T&&this.N){fK(this.Y,this.N,!1);var x=this.T,y=(x==null?0:x.key)?g.UL(x.key).entityId:"";y&&this.J&&(new Promise(function(D,M){G0(y,a.J,a.B,"DOWNLOAD_STATE_PAUSED").catch(function(N){M(N)})})).catch(function(D){yX("Download state setting error",D)})}this.U.stop()};
g.C.k7=function(){this.T?ayJ(this,this.T):A2(this)};
g.C.I2=function(a){var x=this;return g.R(function(y){switch(y.T){case 1:if(!x.T){y.WJ(2);break}if(x.T.transferState==="TRANSFER_STATE_COMPLETE"||x.T.transferState==="TRANSFER_STATE_FAILED"||!a.transfer||!a.transfer.has(x.T.key)){y.WJ(3);break}return g.B(y,bc(x.B,x.T.key,"transfer"),4);case 4:x.T=y.B;if(x.T){y.WJ(3);break}return g.B(y,xnn(x),3);case 3:if(x.T)return y.return();case 2:return g.B(y,A2(x),0)}})};
g.C.s5=function(a,x){var y=this,D,M,N,F,c;return g.R(function(J){switch(J.T){case 1:if(!y.T){Hp(y,"onTransferFailure: "+a);J.WJ(2);break}D=y.T;N=((M=D)==null?0:M.key)?g.UL(D.key).entityId:"";a:switch(a){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var G=!1;break a;default:G=!0}return G&&oe7(y)?g.B(J,iO(y,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.B(J,
JDV(y,a),5);case 5:if(!N||!y.J){J.WJ(2);break}return g.B(J,G0(N,y.J,y.B,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.B(J,Uq(y,N),9);case 9:F=J.B;F$({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:N,CZ:D,offlineModeType:F});if(!N||!y.J){J.WJ(2);break}return g.B(J,G0(N,y.J,y.B,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:YN(y),c=A2(y,!0),x&&x(c),g.Fh(J)}})};
g.C.Ml=function(a){var x=this,y,D,M,N,F,c,J,G,Q,S,K,L;return g.R(function(w){switch(w.T){case 1:if(!x.T){Hp(x,"onMaybeTransferStreamsExpired");w.WJ(2);break}return oe7(x)?g.B(w,iO(x,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.B(w,JDV(x,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!x.J){w.WJ(2);break}y=x.T;M=((D=y)==null?0:D.key)?g.UL(y.key).entityId:"";if(!M){w.WJ(2);break}return g.B(w,G0(M,x.J,x.B,"DOWNLOAD_STATE_FAILED"),2);case 9:return x.T||Hp(x,"onMaybeTransferStreamsExpiredRetryAttempting"),
N=x.T,c=((F=N)==null?0:F.key)?g.UL(N.key).entityId:"",g.B(w,Uq(x,c),10);case 10:return J=w.B,F$({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:c,CZ:N,offlineModeType:J}),G=JXp(),g.fy(G,Bp,{isEnqueuedForExpiredStreamUrlRefetch:!0}),Q=g.HP(c,"playbackData"),S={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:Q,actionMetadata:G},K=CK(new LK("playbackData",c,S)),g.B(w,XY(x.B,K,"offlineOrchestrationActionWrapperEntity"),2);case 2:YN(x),L=A2(x,!0),
a&&a(L),g.Fh(w)}})};
var KRP={},GJY=(KRP.TRANSFER_STATE_TRANSFERRING=1,KRP.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,KRP);g.C=Oq.prototype;g.C.s2=function(){return this.N.promise};
g.C.Kb=function(){if(this.B&&this.Y)return this.N.promise;KsL(this).then(this.N.resolve).catch(this.N.reject);return this.N.promise};
g.C.qf=function(a){var x={};return x.playbackData=new pss(a,this.S,this.T),x.transfer=new KoV(a,this.S),x.videoPlaybackPositionEntity=new DrJ(a,this.S),x};
g.C.JF=function(){var a=this;return g.R(function(x){return a.B?g.B(x,IAh(a.B),0):x.WJ(0)})};
g.C.Bd=function(){var a=this,x,y;return g.R(function(D){if(D.T==1)return a.B||a.Y?g.B(D,a.s2(),2):D.return();a.V!==void 0&&(g.vm(a.V),a.V=void 0);a.U!==void 0&&(g.vm(a.U),a.U=void 0);(x=a.B)==null||x.dispose();a.B=void 0;(y=a.Y)==null||y.dispose();a.Y=void 0;a.api.uY("onOrchestrationLostLeader");a.N=new g.Gw;g.Fh(D)})};
g.C.isOrchestrationLeader=function(){return this.J.T};
g.C.WQ=function(){return g.R(function(a){return a.return(!1)})};
g.C.wN=function(a){var x=this.T;x.api.publish("offlinetransferpause",a);var y;(y=x.B)==null||y.postMessage(a)};
g.C.k7=function(a){var x,y;return g.R(function(D){if(D.T==1)return g.B(D,IY(),2);x=D.B;if(!x)return D.return();y=g.HP(a,"transfer");return g.B(D,tr(x,{mode:"readwrite",yn:!0},function(M){var N=Ar(M,y,"transfer"),F=Ar(M,g.HP(a,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.n3.all([N,F]).then(function(c){c=g.W(c);var J=c.next().value;var G=c.next().value;return J&&J.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(J.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",ic(M,J,"transfer").then(function(){F$({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:a,CZ:J,offlineModeType:G==null?void 0:G.offlineModeType});return g.n3.resolve(null)})):g.n3.resolve(null)})}),0)})};
g.C.gN=function(a){a=a===void 0?43200:a;var x=this,y,D,M,N,F,c,J,G;return g.R(function(Q){if(Q.T==1)return x.D.nK()?g.B(Q,IY(),2):Q.return(Lsh());if(Q.T!=3){y=Q.B;if(!y)return Q.return([]);D=Date.now()/1E3;return g.B(Q,p8(y,"offlineVideoPolicy"),3)}M=Q.B;N=[];F=g.W(M);for(c=F.next();!c.done;c=F.next())J=c.value,Number(J.lastUpdatedTimestampSeconds)+a<=D&&(G=g.UL(J.key).entityId,N.push(G));return N.length?Q.return(VX(x,N,x.BJ,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):Q.return([])})};
g.C.deleteAll=function(){return VX(this,["!*$_ALL_ENTITIES_!*$"],this.BJ,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.C.refreshAllStaleEntities=function(a){var x=this;return g.R(function(y){return y.T==1?g.B(y,x.gN(a),2):y.return(y.B)})};
g.C.setUpPositionSyncInterval=function(a){var x=this;this.U!==void 0&&(g.vm(this.U),this.U=void 0);var y=a!=null?a:864E5;this.U=g.Zf(function(){x.c_(y)},y)};
g.C.c_=function(a){var x=this,y,D,M,N,F,c;return g.R(function(J){switch(J.T){case 1:return g.cJ(J,2),g.B(J,gF.getInstance(),4);case 4:y=J.B;if(!y)throw Error("prefStorage is undefined");return g.B(J,y.get("psi"),5);case 5:D=J.B;N=((M=D)==null?0:M.F1)?Number(D.F1)/1E3:0;F=Date.now();if(!(N+a<=F)){J.WJ(6);break}return g.B(J,VX(x,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.GL(J,0);break;case 2:c=g.Qn(J),yX("Offline manager error",c),
g.Fh(J)}})};
g.C.m$=function(){var a=this,x,y,D,M,N,F,c;return g.R(function(J){if(J.T==1)return g.B(J,IY(),2);if(J.T!=3)return(x=J.B)?g.B(J,p8(x,"transfer"),3):J.return([]);y=J.B;D=[];M=g.W(y);for(N=M.next();!N.done;N=M.next())F=N.value,F.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&F.key&&(c=g.UL(F.key).entityId,D.push(c));return J.return(CTG(a,D))})};
g.C.GX=function(){return g.R(function(a){return a.return([])})};
g.C.jr=function(){return g.R(function(a){g.Fh(a)})};
g.C.TK=function(){return g.R(function(a){g.Fh(a)})};g.d(qIG,Wp);qIG.prototype.B=function(a){return cp(a)?nep(this,a):oO(a)?PTF(this,a):J2(a)?TTs(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};
var r6=[10];g.d(Wsp,Wp);Wsp.prototype.B=function(a){return cp(a)?BT7(this,a):oO(a)?hnV(this,a):J2(a)?$nL(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};
var s7s=[10];g.d(geh,Wp);geh.prototype.B=function(a){return oO(a)?YID(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};g.d(ADP,Oq);g.C=ADP.prototype;g.C.qf=function(a){var x=Oq.prototype.qf.call(this,a);x.mainVideoEntity=new Wsp(a,this.S,this.T);x.mainPlaylistEntity=new qIG(a,this.S,this.T);x.mainDownloadsListEntity=new geh(a,this.S,this.T);return x};
g.C.refreshAllStaleEntities=function(a,x){var y=this,D,M,N,F,c,J,G,Q,S,K,L;return g.R(function(w){switch(w.T){case 1:D=[];if(!y.S.C("web_player_offline_playlist_auto_refresh")){w.WJ(2);break}return g.B(w,Unh(y,a,x),3);case 3:D=w.B;case 2:return g.B(w,gF.getInstance(),4);case 4:return M=w.B,g.B(w,(N=M)==null?void 0:N.get("sdois"),5);case 5:return F=w.B,g.B(w,(c=M)==null?void 0:c.get("lmqf"),6);case 6:J=w.B;if(!F){w.WJ(7);break}Q=D;S=Q.concat;return g.B(w,HBG(y,F,(G=J)!=null?G:"SD",a===0),8);case 8:D=
S.call(Q,w.B);case 7:return K=D,L=K.concat,g.B(w,Oq.prototype.refreshAllStaleEntities.call(y,a,x),9);case 9:return D=L.call(K,w.B),w.return(D)}})};
g.C.WQ=function(a){var x,y,D,M,N,F,c,J;return g.R(function(G){if(G.T==1)return g.B(G,IY(),2);if(G.T!=3)return(x=G.B)?g.B(G,bc(x,g.hw,"mainDownloadsListEntity"),3):G.return(!1);y=G.B;if((D=y)==null?0:(M=D.downloads)==null?0:M.length)for(N=g.HP(a,"mainVideoEntity"),F=g.W(y.downloads),c=F.next();!c.done;c=F.next())if(J=c.value,J.videoItem===N)return G.return(!0);return G.return(!1)})};
g.C.GX=function(){var a=this,x,y,D,M,N,F,c,J;return g.R(function(G){if(G.T==1)return g.B(G,IY(),2);if(G.T!=3)return(x=G.B)?g.B(G,p8(x,"downloadStatusEntity"),3):G.return([]);y=G.B;D=[];M=g.W(y);for(N=M.next();!N.done;N=M.next())F=N.value,F.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&F.key&&(c=g.UL(F.key).entityId,D.push(c));return D.length?(J={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},G.return(VX(a,D,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
J))):G.return([])})};
g.C.TK=function(){var a;return g.R(function(x){return x.T==1?g.B(x,IY(),2):(a=x.B)?g.B(x,tr(a,{mode:"readwrite",yn:!0},function(y){return Uc(y,"mainVideoEntity").then(function(D){var M=[];D=g.W(D);for(var N=D.next();!N.done;N=D.next()){N=N.value;var F=void 0;(F=N.userState)!=null&&F.playbackPosition||(F=g.UL(N.key).entityId,F={key:g.HP(F,"videoPlaybackPositionEntity"),videoId:F,lastPlaybackPositionSeconds:"0"},M.push(ic(y,F,"videoPlaybackPositionEntity")),N.userState={playbackPosition:F.key},M.push(ic(y,
N,"mainVideoEntity")))}return g.n3.all(M)})}),0):x.return()})};
g.C.jr=function(){var a,x,y,D,M,N,F,c,J,G,Q,S,K,L,w,Z,v,m,u,E,h,V,H,j6,e,as,z7,Qq,DJ,nz,yn,oP,zL,Xl,fz,yg,ht,k;return g.R(function(p7){if(p7.T==1)return g.B(p7,IY(),2);if(p7.T!=3){a=p7.B;if(!a)return p7.return();x=g.HP("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.B(p7,tr(a,{mode:"readonly",yn:!0},function(tt){return g.n3.all([Ar(tt,x,"mainDownloadsListEntity"),Ar(tt,g.hw,"mainDownloadsListEntity"),Uc(tt,"mainVideoEntity"),Uc(tt,"mainPlaylistEntity")])}),3)}y=p7.B;
D=g.W(y);M=D.next().value;N=D.next().value;F=D.next().value;c=D.next().value;J=M;G=N;Q=F;S=c;K=new Set;if((L=J)==null?0:(w=L.downloads)==null?0:w.length)for(Z=g.W(J.downloads),v=Z.next();!v.done;v=Z.next())m=v.value,u=void 0,(E=(u=m.videoItem)!=null?u:m.playlistItem)&&K.add(E);if((h=G)==null?0:(V=h.downloads)==null?0:V.length)for(H=g.W(G.downloads),j6=H.next();!j6.done;j6=H.next())e=j6.value,e.videoItem&&K.add(e.videoItem);as=new Set;z7=[];Qq=g.W(S);for(DJ=Qq.next();!DJ.done;DJ=Qq.next()){nz=DJ.value;
if(nz.videos)for(yn=g.W(nz.videos),oP=yn.next();!oP.done;oP=yn.next())zL=oP.value,(Xl=JSON.parse(g.UL(zL).entityId).videoId)&&as.add(Xl);nz.key&&!K.has(nz.key)&&z7.push(nz.key)}fz=g.W(Q);for(yg=fz.next();!yg.done;yg=fz.next())ht=yg.value,ht.key&&!K.has(ht.key)&&(k=g.UL(ht.key).entityId,as.has(k)||z7.push(ht.key));return z7.length?g.B(p7,Pzp(a,z7),0):p7.WJ(0)})};g.d(iBp,Wp);iBp.prototype.B=function(a){return cp(a)?VUp(this,a):oO(a)?rDJ(this,a):J2(a)?tUh(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};
var X$=[10];g.d(bBF,Wp);bBF.prototype.B=function(a){return cp(a)?IyG(this,a):oO(a)?ent(this,a):J2(a)?ams(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};
var bO=[10];g.d(jns,Wp);jns.prototype.B=function(a){return cp(a)?FRY(this,a):oO(a)?zoV(this,a):J2(a)?cCp(this,a):Promise.reject(Error("Unsupported action type: "+a.actionType))};
var NRD=[10];g.d(pK,Oq);pK.prototype.qf=function(a){var x=Oq.prototype.qf.call(this,a);x.musicTrack=new jns(a,this.T);x.musicPlaylist=new bBF(a,this.T);x.musicAlbumRelease=new iBp(a,this.T);return x};
pK.prototype.refreshAllStaleEntities=function(a,x){var y=this,D,M,N;return g.R(function(F){if(F.T==1)return g.B(F,JCh(y,a,x),2);if(F.T!=3)return M=D=F.B,N=M.concat,g.B(F,Oq.prototype.refreshAllStaleEntities.call(y,a,x),3);D=N.call(M,F.B);return F.return(D)})};g.d(GwV,g.Lf);g.C=GwV.prototype;g.C.create=function(){var a=this;g.U(this,this.events);if(g.xY(this.S))this.T=new ADP(this.S,this.player);else if(g.f9(this.S)||g.je(this.S))this.T=new pK(this.S,this.player);this.events.Z(this.player,"onPlaybackStartExternal",function(){a.Dn()});
this.events.Z(this.player,"videodatachange",function(){a.Dn()});
this.S.C("html5_offline_playback_position_sync")&&this.events.Z(this.player,"presentingplayerstatechange",this.Mu)};
g.C.a5=function(){return!1};
g.C.hV=function(a,x,y,D){var M=this;return g.R(function(N){return M.T?N.return(VX(M.T,a,x,y,D)):N.return(Promise.reject())})};
g.C.deleteAll=function(){return this.T.deleteAll()};
g.C.gN=function(a){return this.T.gN(a)};
g.C.refreshAllStaleEntities=function(a){return this.T.refreshAllStaleEntities(a)};
g.C.setUpPositionSyncInterval=function(a){this.T.setUpPositionSyncInterval(a)};
g.C.wN=function(a){this.T.wN(a)};
g.C.k7=function(a){return this.T.k7(a)};
g.C.Dn=function(){var a=this,x;return g.R(function(y){x=a.player.getVideoData();return g.aQ(x)?Qnh(x)&&a.B!==x.clientPlaybackNonce?g.B(y,S_J(a,x),0):y.WJ(0):y.return()})};
g.C.Mu=function(a){var x=this,y,D,M,N,F,c,J;return g.R(function(G){if(G.T==1)return y=x.player.getVideoData(),D=y.tf,g.Qj(a,2)||g.Qj(a,512)?g.B(G,IY(),2):G.return();if(G.T!=3){M=G.B;if(!M)return yX("PES is undefined"),G.return();N=y.videoId;return g.B(G,bc(M,g.HP(N,"mainVideoEntity"),"mainVideoEntity"),3)}F=G.B;if(!F)return G.return();c=Math.floor(D).toString();J={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:c}};return g.B(G,x.hV([N],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
J),0)})};
g.C.isOrchestrationLeader=function(){return this.T.isOrchestrationLeader()};
g.C.updateDownloadState=function(a,x){var y,D,M,N;return g.R(function(F){if(F.T==1)return g.B(F,IY(),2);y=F.B;if(!y)return yX("PES is undefined"),F.return();D=g.UL(a);M=D.entityType;N=D.entityId;return g.B(F,G0(N,M,y,x,!0),0)})};g.Kf("offline",GwV);})(_yt_player);
